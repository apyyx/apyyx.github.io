<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[HelloDog]]></title>
  <subtitle><![CDATA[Keep Calm and Carry On]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://wsgzao.github.io/"/>
  <updated>2015-09-19T03:29:59.330Z</updated>
  <id>http://wsgzao.github.io/</id>
  
  <author>
    <name><![CDATA[wsgzao]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[股指期货和国债期货合约的基本交易以及结算规则]]></title>
    <link href="http://wsgzao.github.io/post/future/"/>
    <id>http://wsgzao.github.io/post/future/</id>
    <published>2015-09-19T01:53:02.000Z</published>
    <updated>2015-09-19T03:29:59.330Z</updated>
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>文章介绍了股指期货的基础知识，引用官方细则包括沪深300指数期货，上证50股指期货，中证500股指期货，5年期国债期货，10年期国债期货。期货规则会随市场而变，更多实时信息请参考中国金融期货交易所和中国证券业协会。</p>
<blockquote>
<p>学习期货知识</p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年09月19日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/future/" target="_blank" rel="external">http://wsgzao.github.io/post/future/</a></p>
<p>扩展阅读</p>
<p>股指期货基础知识与交易策略 - <a href="http://www.cindaqh.com/upload/20150624/20150624113552895.pdf" target="_blank" rel="external">http://www.cindaqh.com/upload/20150624/20150624113552895.pdf</a><br>中国金融期货交易所 - <a href="http://www.cffex.com.cn/" target="_blank" rel="external">http://www.cffex.com.cn/</a><br>中国证券业协会 - <a href="http://www.sac.net.cn/" target="_blank" rel="external">http://www.sac.net.cn/</a></p>
<hr>
<h2 id="股指期货">股指期货</h2><h3 id="期货">期货</h3><p>期货英文名”Future”，是由”未来”一词演化而来，其含义是：交易双方不必在买卖发生的初期就交收实货，而是共同约定在未来的某一时候交收实物，因此中国人就称其为”期货”。期，就是将来的意思，非现在。”期货就是一个合同，比方说，我们俩订一个合同决定三个月以后我卖给你一个东西，今天我们就把价格定下来，就这么简单。”</p>
<h3 id="股指期货-1">股指期货</h3><p>股指期货全称是股票价格指数期货，是指以股价指数为标的物的标准化期货合约，双方约定在未来的某个特定日期，可以按照事先确定的股价指数的大小，进行标的指数的买卖。</p>
<h3 id="股票与期货交易对比">股票与期货交易对比</h3><table>
<thead>
<tr>
<th>名称</th>
<th>股票</th>
<th>期货</th>
</tr>
</thead>
<tbody>
<tr>
<td>交易方向</td>
<td>只能做多</td>
<td>买卖双向</td>
</tr>
<tr>
<td>交易规则</td>
<td>T+1</td>
<td>T+0</td>
</tr>
<tr>
<td>资金运用</td>
<td>全额资金</td>
<td>保证金</td>
</tr>
<tr>
<td>交易时限</td>
<td>除非退市，否则可长期持有</td>
<td>有时间限制</td>
</tr>
<tr>
<td>交易方式</td>
<td>价差投机</td>
<td>投机、套保、套利</td>
</tr>
</tbody>
</table>
<h2 id="沪深300股指期货">沪深300股指期货</h2><blockquote>
<p>沪深300指数是由上海和深圳证券市场中选取300只A股作为样本编制而成的成份股指数。</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>沪深300指数期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>沪深300指数</td>
</tr>
<tr>
<td>合约乘数</td>
<td>每点300元</td>
</tr>
<tr>
<td>报价单位</td>
<td>指数点</td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.2点</td>
</tr>
<tr>
<td>合约月份</td>
<td>当月、下月及随后两个季月</td>
</tr>
<tr>
<td>交易时间</td>
<td>上午9:15-11:30，下午13:00-15:15</td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>上午9:15-11:30，下午13:00-15:00</td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一个交易日结算价的±10%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的8%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第三个周五，遇国家法定假日顺延</td>
</tr>
<tr>
<td>交割日期</td>
<td>同最后交易日</td>
</tr>
<tr>
<td>交割方式</td>
<td>现金交割</td>
</tr>
<tr>
<td>交易代码</td>
<td>IF</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
</tr>
</tbody>
</table>
<h3 id="沪深300股指期货合约交易细则">沪深300股指期货合约交易细则</h3><blockquote>
<p>（2013年8月30日实施  2014年9月1日第一次修订 2015年4月10日第二次修订  2015年8月3日第三次修订） </p>
</blockquote>
<pre><code>第一章 总则
</code></pre><p><strong>第一条</strong> 为规范中国金融期货交易所（以下简称交易所）沪深 300 股指期货合约（以下简称本合约）交易行为，根据《中国金融期货交易所交易规则》及相关实施细则，制定本细则。  </p>
<p><strong>第二条</strong> 交易所、会员、客户、期货保证金存管银行及期货市场其他参与者应当遵守本细则。  </p>
<p><strong>第三条</strong> 本细则未规定的，按照交易所相关业务规则的规定执行。</p>
<pre><code>第二章 合约
</code></pre><p><strong>第四条</strong> 本合约的合约标的为中证指数有限公司编制和发布的沪深 300 指数。</p>
<p><strong>第五条</strong> 本合约的合约乘数为每点人民币 300 元。股指期货合约价值为股指期货指数点乘以合约乘数。</p>
<p><strong>第六条</strong> 本合约以指数点报价。</p>
<p><strong>第七条</strong> 本合约的最小变动价位为 0.2 指数点，合约交易报价指数点为 0.2 点的整数倍。</p>
<p><strong>第八条</strong> 本合约的合约月份为当月、下月及随后两个季月。季月是指3月、6月、9月、12月。</p>
<p><strong>第九条</strong> 本合约的最后交易日为合约到期月份的第三个周五，最后交易日即为交割日。最后交易日为国家法定假日或者因异常情况等原因未交易的，以下一交易日为最后交易日和交割日。<br>     到期合约交割日的下一交易日，新的月份合约开始交易。</p>
<p><strong>第十条</strong> 本合约的交易代码为 IF。 </p>
<pre><code>第三章 交易业务
</code></pre><p><strong>第十一条</strong> 本合约的交易单位为手，合约交易以交易单位的整数倍进行。</p>
<p><strong>第十二条</strong> 本合约交易指令每次最小下单数量为 1 手，市价指令每次最大下单数量为 50 手，限价指令每次最大下单数量为 100 手。</p>
<p><strong>第十三条</strong> 本合约采用集合竞价和连续竞价两种交易方式。<br>     集合竞价时间为每个交易日9:10-9:15，其中9:10-9:14为指令申报时间，9:14-9:15为指令撮合时间。<br>     连续竞价时间为每个交易日9:15-11:30（第一节）和13:00-15:15（第二节），最后交易日连续竞价时间为9:15-11:30（第一节）和13:00-15:00（第二节）。</p>
<pre><code>第四章 结算业务
</code></pre><p><strong>第十四条</strong> 本合约的当日结算价为合约最后一小时成交价格按照成交量的加权平均价。计算结果保留至小数点后一位。</p>
<p><strong>第十五条</strong> 本合约以当日结算价作为计算当日盈亏的依据。具体计算公式如下：<br>     当日盈亏={∑[（卖出成交价－当日结算价）×卖出量]＋ ∑[（当日结算价－买入成交价）×买入量]＋（上一日交易日结算价－当日结算价）×（上一交易日卖出持仓量）}×合约乘数</p>
<p><strong>第十六条</strong> 本合约的手续费标准由交易所另行规定。</p>
<p><strong>第十七条</strong> 本合约的交割结算价为最后交易日标的指数最后2小时的算术平均价。计算结果保留至小数点后两位。</p>
<p><strong>第十八条</strong> 本合约采用现金交割方式。</p>
<p><strong>第十九条</strong> 本合约的交割手续费标准为交割金额的万分之一。</p>
<pre><code>第五章 风险管理
</code></pre><p><strong>第二十条</strong> 本合约的最低交易保证金标准为合约价值的8%。</p>
<p><strong>第二十一条</strong> 本合约的每日价格最大波动限制是指其每日价格涨停板幅度，为上一交易日结算价的±10%。<br>     季月合约上市首日涨跌停板幅度为挂盘基准价的±20%。上市首日有成交的，于下一交易日恢复到合约规定的涨跌停板幅度；上市首日无成交的，下一交易日继续执行前一交易日的涨跌停板幅度。<br>     本合约最后交易日涨跌停板幅度为上一交易日结算价的±20%。</p>
<p><strong>第二十二条</strong> 本合约实行持仓限额制度。<br>     （一）进行投机交易的客户某一合约单边持仓限额为 5000 手；<br>     （二）某一合约结算后单边总持仓量超过 10 万手的，结算会员下一交易日该合约单边持仓量不得超过该合约单边总持仓量的25%。<br>     进行套期保值交易和套利交易的持仓按照交易所有关规定执行。</p>
<pre><code>第六章 附则
</code></pre><p><strong>第二十三条</strong> 违反本细则规定的，交易所按照《中国金融期货交易所违规违约处理办法》有关规定处理。</p>
<p><strong>第二十四条</strong> 本细则由交易所负责解释。</p>
<p><strong>第二十五条</strong> 本细则自 2015 年 8 月 3 日起实施。  </p>
<h2 id="上证50股指期货">上证50股指期货</h2><blockquote>
<p>上证50指数是根据科学客观的方法，挑选上海证券市场规模大、流动性好的最具代表性的50只股票组成样本股，以便综合反映上海证券市场最具市场影响力的一批龙头企业的整体状况。</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>上证50股指期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>上证50指数</td>
</tr>
<tr>
<td>合约乘数</td>
<td>每点300元</td>
</tr>
<tr>
<td>报价单位</td>
<td>指数点</td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.2点</td>
</tr>
<tr>
<td>合约月份</td>
<td>当月、下月及随后两个季月</td>
</tr>
<tr>
<td>交易时间</td>
<td>上午9:15-11:30，下午13:00-15:15</td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>上午9:15-11:30，下午13:00-15:00</td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一个交易日结算价的±10%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的8%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第三个周五，遇国家法定假日顺延</td>
</tr>
<tr>
<td>交割日期</td>
<td>同最后交易日</td>
</tr>
<tr>
<td>交割方式</td>
<td>现金交割</td>
</tr>
<tr>
<td>交易代码</td>
<td>IH</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
</tr>
</tbody>
</table>
<h3 id="上证50股指期货合约交易细则">上证50股指期货合约交易细则</h3><blockquote>
<p>（2015年3月27日实施  2015年8月3日第一次修订）</p>
</blockquote>
<pre><code>第一章 总则
</code></pre><p><strong>第一条</strong> 为规范中国金融期货交易所（以下简称交易所）上证 50 股指期货合约（以下简称本合约）交易行为，根据《中国金融期货交易所交易规则》及相关实施细则，制定本细则。  </p>
<p><strong>第二条</strong> 交易所、会员、客户、期货保证金存管银行及期货市场其他参与者应当遵守本细则。  </p>
<p><strong>第三条</strong> 本细则未规定的，按照交易所相关业务规则的规定执行。</p>
<pre><code>第二章 合约
</code></pre><p><strong>第四条</strong> 本合约的合约标的为上海证券交易所编制和发布的上证 50 指数。</p>
<p><strong>第五条</strong> 本合约的合约乘数为每点人民币 300 元。股指期货合约价值为股指期货指数点乘以合约乘数。</p>
<p><strong>第六条</strong> 本合约以指数点报价。</p>
<p><strong>第七条</strong> 本合约的最小变动价位为 0.2 指数点，合约交易报价指数点为 0.2 点的整数倍。</p>
<p><strong>第八条</strong> 本合约的合约月份为当月、下月及随后两个季月。季月是指3月、6月、9月、12月。</p>
<p><strong>第九条</strong> 本合约的最后交易日为合约到期月份的第三个周五，最后交易日即为交割日。最后交易日为国家法定假日或者因异常情况等原因未交易的，以下一交易日为最后交易日和交割日。<br>     到期合约交割日的下一交易日，新的月份合约开始交易。</p>
<p><strong>第十条</strong> 本合约的交易代码为 IH。 </p>
<pre><code>第三章 交易业务
</code></pre><p><strong>第十一条</strong> 本合约的交易单位为手，合约交易以交易单位的整数倍进行。</p>
<p><strong>第十二条</strong> 本合约交易指令每次最小下单数量为 1 手，市价指令每次最大下单数量为 50 手，限价指令每次最大下单数量为 100 手。</p>
<p><strong>第十三条</strong> 本合约采用集合竞价和连续竞价两种交易方式。<br>     集合竞价时间为每个交易日9:10-9:15，其中9:10-9:14为指令申报时间，9:14-9:15为指令撮合时间。<br>     连续竞价时间为每个交易日9:15-11:30（第一节）和13:00-15:15（第二节），最后交易日连续竞价时间为9:15-11:30（第一节）和13:00-15:00（第二节）。</p>
<pre><code>第四章 结算业务
</code></pre><p><strong>第十四条</strong> 本合约的当日结算价为合约最后一小时成交价格按照成交量的加权平均价。计算结果保留至小数点后一位。</p>
<p><strong>第十五条</strong> 本合约以当日结算价作为计算当日盈亏的依据。具体计算公式如下：<br>     当日盈亏={∑[（卖出成交价－当日结算价）×卖出量]＋ ∑[（当日结算价－买入成交价）×买入量]＋（上一日交易日结算价－当日结算价）×（上一交易日卖出持仓量）}×合约乘数</p>
<p><strong>第十六条</strong> 本合约的手续费标准由交易所另行规定。</p>
<p><strong>第十七条</strong> 本合约的交割结算价为最后交易日标的指数最后2小时的算术平均价。计算结果保留至小数点后两位。</p>
<p><strong>第十八条</strong> 本合约采用现金交割方式。</p>
<p><strong>第十九条</strong> 本合约的交割手续费标准为交割金额的万分之一。</p>
<pre><code>第五章 风险管理
</code></pre><p><strong>第二十条</strong> 本合约的最低交易保证金标准为合约价值的8%。</p>
<p><strong>第二十一条</strong> 本合约的每日价格最大波动限制是指其每日价格涨停板幅度，为上一交易日结算价的±10%。<br>     季月合约上市首日涨跌停板幅度为挂盘基准价的±20%。上市首日有成交的，于下一交易日恢复到合约规定的涨跌停板幅度；上市首日无成交的，下一交易日继续执行前一交易日的涨跌停板幅度。<br>     本合约最后交易日涨跌停板幅度为上一交易日结算价的±20%。</p>
<p><strong>第二十二条</strong> 本合约实行持仓限额制度。<br>     （一）进行投机交易的客户某一合约单边持仓限额为 1200 手；<br>     （二）某一合约结算后单边总持仓量超过 10 万手的，结算会员下一交易日该合约单边持仓量不得超过该合约单边总持仓量的25%。<br>     进行套期保值交易和套利交易的持仓按照交易所有关规定执行。</p>
<pre><code>第六章 附则
</code></pre><p><strong>第二十三条</strong> 违反本细则规定的，交易所按照《中国金融期货交易所违规违约处理办法》有关规定处理。</p>
<p><strong>第二十四条</strong> 本细则由交易所负责解释。</p>
<p><strong>第二十五条</strong> 本细则自 2015 年 8 月 3 日起实施。  </p>
<h2 id="中证500股指期货">中证500股指期货</h2><blockquote>
<p>中证500指数是根据科学客观的方法，挑选沪深证券市场内具有代表性的中小市值公司组成样本股，以便综合反映沪深证券市场内中小市值公司的整体状况。其样本空间内股票扣除沪深300指数样本股及最近一年日均总市值排名前300名的股票，剩余股票按照最近一年（新股为上市以来）的日均成交金额由高到低排名，剔除排名后20%的股票，然后将剩余股票按照日均总市值由高到低进行排名，选取排名在前500名的股票作为中证500指数样本股。</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>中证500股指期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>中证500指数</td>
</tr>
<tr>
<td>合约乘数</td>
<td>每点200元</td>
</tr>
<tr>
<td>报价单位</td>
<td>指数点</td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.2点</td>
</tr>
<tr>
<td>合约月份</td>
<td>当月、下月及随后两个季月</td>
</tr>
<tr>
<td>交易时间</td>
<td>上午9:15-11:30，下午13:00-15:15</td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>上午9:15-11:30，下午13:00-15:00</td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一个交易日结算价的±10%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的8%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第三个周五，遇国家法定假日顺延</td>
</tr>
<tr>
<td>交割日期</td>
<td>同最后交易日</td>
</tr>
<tr>
<td>交割方式</td>
<td>现金交割</td>
</tr>
<tr>
<td>交易代码</td>
<td>IC</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
</tr>
</tbody>
</table>
<h3 id="中证500股指期货合约交易细则">中证500股指期货合约交易细则</h3><blockquote>
<p>（2015年3月27日实施 2015年8月3日第一次修订）</p>
</blockquote>
<pre><code>第一章 总则
</code></pre><p><strong>第一条</strong> 为规范中国金融期货交易所（以下简称交易所）中证 500 股指期货合约（以下简称本合约）交易行为，根据《中国金融期货交易所交易规则》及相关实施细则，制定本细则。</p>
<p><strong>第二条</strong> 交易所、会员、客户、期货保证金存管银行及期货市场其他参与者应当遵守本细则。</p>
<p><strong>第三条</strong> 本细则未规定的，按照交易所相关业务规则的规定执行。</p>
<pre><code>第二章 合约
</code></pre><p><strong>第四条</strong> 本合约的合约标的为中证指数有限公司编制和发布的中证 500 指数。</p>
<p><strong>第五条</strong> 本合约的合约乘数为每点人民币 200 元。股指期货合约价值为股指期货指数点乘以合约乘数。</p>
<p><strong>第六条</strong> 本合约以指数点报价。</p>
<p><strong>第七条</strong> 本合约的最小变动价位为 0.2 指数点，合约交易报价指数点为 0.2 点的整数倍。</p>
<p><strong>第八条</strong> 本合约的合约月份为当月、下月及随后两个季月。季月是指3月、6月、9月、12月。</p>
<p><strong>第九条</strong> 本合约的最后交易日为合约到期月份的第三个周五，最后交易日即为交割日。最后交易日为国家法定假日或者因异常情况等原因未交易的，以下一交易日为最后交易日和交割日。<br>到期合约交割日的下一交易日，新的月份合约开始交易。</p>
<p><strong>第十条</strong> 本合约的交易代码为 IC。</p>
<pre><code>第三章 交易业务
</code></pre><p><strong>第十一条</strong> 本合约的交易单位为手，合约交易以交易单位的整数倍进行。</p>
<p><strong>第十二条</strong> 本合约交易指令每次最小下单数量为 1 手，市价指令每次最大下单数量为 50 手，限价指令每次最大下单数量为 100 手。</p>
<p><strong>第十三条</strong> 本合约采用集合竞价和连续竞价两种交易方式。<br>集合竞价时间为每个交易日9:10-9:15，其中9:10-9:14为指令申报时间，9:14-9:15为指令撮合时间。<br>连续竞价时间为每个交易日9:15-11:30（第一节）和13:00-15:15（第二节），最后交易日连续竞价时间为9:15-11:30（第一节）和13:00-15:00（第二节）。</p>
<pre><code>第四章 结算业务
</code></pre><p><strong>第十四条</strong> 本合约的当日结算价为合约最后一小时成交价格按照成交量的加权平均价。计算结果保留至小数点后一位。</p>
<p><strong>第十五条</strong> 本合约以当日结算价作为计算当日盈亏的依据。具体计算公式如下：<br>当日盈亏={∑[（卖出成交价－当日结算价）×卖出量]＋ ∑[（当日结算价－买入成交价）×买入量]＋（上一日交易日结算价－当日结算价）×（上一交易日卖出持仓量）}×合约乘数</p>
<p><strong>第十六条</strong> 本合约的手续费标准由交易所另行规定。</p>
<p><strong>第十七条</strong> 本合约的交割结算价为最后交易日标的指数最后2小时的算术平均价。计算结果保留至小数点后两位。</p>
<p><strong>第十八条</strong> 本合约采用现金交割方式。</p>
<p><strong>第十九条</strong> 本合约的交割手续费标准为交割金额的万分之一。</p>
<pre><code>第五章 风险管理
</code></pre><p><strong>第二十条</strong> 本合约的最低交易保证金标准为合约价值的8%。</p>
<p><strong>第二十一条</strong> 本合约的每日价格最大波动限制是指其每日价格涨停板幅度，为上一交易日结算价的±10%。<br>季月合约上市首日涨跌停板幅度为挂盘基准价的±20%。上市首日有成交的，于下一交易日恢复到合约规定的涨跌停板幅度；上市首日无成交的，下一交易日继续执行前一交易日的涨跌停板幅度。<br>本合约最后交易日涨跌停板幅度为上一交易日结算价的±20%。</p>
<p><strong>第二十二条</strong> 本合约实行持仓限额制度。<br>（一）进行投机交易的客户某一合约单边持仓限额为 1200 手；<br>（二）某一合约结算后单边总持仓量超过 10 万手的，结算会员下一交易日该合约单边持仓量不得超过该合约单边总持仓量的25%。<br>进行套期保值交易和套利交易的持仓按照交易所有关规定执行。</p>
<pre><code>第六章 附则
</code></pre><p><strong>第二十三条</strong> 违反本细则规定的，交易所按照《中国金融期货交易所违规违约处理办法》有关规定处理。</p>
<p><strong>第二十四条</strong> 本细则由交易所负责解释。</p>
<p><strong>第二十五条</strong> 本细则自 2015 年 8 月 3 日起实施。</p>
<h2 id="5年期国债期货">5年期国债期货</h2><table>
<thead>
<tr>
<th>名称</th>
<th>5年期国债期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>面值为100万元人民币、票面利率为3%的名义中期国债</td>
</tr>
<tr>
<td>可交割国债</td>
<td>合约到期月份首日剩余期限为4-5.25年的记账式附息国债</td>
</tr>
<tr>
<td>报价方式</td>
<td>百元净价报价</td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.005元</td>
</tr>
<tr>
<td>合约月份</td>
<td>最近的三个季月（3月、6月、9月、12月中的最近三个月循环）</td>
</tr>
<tr>
<td>交易时间</td>
<td>9:15-11:30，13:00-15:15</td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>09:15—11:30</td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一交易日结算价的±1.2%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的1%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第二个星期五</td>
</tr>
<tr>
<td>交割日期</td>
<td>最后交易日后的第三个交易日</td>
</tr>
<tr>
<td>交割方式</td>
<td>实物交割</td>
</tr>
<tr>
<td>交易代码</td>
<td>TF</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
</tr>
</tbody>
</table>
<h3 id="5年期国债期货合约交易细则">5年期国债期货合约交易细则</h3><h3 id="5年期国债期货合约交割细则">5年期国债期货合约交割细则</h3><h2 id="10年期国债期货">10年期国债期货</h2><table>
<thead>
<tr>
<th>名称</th>
<th>10年期国债期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>面值为100万元人民币、票面利率为3%的名义长期国债</td>
</tr>
<tr>
<td>可交割国债</td>
<td>合约到期月份首日剩余期限为6.5-10.25年的记账式附息国债</td>
</tr>
<tr>
<td>报价方式</td>
<td>百元净价报价</td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.005元</td>
</tr>
<tr>
<td>合约月份</td>
<td>最近的三个季月（3月、6月、9月、12月中的最近三个月循环）</td>
</tr>
<tr>
<td>交易时间</td>
<td>9:15-11:30，13:00-15:15</td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>09:15—11:30</td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一交易日结算价的±2%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的2%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第二个星期五</td>
</tr>
<tr>
<td>交割日期</td>
<td>最后交易日后的第三个交易日</td>
</tr>
<tr>
<td>交割方式</td>
<td>实物交割</td>
</tr>
<tr>
<td>交易代码</td>
<td>T</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
</tr>
</tbody>
</table>
<h3 id="10年期国债期货合约交易细则">10年期国债期货合约交易细则</h3><h3 id="10年期国债期货合约交割细则">10年期国债期货合约交割细则</h3><h2 id="差异化小结">差异化小结</h2><h3 id="股指期货差异">股指期货差异</h3><table>
<thead>
<tr>
<th>名称</th>
<th>沪深300指数期货合约表</th>
<th>上证50股指期货合约表</th>
<th>中证500股指期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>沪深300指数</td>
<td>上证50指数</td>
<td>中证500指数</td>
</tr>
<tr>
<td>合约乘数</td>
<td>每点300元</td>
<td>每点300元</td>
<td>每点200元</td>
</tr>
<tr>
<td>报价单位</td>
<td>指数点</td>
<td></td>
<td></td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.2点</td>
<td></td>
<td></td>
</tr>
<tr>
<td>合约月份</td>
<td>当月、下月及随后两个季月</td>
<td></td>
<td></td>
</tr>
<tr>
<td>交易时间</td>
<td>上午9:15-11:30，下午13:00-15:15</td>
<td></td>
<td></td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>上午9:15-11:30，下午13:00-15:00</td>
<td></td>
<td></td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一个交易日结算价的±10%</td>
<td></td>
<td></td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的8%</td>
<td></td>
<td></td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第三个周五，遇国家法定假日顺延</td>
<td></td>
<td></td>
</tr>
<tr>
<td>交割日期</td>
<td>同最后交易日</td>
<td></td>
<td></td>
</tr>
<tr>
<td>交割方式</td>
<td>现金交割</td>
<td></td>
<td></td>
</tr>
<tr>
<td>交易代码</td>
<td>IF</td>
<td>IH</td>
<td>IC</td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="国债期货差异">国债期货差异</h3><table>
<thead>
<tr>
<th>名称</th>
<th>5年期国债期货合约表</th>
<th>10年期国债期货合约表</th>
</tr>
</thead>
<tbody>
<tr>
<td>合约标的</td>
<td>面值为100万元人民币、票面利率为3%的名义中期国债</td>
<td>面值为100万元人民币、票面利率为3%的名义长期国债</td>
</tr>
<tr>
<td>可交割国债</td>
<td>合约到期月份首日剩余期限为4-5.25年的记账式附息国债</td>
<td>合约到期月份首日剩余期限为6.5-10.25年的记账式附息国债</td>
</tr>
<tr>
<td>报价方式</td>
<td>百元净价报价</td>
<td></td>
</tr>
<tr>
<td>最小变动价位</td>
<td>0.005元</td>
<td></td>
</tr>
<tr>
<td>合约月份</td>
<td>最近的三个季月（3月、6月、9月、12月中的最近三个月循环）</td>
<td></td>
</tr>
<tr>
<td>交易时间</td>
<td>9:15-11:30，13:00-15:15</td>
<td></td>
</tr>
<tr>
<td>最后交易日交易时间</td>
<td>09:15—11:30</td>
<td></td>
</tr>
<tr>
<td>每日价格最大波动限制</td>
<td>上一交易日结算价的±1.2%</td>
<td>上一交易日结算价的±2%</td>
</tr>
<tr>
<td>最低交易保证金</td>
<td>合约价值的1%</td>
<td>合约价值的2%</td>
</tr>
<tr>
<td>最后交易日</td>
<td>合约到期月份的第二个星期五</td>
<td></td>
</tr>
<tr>
<td>交割日期</td>
<td>最后交易日后的第三个交易日</td>
<td></td>
</tr>
<tr>
<td>交割方式</td>
<td>实物交割</td>
<td></td>
</tr>
<tr>
<td>交易代码</td>
<td>TF</td>
<td>T </td>
</tr>
<tr>
<td>上市交易所</td>
<td>中国金融期货交易所</td>
<td></td>
</tr>
</tbody>
</table>
]]></content>
    <summary type="html">
    <![CDATA[学习期货知识]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用GitHub和Hexo搭建免费静态Blog]]></title>
    <link href="http://wsgzao.github.io/post/hexo-guide/"/>
    <id>http://wsgzao.github.io/post/hexo-guide/</id>
    <published>2015-09-03T12:40:07.000Z</published>
    <updated>2015-09-03T11:55:09.736Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/5bb7J7NT.png" alt=""></p>
<h2 id="前言">前言</h2><p>习惯自己写Blog的朋友一定不会陌生Wordpress，或许也曾在新浪博客和QQ空间留过脚印，但静心认真思考一下，似乎我们又总是向往更加简单自由的写作方式。GitHub给我们提供了一个无限的空间，我们需要珍惜使用，而Hexo的出现从某种意义上来说代替了Jekyll，让我们可以更专注于写作本身。本文主要介绍自己的实践心得并不断完善内容，衍生知识和原理推荐大家认真阅读官网的手册，其它推荐参考内容链接在文中也会标注出来。</p>
<blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html" target="_blank" rel="external">阮一峰 - 喜欢写Blog的人，会经历三个阶段</a></p>
</blockquote>
<p>第一阶段，刚接触Blog，觉得很新鲜，试着选择一个免费空间来写。<br>第二阶段，发现免费空间限制太多，就自己购买域名和空间，搭建独立博客。<br>第三阶段，觉得独立博客的管理太麻烦，最好在保留控制权的前提下，让别人来管，自己只负责写文章。</p>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年09月03日 - 完善Windows 10安装Hexo中的细节<br>2015年03月22日 - 更新Windows下Hexo 3.0安装和升级，感谢<a href="http://akarin.xyz" target="_blank" rel="external">@机智的阿卡林酱</a><br>2015年03月10日 - 增加Hexo 3.0降级 2.8<br>2014年12月19日 - 完善内容<br>2014年12月09日 - 更新Hexo配置修改部分<br>2014年06月19日 - 更新全部基础架构，待完善配置修改部分<br>2014年06月17日 - 更新部分Hexo建站过程，待完善<br>2014年05月29日 - 撰写初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/hexo-guide/" target="_blank" rel="external">http://wsgzao.github.io/post/hexo-guide/</a></p>
<p>扩展阅读</p>
<ul>
<li>Hexo Docs - <a href="http://hexo.io/docs/" target="_blank" rel="external">http://hexo.io/docs/</a></li>
<li>HelloDog Index - <a href="http://wsgzao.github.io/index/#Hexo" target="_blank" rel="external">http://wsgzao.github.io/index/#Hexo</a></li>
</ul>
<hr>
<h2 id="准备工作">准备工作</h2><p><strong>注意</strong> 本文主要针对<code>Windows</code>平台和<code>Hexo 3.x</code></p>
<h3 id="了解Hexo">了解Hexo</h3><blockquote>
<p>A fast, simple &amp; powerful blog framework</p>
</blockquote>
<p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。<br><a href="http://hexo.io/" target="_blank" rel="external">hexo.io</a></p>
<h3 id="安装GIT">安装GIT</h3><p><a href="https://windows.github.com/" target="_blank" rel="external">GitHub Windows</a></p>
<p>简单可依赖，安装完成后依据提示操作即可，So Easy</p>
<h3 id="安装Node-JS">安装Node.JS</h3><p><a href="http://nodejs.org/" target="_blank" rel="external">Node.JS</a></p>
<p><strong>注意</strong> 安装完成后添加Path环境变量，使<code>npm</code>命令生效。新版已经会自动配置Path</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;C:\Program Files\nodejs\node_modules\npm</span><br></pre></td></tr></table></figure>
<h3 id="安装Hexo">安装Hexo</h3><p>配置好<code>GitHub</code>家目录后，双击桌面上的<code>Git Shell</code>，输入<code>npm</code>命令即可安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br><span class="line">npm install hexo --save</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果命令无法运行，可以尝试更换taobao的npm源</span></span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Hexo初始化配置">Hexo初始化配置</h2><h3 id="创建Hexo文件夹">创建Hexo文件夹</h3><p>安装完成后，根据自己喜好建立目录（如<code>E:\kuaipan\GitHub\hexo</code>），进入<code>Git Shell</code>切换到该路径下<code>E:\kuaipan\GitHub\hexo</code>执行以下指令<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init&#10;&#10;#&#23433;&#35013; Hexo &#23436;&#25104;&#21518;&#65292;&#35831;&#25191;&#34892;&#19979;&#21015;&#21629;&#20196;&#65292;Hexo &#23558;&#20250;&#22312;&#25351;&#23450;&#25991;&#20214;&#22841;&#20013;&#26032;&#24314;&#25152;&#38656;&#35201;&#30340;&#25991;&#20214;&#12290;&#10;$ hexo init &#60;folder&#62;&#10;$ cd &#60;folder&#62;&#10;$ npm install&#10;&#10;#&#26032;&#24314;&#23436;&#25104;&#21518;&#65292;&#25351;&#23450;&#25991;&#20214;&#22841;&#30340;&#30446;&#24405;&#22914;&#19979;&#10;.&#10;&#9500;&#9472;&#9472; _config.yml&#10;&#9500;&#9472;&#9472; package.json&#10;&#9500;&#9472;&#9472; scaffolds&#10;&#9500;&#9472;&#9472; scripts&#10;&#9500;&#9472;&#9472; source&#10;|      &#9500;&#9472;&#9472; _drafts&#10;|      &#9492;&#9472;&#9472; _posts&#10;&#9492;&#9472;&#9472; themes</span><br></pre></td></tr></table></figure></p>
<h3 id="安装Hexo插件">安装Hexo插件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-index --save</span><br><span class="line">npm install hexo-generator-archive --save</span><br><span class="line">npm install hexo-generator-category --save</span><br><span class="line">npm install hexo-generator-tag --save</span><br><span class="line">npm install hexo-server --save</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hexo-deployer-heroku --save</span><br><span class="line">npm install hexo-deployer-rsync --save</span><br><span class="line">npm install hexo-deployer-openshift --save</span><br><span class="line">npm install hexo-renderer-marked@<span class="number">0.2</span> --save</span><br><span class="line">npm install hexo-renderer-stylus@<span class="number">0.2</span> --save</span><br><span class="line">npm install hexo-generator-feed@<span class="number">1</span> --save</span><br><span class="line">npm install hexo-generator-sitemap@<span class="number">1</span> --save</span><br></pre></td></tr></table></figure>
<h3 id="本地查看效果">本地查看效果</h3><p>继续执行以下命令，成功后可登录<code>localhost:4000</code>查看效果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure></p>
<h3 id="Hexo简写命令">Hexo简写命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo n <span class="comment">#new</span></span><br><span class="line">hexo g <span class="comment">#generate</span></span><br><span class="line">hexo s <span class="comment">#server</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="部署静态网页到GitHub">部署静态网页到GitHub</h2><h3 id="注册设置GitHub">注册设置GitHub</h3><ol>
<li>登录<a href="https://github.com/" target="_blank" rel="external">GitHub</a>，注册自定义用户名如<code>wsgzao</code></li>
<li>在主页右下角创建<code>New repository</code>，name必须和用户名一致如<code>wsgzao.github.io</code></li>
<li>首次创建耐心等待10分钟左右审核，之后即可访问静态主页如<a href="http://wsgzao.github.io" target="_blank" rel="external">http://wsgzao.github.io</a></li>
</ol>
<h3 id="同步内容至GitHub">同步内容至GitHub</h3><ol>
<li>下载<a href="https://windows.github.com/" target="_blank" rel="external">GitHub Windows</a></li>
<li>设置<code>Local path</code>如<code>E:\快盘\GitHub\</code></li>
<li>运行<code>Git Shell</code>切换到如<code>E:\快盘\GitHub\hexo</code>路径下</li>
<li>执行<code>hexo g</code>命令生成<code>public</code>文件夹</li>
<li>把生成的内容全部拷贝到<code>Local path</code>或其子目录</li>
<li>运行<code>GitHub</code>确认修改信息后执行右上角的<code>Sync</code>同步</li>
<li>最后访问主页观察效果</li>
</ol>
<p><a href="https://pages.github.com/" target="_blank" rel="external">https://pages.github.com/</a></p>
<hr>
<h2 id="域名和DNS">域名和DNS</h2><h3 id="域名推荐">域名推荐</h3><blockquote>
<p>GoDaddy makes registering Domain Names fast, simple, and affordable.<br>【推荐理由】两个字“靠谱”，支持支付宝，附优惠码链接</p>
</blockquote>
<p><a href="http://www.godaddy.com/" target="_blank" rel="external">http://www.godaddy.com/</a><br><a href="http://www.gdcodecoupon.com/" target="_blank" rel="external">http://www.gdcodecoupon.com/</a></p>
<h3 id="DNS推荐">DNS推荐</h3><blockquote>
<p>致力于为您提供最稳定、最安全的域名解析服务<br>【推荐理由】依然是两个字“靠谱”，感谢他们一直以来对于公益的坚持</p>
</blockquote>
<p><a href="https://www.dnspod.cn/" target="_blank" rel="external">https://www.dnspod.cn/</a></p>
<h3 id="设置CNAME">设置CNAME</h3><ol>
<li>在Github的网站目录下创建<code>CNAME</code>文件</li>
<li>填写自己的域名如<code>hellodog.com</code>，保存结束</li>
<li>登录DNSPod，先添加域名，然后添加记录，设置如下</li>
</ol>
<table>
<thead>
<tr>
<th>主机记录</th>
<th>记录类型</th>
<th>线路类型</th>
<th>记录值</th>
<th>MX优先级</th>
<th>TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td>@</td>
<td>CNAME</td>
<td>默认</td>
<td>wsgzao.github.io.</td>
<td>-</td>
<td>10</td>
</tr>
<tr>
<td>www</td>
<td>CNAME</td>
<td>默认</td>
<td>wsgzao.github.io.</td>
<td>-</td>
<td>10</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="Hexo配置修改">Hexo配置修改</h2><blockquote>
<p>告诉自己为什么要选择Hexo</p>
</blockquote>
<h3 id="知识储备">知识储备</h3><p>1.勤学勤练Markdown</p>
<blockquote>
<p>本地+云端备份数据是一种习惯</p>
</blockquote>
<ul>
<li>Markdown学习路径 - <a href="http://wsgzao.github.io/post/markdown/" target="_blank" rel="external">http://wsgzao.github.io/post/markdown/</a></li>
</ul>
<p>2.使用性感的文本编辑器</p>
<blockquote>
<p>工欲善其事必先利其器</p>
</blockquote>
<ul>
<li>Notepad2</li>
<li>Sublime Text</li>
</ul>
<p><a href="http://wsgzao.github.io/post/windows/#文本编辑器" target="_blank" rel="external">http://wsgzao.github.io/post/windows/#文本编辑器</a></p>
<h3 id="Hexo主题">Hexo主题</h3><blockquote>
<p>选择主题建议遵循<code>KISS</code>原则</p>
</blockquote>
<ul>
<li>Hexo Themes - <a href="http://hexo.io/themes/" target="_blank" rel="external">http://hexo.io/themes/</a></li>
<li><del>Pacman - <a href="http://wsgzao.github.io/post/hexo-pacman/" target="_blank" rel="external">http://wsgzao.github.io/post/hexo-pacman/</a></del></li>
<li>Jacman - <a href="http://wsgzao.github.io/post/hexo-jacman/" target="_blank" rel="external">http://wsgzao.github.io/post/hexo-jacman/</a></li>
</ul>
<h3 id="常见问题">常见问题</h3><p>1.修改配置文件时注意<code>YAML</code>语法，参数<code>冒号:</code>后一定要留<code>空格</code><br>2.中文乱码请修改文件编码格式为<code>UTF-8</code></p>
<h3 id="如何迁移至Hexo">如何迁移至Hexo</h3><p><a href="http://hexo.io/zh-cn/docs/migration.html" target="_blank" rel="external">http://hexo.io/zh-cn/docs/migration.html</a></p>
<h3 id="Hexo_2-X_升级_3-0">Hexo 2.X 升级 3.0</h3><p>1.做好相关配置文件和文章的备份<br>2.做任何修改前不要忘记第一件事备份</p>
<p><a href="https://github.com/hexojs/hexo/wiki/Migrating-from-2.x-to-3.0" target="_blank" rel="external">https://github.com/hexojs/hexo/wiki/Migrating-from-2.x-to-3.0</a></p>
<h3 id="Hexo_3-0_降级_2-X">Hexo 3.0 降级 2.X</h3><p><a href="http://sandylaw.tk/2015/03/07/hexo3to2/" target="_blank" rel="external">http://sandylaw.tk/2015/03/07/hexo3to2/</a></p>
<h2 id="推荐阅读">推荐阅读</h2><ul>
<li><a href="http://cnfeat.com/2014/05/10/2014-05-11-how-to-build-a-blog/" target="_blank" rel="external">如何搭建一个独立博客——简明Github Pages与Hexo教程</a></li>
<li><a href="http://zipperary.com/categories/hexo/" target="_blank" rel="external">Zippera hexo系列教程</a></li>
<li><a href="http://user.qzone.qq.com/644273006/blog/1418698244" target="_blank" rel="external">前端工程精粹 | 张云龙</a></li>
<li><a href="http://akarin.xyz/build-your-hexo-blog/" target="_blank" rel="external">Hexo 3.0 静态博客使用指南</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[持续更新Hexo的摸索过程，记录生活的点滴]]>
    
    </summary>
    
      <category term="Hexo" scheme="http://wsgzao.github.io/categories/Hexo/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[常用操作系统分享]]></title>
    <link href="http://wsgzao.github.io/post/os/"/>
    <id>http://wsgzao.github.io/post/os/</id>
    <published>2015-09-03T01:53:02.000Z</published>
    <updated>2015-09-03T10:49:16.921Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/5WfE94cd.png" alt=""></p>
<h2 id="前言">前言</h2><p>没有多余的介绍，只是很简单而纯粹的分享平时生活和工作中所需要的部分</p>
<blockquote>
<p>周期性更新稳定、靠谱、经验证的资源</p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年09月03日 - 一大波更新<br>2014年08月26日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/os/" target="_blank" rel="external">http://wsgzao.github.io/post/os/</a></p>
<p>扩展阅读</p>
<p>MSDN  我告诉你 - <a href="http://msdn.itellyou.cn/" target="_blank" rel="external">http://msdn.itellyou.cn/</a><br>无限的未知 - <a href="http://phineas.blog.hexun.com/" target="_blank" rel="external">http://phineas.blog.hexun.com/</a><br>songyongzhi - <a href="http://songyongzhi.blog.163.com/" target="_blank" rel="external">http://songyongzhi.blog.163.com/</a><br>SuSE - <a href="https://www.suse.com/zh-cn/products/server/download/" target="_blank" rel="external">https://www.suse.com/zh-cn/products/server/download/</a><br>CentOS - <a href="http://wiki.centos.org/Download" target="_blank" rel="external">http://wiki.centos.org/Download</a><br>Apps索引 - <a href="http://wsgzao.github.io/index/#Apps" target="_blank" rel="external">http://wsgzao.github.io/index/#Apps</a></p>
<hr>
<h2 id="目录">目录</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">file://G:\OS    (12 folders, 1 files, 338 bytes, 102.85 GB in total.)</span><br><span class="line">│  阅读原文.txt  338 bytes</span><br><span class="line">├─AIX   (1 folders, 0 files, 0 bytes, 2.48 GB in total.)</span><br><span class="line">│  └─AIX 6.1 (0 folders, 3 files, 2.48 GB, 2.48 GB in total.)</span><br><span class="line">│          6100-08-02_v1.iso 375.39 MB</span><br><span class="line">│          6100-08-02_v2.iso 1.81 GB</span><br><span class="line">│          PowerHA 6.1.iso   313.13 MB</span><br><span class="line">├─Drivers   (2 folders, 2 files, 672.26 MB, 5.56 GB in total.)</span><br><span class="line">│  │  3DM游戏运行库合集v2.6.7z   588.57 MB</span><br><span class="line">│  │  DirectX_Repair-V3_3(Enhanced_Edition).zip   83.69 MB</span><br><span class="line">│  ├─GoRuntime_1.6   (0 folders, 4 files, 341.61 MB, 341.61 MB in total.)</span><br><span class="line">│  │      GoRuntime_DirectX_9.0c.zip    28.98 MB</span><br><span class="line">│  │      GoRuntime_DotNetFramework_3.5.zip 127.16 MB</span><br><span class="line">│  │      GoRuntime_DotNetFramework_4.0_4.5.zip 125.19 MB</span><br><span class="line">│  │      GoRuntime_VisualCppRedistributablePackage.zip 60.28 MB</span><br><span class="line">│  └─WanDrv6_6.5.2015.0615_Stable(Rebuild)   (0 folders, 8 files, 4.57 GB, 4.57 GB in total.)</span><br><span class="line">│          WanDrv6_Win7.x64_6.5.2015.0615_Stable(Rebuild)_ITianKong.Net.zip  1.34 GB</span><br><span class="line">│          WanDrv6_Win7.x86_6.5.2015.0615_Stable(Rebuild)_ITianKong.Net.zip  1.03 GB</span><br><span class="line">│          WanDrv6_Win8.x64_6.5.2015.0615_Stable(Rebuild)_ITianKong.Net.zip  1.07 GB</span><br><span class="line">│          WanDrv6_Win8.x86_6.5.2015.0615_Stable(Rebuild)_ITianKong.Net.zip  771.10 MB</span><br><span class="line">│          WanDrv6_WinXP.x86_6.5.2015.0615_Stable(Rebuild)_ITianKong.Net.zip 382.48 MB</span><br><span class="line">│          文件校验工具.exe    28.50 KB</span><br><span class="line">│          文件校验信息.txt    2.17 KB</span><br><span class="line">│          预览图.png   80.90 KB</span><br><span class="line">├─Linux (5 folders, 0 files, 0 bytes, 54.68 GB in total.)</span><br><span class="line">│  ├─CentOS  (2 folders, 0 files, 0 bytes, 12.52 GB in total.)</span><br><span class="line">│  │  ├─6.5   (2 folders, 0 files, 0 bytes, 6.26 GB in total.)</span><br><span class="line">│  │  │  ├─CentOS-6.5-i386-bin-DVD1to2 (0 folders, 2 files, 4.73 GB, 4.73 GB in total.)</span><br><span class="line">│  │  │  │      CentOS-6.6-i386-bin-DVD1.iso  3.75 GB</span><br><span class="line">│  │  │  │      CentOS-6.6-i386-bin-DVD2.iso  0.98 GB</span><br><span class="line">│  │  │  └─CentOS-6.5-x86_64-bin-DVD1to2   (0 folders, 2 files, 1.53 GB, 1.53 GB in total.)</span><br><span class="line">│  │  │          CentOS-6.6-x86_64-bin-DVD1.iso    322.00 MB</span><br><span class="line">│  │  │          CentOS-6.6-x86_64-bin-DVD2.iso    1.21 GB</span><br><span class="line">│  │  └─6.6   (2 folders, 0 files, 0 bytes, 6.26 GB in total.)</span><br><span class="line">│  │      ├─CentOS-6.6-i386-bin-DVD1to2 (0 folders, 7 files, 4.73 GB, 4.73 GB in total.)</span><br><span class="line">│  │      │      0447db1b4f3f1a6cc1d95e6a197021df92be4382.torrent  189.98 KB</span><br><span class="line">│  │      │      CentOS-6.6-i386-bin-DVD1.iso  3.75 GB</span><br><span class="line">│  │      │      CentOS-6.6-i386-bin-DVD2.iso  0.98 GB</span><br><span class="line">│  │      │      md5sum.txt.asc    1.11 KB</span><br><span class="line">│  │      │      README.txt    1.38 KB</span><br><span class="line">│  │      │      sha1sum.txt.asc   1.14 KB</span><br><span class="line">│  │      │      sha256sum.txt.asc 1.23 KB</span><br><span class="line">│  │      └─CentOS-6.6-x86_64-bin-DVD1to2   (0 folders, 7 files, 1.53 GB, 1.53 GB in total.)</span><br><span class="line">│  │              b44059694c011a4249edc8cf0804e738bc046c1e.torrent  221.78 KB</span><br><span class="line">│  │              CentOS-6.6-x86_64-bin-DVD1.iso    322.00 MB</span><br><span class="line">│  │              CentOS-6.6-x86_64-bin-DVD2.iso    1.21 GB</span><br><span class="line">│  │              md5sum.txt.asc    1.12 KB</span><br><span class="line">│  │              README.txt    1.39 KB</span><br><span class="line">│  │              sha1sum.txt.asc   1.15 KB</span><br><span class="line">│  │              sha256sum.txt.asc 1.24 KB</span><br><span class="line">│  ├─OracleLinux (1 folders, 0 files, 0 bytes, 3.62 GB in total.)</span><br><span class="line">│  │  └─6.5_64    (0 folders, 1 files, 3.62 GB, 3.62 GB in total.)</span><br><span class="line">│  │          V41362-01.iso   3.62 GB</span><br><span class="line">│  ├─RedHat  (0 folders, 10 files, 6.84 GB, 10.84 GB in total.)</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7-7.1_Release_Notes-zh-CN.pdf    725.96 KB</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7-安全性指南.pdf  6.62 MB</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7-安装指南.pdf   15.79 MB</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7-迁移规划指南.pdf 528.43 KB</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7-性能调节指南.pdf 1.67 MB</span><br><span class="line">│  │      Red_Hat_Enterprise_Linux-7.1 版本说明.pdf 725.96 KB</span><br><span class="line">│  │      rhel-server-5.11-i386-dvd.iso 3.53 GB</span><br><span class="line">│  │      rhel-server-5.11-x86_64-dvd.iso   143.19 MB</span><br><span class="line">│  │      rhel-server-6.6-x86_64-dvd.iso    3.52 GB</span><br><span class="line">│  │      rhel-server-7.1-x86_64-dvd.iso    3.62 GB</span><br><span class="line">│  ├─SuSE    (2 folders, 0 files, 0 bytes, 26.14 GB in total.)</span><br><span class="line">│  │  ├─11    (4 folders, 0 files, 0 bytes, 23.41 GB in total.)</span><br><span class="line">│  │  │  ├─Auto    (0 folders, 2 files, 2.05 GB, 6.05 GB in total.)</span><br><span class="line">│  │  │  │      SLES11-SP1-64-AUTO.iso    2.89 GB</span><br><span class="line">│  │  │  │      SLES11-SP2-64-AUTO.iso    3.16 GB</span><br><span class="line">│  │  │  ├─SP1 (0 folders, 2 files, 5.52 GB, 5.52 GB in total.)</span><br><span class="line">│  │  │  │      SLES-11-SP1-64-DVD.iso    2.83 GB</span><br><span class="line">│  │  │  │      SLES-11-SP1-DVD-i586-GM-DVD1.iso  2.70 GB</span><br><span class="line">│  │  │  ├─SP2 (0 folders, 2 files, 3.81 GB, 3.81 GB in total.)</span><br><span class="line">│  │  │  │      SLES-11-SP2-DVD-x86_64-GM-DVD1.iso    3.10 GB</span><br><span class="line">│  │  │  │      SLES-11-SP2-DVD-x86_64-GM-DVD2.iso    731.93 MB</span><br><span class="line">│  │  │  └─SP3 (0 folders, 4 files, 4.02 GB, 8.02 GB in total.)</span><br><span class="line">│  │  │          SLES-11-SP3-DVD-i586-GM-DVD1.iso  3.00 GB</span><br><span class="line">│  │  │          SLES-11-SP3-DVD-i586-GM-DVD2.iso  0.94 GB</span><br><span class="line">│  │  │          SLES-11-SP3-DVD-x86_64-GM-DVD1.iso    3.13 GB</span><br><span class="line">│  │  │          SLES-11-SP3-DVD-x86_64-GM-DVD2.iso    0.95 GB</span><br><span class="line">│  │  └─12    (0 folders, 1 files, 2.74 GB, 2.74 GB in total.)</span><br><span class="line">│  │          SLE-12-Server-DVD-x86_64-GM-DVD1.iso    2.74 GB</span><br><span class="line">│  └─Ubuntu  (0 folders, 2 files, 1.55 GB, 1.55 GB in total.)</span><br><span class="line">│          ubuntu-14.04.2-desktop-amd64.iso  0.97 GB</span><br><span class="line">│          ubuntu-14.04.2-server-amd64.iso   595.00 MB</span><br><span class="line">├─Mac   (0 folders, 1 files, 45 bytes, 45 bytes in total.)</span><br><span class="line">│      Mac+Windows双系统制作最新OSX系统安装盘及手动创建恢复分区教程.txt   45 bytes</span><br><span class="line">├─Others    (0 folders, 5 files, 162.34 MB, 162.34 MB in total.)</span><br><span class="line">│      cgi-plus.exe    7.12 MB</span><br><span class="line">│      NTBOOTautofix v2.5.7.rar    711.21 KB</span><br><span class="line">│      onekey_noad.exe 6.45 MB</span><br><span class="line">│      Win8PE.iso  145.19 MB</span><br><span class="line">│      WinNTSetup3.8.1.1.exe   2.89 MB</span><br><span class="line">├─ServerGuide   (0 folders, 2 files, 1.56 GB, 1.56 GB in total.)</span><br><span class="line">│      ibm_utl_sguide_9.30-win2k03-08_anyos_x86-64.iso 789.50 MB</span><br><span class="line">│      ibm_utl_sguide_9.30_anyos_i386.iso  809.82 MB</span><br><span class="line">├─Windows 10    (0 folders, 2 files, 4.03 GB, 4.03 GB in total.)</span><br><span class="line">│      cn_windows_10_enterprise_x64_dvd_6846957.iso    3.88 GB</span><br><span class="line">│      Win10_Pro_VL_x64_2015.08.esd    160.77 MB</span><br><span class="line">├─Windows 2003 R2   (0 folders, 3 files, 4.90 GB, 4.90 GB in total.)</span><br><span class="line">│      Srv_2003_R2_Ent_SP2_2015.08_IE8.gho 1.87 GB</span><br><span class="line">│      W2K3_S_CE.ISO   1.70 GB</span><br><span class="line">│      W2K3_U_CE_IE6.ISO   1.33 GB</span><br><span class="line">├─Windows 2008 R2   (0 folders, 6 files, 7.24 GB, 19.24 GB in total.)</span><br><span class="line">│      2008R2_V4.ISO   1.79 GB</span><br><span class="line">│      cn_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_vl_build_x64_dvd_617396.iso   3.14 GB</span><br><span class="line">│      en_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_vl_build_x64_dvd_617403.iso   2.95 GB</span><br><span class="line">│      Srv_2008_R2_DC+Ent_SP1_2015.5.esd   3.88 GB</span><br><span class="line">│      WIN2008_V3.ISO  3.91 GB</span><br><span class="line">│      Win_Server_08R2_33in1_v1.1-UEFI.ISO 3.58 GB</span><br><span class="line">├─Windows 2012 R2   (0 folders, 1 files, 697.48 MB, 697.48 MB in total.)</span><br><span class="line">│      Srv_2012_R2_DC_2015.5.esd   697.48 MB</span><br><span class="line">├─Windows 7 (0 folders, 5 files, 2.01 GB, 6.01 GB in total.)</span><br><span class="line">│      Win7SP1_Ent_x64_2015.07_intl.esd    1.77 GB</span><br><span class="line">│      win7_ent_x64_201504.iso 228.08 MB</span><br><span class="line">│      Win7SP1_Ultimate_x64_2015.6_4in1.esd    684.28 MB</span><br><span class="line">│      Win7SP1_Ultimate_x86_2015.06_4in1.esd   3.36 GB</span><br><span class="line">│      WinNTSetup3.7.9.exe 2.49 MB</span><br><span class="line">└─Windows XP    (0 folders, 2 files, 3.54 GB, 3.54 GB in total.)</span><br><span class="line">        GhostXP_SP3_EN_2014.9.GHO   1.62 GB</span><br><span class="line">        WinXP_SP3_Full_2015.05_IE8_V2.gho   1.93 GB</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="下载地址">下载地址</h2><p><a href="http://pan.baidu.com/s/1sjPSwrV" target="_blank" rel="external">http://pan.baidu.com/s/1sjPSwrV</a></p>
]]></content>
    <summary type="html">
    <![CDATA[非常简单纯粹OS经验分享]]>
    
    </summary>
    
      <category term="软件 | Soft" scheme="http://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[GFW翻墙小结]]></title>
    <link href="http://wsgzao.github.io/post/fq/"/>
    <id>http://wsgzao.github.io/post/fq/</id>
    <published>2015-08-31T15:22:32.000Z</published>
    <updated>2015-08-31T02:27:56.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/Ur503skA.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>政府无限的权力，都是大部分人自己放弃的。假货坑爹，让政府审核。孩子管不好，让政府关网吧。有人在微博骂我，让政府去删。房价太高，让政府去限购。我们的文化实在太独特，创造出了家长式威权政府，GFW 正是在这种背景下产生的，一个社会矛盾的终极调和器，最终生活不能自理的你每天做的每一件事情都要给政府审查一遍，以免伤害到其他同样生活不能自理的人。这是一个零和游戏，越和这样的用户打交道，越对未来持悲观态度，觉得 GFW 可能永远也不会消失，而墙内的这个局域网看起来还似乎生机勃勃的自成一体，真是让人绝望。</p>
<p>Via <a href="https://twitter.com/clowwindy" target="_blank" rel="external">@clowwindy</a> - <a href="https://www.v2ex.com/t/166417#reply121" target="_blank" rel="external">https://www.v2ex.com/t/166417#reply121</a></p>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月31日 - Thanks @clowwindy &amp; @breakwa11, and all of the contributor of the shadowsocks.<br>2015年08月11日 - 移除GoAgentX，感谢@ohdarling<br>2015年08月06日 - 移除曲径，感谢两位前盛大创新院朋友做出的贡献，尊重你们的决定<br>2015年05月22日 - 移除所有Goagent项目，增加赛风/红杏/Shadowsocks免费账号<br>2015年03月08日 - fqrouter复活，新增免费方案百度浏览器<br>2015年02月07日 - 修改细节描述，避免误导大家<br>2015年02月03日 - 更换网址为f(翻)q(墙)，感谢fqrouter作者做出的贡献<br>2014年11月30日 - 完善内容，标注自用首选免费和付费翻墙方案<br>2014年08月24日 - 新增免费方案GoAgent+，付费方案商业版Shadowsocks<br>2014年06月15日 - 新增Buckyball浏览器，父亲节快乐<br>2014年06月13日 - 补充Mac/iOS方案<br>2014年06月12日 - 撰写初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/fq/" target="_blank" rel="external">http://wsgzao.github.io/post/fq/</a></p>
<p>扩展阅读</p>
<ul>
<li>Contributors - <a href="http://shadowsocks.org/en/about/contributors.html" target="_blank" rel="external">http://shadowsocks.org/en/about/contributors.html</a></li>
<li>科学上网利器 Shadowsocks 使用方法 - <a href="http://ttt.tt/150/" target="_blank" rel="external">http://ttt.tt/150/</a></li>
</ul>
<hr>
<h2 id="简单验证是否被墙">简单验证是否被墙</h2><blockquote>
<p>如果你不能访问以下网址，那恭喜你生活在墙的有效保护区内，关键字智能屏蔽效果如下</p>
</blockquote>
<p><a href="http://wsgzao.github.io/post/gfw-break/" target="_blank" rel="external">http://wsgzao.github.io/post/gfw-break/</a></p>
<hr>
<h2 id="免费方案">免费方案</h2><blockquote>
<p>各个平台的解决方案都不唯一，请认真阅读原文中的说明部分</p>
</blockquote>
<h3 id="百度浏览器">百度浏览器</h3><blockquote>
<p>你这么大摇大摆提供翻墙插件，真不用担心360菊(jǔ)爆(bào)吗？</p>
</blockquote>
<ul>
<li>【首选】看到百度浏览器团队介绍的最后一句话我才明白QQ浏览器为何扶不起</li>
<li>UC浏览器翻墙效果不佳还要背负面临政策风险，所以就不直接推荐了</li>
<li>还有很多通过自行编译或与Chrome/Firefox整合的翻墙方式也不再列举，比如Lantern</li>
</ul>
<p><a href="http://liulanqi.baidu.com/about.html" target="_blank" rel="external">http://liulanqi.baidu.com/about.html</a></p>
<h3 id="Shadowsocks">Shadowsocks</h3><blockquote>
<p>@breakwa11, be careful and stay out of trouble</p>
</blockquote>
<p><a href="https://github.com/breakwa11/shadowsocks-rss/issues/32" target="_blank" rel="external">https://github.com/breakwa11/shadowsocks-rss/issues/32</a></p>
<h3 id="Shadowsocks_免费账号">Shadowsocks 免费账号</h3><blockquote>
<p>感谢ishadowsocks团队分享</p>
</blockquote>
<p><a href="http://www.ishadowsocks.com/" target="_blank" rel="external">http://www.ishadowsocks.com/</a></p>
<h3 id="fqrouter">fqrouter</h3><blockquote>
<p>fqrouter重获新生啦，在设置中勾选测试版即可自动升级</p>
</blockquote>
<ul>
<li>【首选】Android翻墙方案</li>
</ul>
<p><a href="http://www.zdfans.com/4565.html" target="_blank" rel="external">http://www.zdfans.com/4565.html</a></p>
<h3 id="赛风">赛风</h3><blockquote>
<p>作为免费翻墙的一种备用方案吧</p>
</blockquote>
<p><a href="http://www.zdfans.com/4114.html" target="_blank" rel="external">http://www.zdfans.com/4114.html</a></p>
<h3 id="OS_X">OS X</h3><blockquote>
<p>Shadowsocks GUI designed for OS X 10.8+, automatically configuring system proxy settings, with a GFWList PAC.</p>
</blockquote>
<ul>
<li>【首选】OS X翻墙方案</li>
</ul>
<p><a href="https://github.com/shadowsocks/shadowsocks-iOS/releases" target="_blank" rel="external">https://github.com/shadowsocks/shadowsocks-iOS/releases</a></p>
<h3 id="iOS">iOS</h3><blockquote>
<p>shadowsocks client for OSX and non-jailbroken iOS</p>
</blockquote>
<ul>
<li>【首选】iOS翻墙方案</li>
</ul>
<p><a href="https://github.com/shadowsocks/shadowsocks-iOS/releases" target="_blank" rel="external">https://github.com/shadowsocks/shadowsocks-iOS/releases</a></p>
<h3 id="Windows_Phone">Windows Phone</h3><ul>
<li>暂无直接方案，建议使用类似Shadowsocks的<code>Share over LAN</code>功能设置局域网代理</li>
</ul>
<hr>
<h2 id="付费方案">付费方案</h2><blockquote>
<p>请根据自身实际需求，睁大眼睛认真阅读各类网站说明后做出合理的选择</p>
</blockquote>
<h3 id="Shadowsocks商业版">Shadowsocks商业版</h3><blockquote>
<p>轻量级科学上网姿势，改变您的生活体验</p>
</blockquote>
<ul>
<li>【首选】由<a href="http://ttt.tt/about/" target="_blank" rel="external">@Showfom</a>运营</li>
<li>我已经在第一时间入坑高级版至2018年</li>
<li>信任.Trust，以下是我唯一的推荐链接</li>
</ul>
<p><a href="https://portal.shadowsocks.com/aff.php?aff=043" target="_blank" rel="external">https://portal.shadowsocks.com/aff.php?aff=043</a></p>
<h3 id="VPNso">VPNso</h3><blockquote>
<p>稳定靠谱，良好的口碑</p>
</blockquote>
<p><a href="http://www.vpnso.com/" target="_blank" rel="external">http://www.vpnso.com/</a></p>
<h3 id="红杏">红杏</h3><blockquote>
<p>虽然需要依赖Chrome，但毕竟价格便宜，使用起来简单粗暴</p>
</blockquote>
<p><a href="http://help.honx.in/hc/" target="_blank" rel="external">http://help.honx.in/hc/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[介绍简单可信赖的翻墙方案]]>
    
    </summary>
    
      <category term="软件 | Soft" scheme="http://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用ELK(Elasticsearch + Logstash + Kibana) 搭建日志集中分析平台实践]]></title>
    <link href="http://wsgzao.github.io/post/elk/"/>
    <id>http://wsgzao.github.io/post/elk/</id>
    <published>2015-08-31T04:43:14.000Z</published>
    <updated>2015-08-31T07:24:45.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/2Zo3bPa3.png" alt=""></p>
<h2 id="前言">前言</h2><p>Elasticsearch + Logstash + Kibana（ELK）是一套开源的日志管理方案，分析网站的访问情况时我们一般会借助Google/百度/CNZZ等方式嵌入JS做数据统计，但是当网站访问异常或者被攻击时我们需要在后台分析如Nginx的具体日志，而Nginx日志分割/GoAccess/Awstats都是相对简单的单节点解决方案，针对分布式集群或者数据量级较大时会显得心有余而力不足，而ELK的出现可以使我们从容面对新的挑战。</p>
<ul>
<li>Logstash：负责日志的收集，处理和储存</li>
<li>Elasticsearch：负责日志检索和分析</li>
<li>Kibana：负责日志的可视化</li>
</ul>
<blockquote>
<p>ELK(Elasticsearch + Logstash + Kibana) </p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月31日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/elk/" target="_blank" rel="external">http://wsgzao.github.io/post/elk/</a></p>
<p>扩展阅读</p>
<p>CentOS 7.x安装ELK(Elasticsearch+Logstash+Kibana) - <a href="http://www.chenshake.com/centos-install-7-x-elk-elasticsearchlogstashkibana/" target="_blank" rel="external">http://www.chenshake.com/centos-install-7-x-elk-elasticsearchlogstashkibana/</a><br>Centos 6.5 安装nginx日志分析系统 elasticsearch + logstash + redis + kibana  - <a href="http://blog.chinaunix.net/xmlrpc.php?r=blog/article&amp;uid=17291169&amp;id=4898582" target="_blank" rel="external">http://blog.chinaunix.net/xmlrpc.php?r=blog/article&amp;uid=17291169&amp;id=4898582</a><br>logstash-forwarder and grok examples - <a href="https://www.ulyaoth.net/threads/logstash-forwarder-and-grok-examples.32413/" target="_blank" rel="external">https://www.ulyaoth.net/threads/logstash-forwarder-and-grok-examples.32413/</a><br>三斗室 - <a href="http://chenlinux.com/" target="_blank" rel="external">http://chenlinux.com/</a><br>elastic - <a href="https://www.elastic.co/guide" target="_blank" rel="external">https://www.elastic.co/guide</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="组件预览">组件预览</h2><p>JDK - <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a><br>Elasticsearch - <a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="external">https://www.elastic.co/downloads/elasticsearch</a><br>Logstash - <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="external">https://www.elastic.co/downloads/logstash</a><br>Kibana - <a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="external">https://www.elastic.co/downloads/kibana</a><br>redis - <a href="http://redis.io/download" target="_blank" rel="external">http://redis.io/download</a></p>
<h2 id="设置FQDN">设置FQDN</h2><blockquote>
<p>创建SSL证书的时候需要配置FQDN</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#修改hostname</span></span><br><span class="line">cat /etc/hostname</span><br><span class="line">elk</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改hosts</span></span><br><span class="line">cat /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::<span class="number">1</span>         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> <span class="number">10</span>-<span class="number">10</span>-<span class="number">87</span>-<span class="number">19</span></span><br><span class="line"><span class="number">10.10</span>.<span class="number">87.19</span> elk.ooxx.com elk</span><br><span class="line"></span><br><span class="line"><span class="comment">#刷新环境</span></span><br><span class="line">hostname -F /etc/hostname</span><br><span class="line"></span><br><span class="line"><span class="comment">#复查结果</span></span><br><span class="line">hostname <span class="operator">-f</span></span><br><span class="line">elk.ooxx.com</span><br><span class="line"></span><br><span class="line">hostname</span><br><span class="line">elk</span><br></pre></td></tr></table></figure>
<h2 id="服务端">服务端</h2><h3 id="Java">Java</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/redhat-release</span><br><span class="line">CentOS release <span class="number">6.5</span> (Final)</span><br><span class="line"></span><br><span class="line">yum install java-<span class="number">1.7</span>.<span class="number">0</span>-openjdk</span><br><span class="line">java -version</span><br><span class="line"></span><br><span class="line">java version <span class="string">"1.7.0_85"</span></span><br><span class="line">OpenJDK Runtime Environment (rhel-<span class="number">2.6</span>.<span class="number">1.3</span>.el6_6-x86_64 u85-b01)</span><br><span class="line">OpenJDK <span class="number">64</span>-Bit Server VM (build <span class="number">24.85</span>-b03, mixed mode)</span><br></pre></td></tr></table></figure>
<h3 id="Elasticsearch">Elasticsearch</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#下载安装</span></span><br><span class="line">wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-<span class="number">1.7</span>.<span class="number">1</span>.noarch.rpm</span><br><span class="line">yum localinstall elasticsearch-<span class="number">1.7</span>.<span class="number">1</span>.noarch.rpm </span><br><span class="line"></span><br><span class="line"><span class="comment">#启动相关服务</span></span><br><span class="line">service elasticsearch start</span><br><span class="line">service elasticsearch status</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看Elasticsearch的配置文件</span></span><br><span class="line">rpm -qc elasticsearch</span><br><span class="line"></span><br><span class="line">/etc/elasticsearch/elasticsearch.yml</span><br><span class="line">/etc/elasticsearch/logging.yml</span><br><span class="line">/etc/init.d/elasticsearch</span><br><span class="line">/etc/sysconfig/elasticsearch</span><br><span class="line">/usr/lib/sysctl.d/elasticsearch.conf</span><br><span class="line">/usr/lib/systemd/system/elasticsearch.service</span><br><span class="line">/usr/lib/tmpfiles.d/elasticsearch.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看端口使用情况</span></span><br><span class="line">netstat -nltp</span><br><span class="line"></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9200</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9300</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">22</span>                  <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1509</span>/sshd           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> :::<span class="number">22</span>                       :::*                        LISTEN      <span class="number">1509</span>/sshd  </span><br><span class="line"></span><br><span class="line"><span class="comment">#测试访问</span></span><br><span class="line">curl -X GET http://localhost:<span class="number">9200</span>/</span><br></pre></td></tr></table></figure>
<h3 id="Kibana">Kibana</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#下载tar包</span></span><br><span class="line">wget https://download.elastic.co/kibana/kibana/kibana-<span class="number">4.1</span>.<span class="number">1</span>-linux-x64.tar.gz</span><br><span class="line"><span class="comment">#解压</span></span><br><span class="line">tar zxf kibana-<span class="number">4.1</span>.<span class="number">1</span>-linux-x64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/</span><br><span class="line">mv kibana-<span class="number">4.1</span>.<span class="number">1</span>-linux-x64 kibana</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建kibana服务</span></span><br><span class="line">vi /etc/rc.d/init.d/kibana</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          kibana</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: Runs kibana daemon</span></span><br><span class="line"><span class="comment"># Description: Runs the kibana daemon as a non-root user</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Process name</span></span><br><span class="line">NAME=kibana</span><br><span class="line">DESC=<span class="string">"Kibana4"</span></span><br><span class="line">PROG=<span class="string">"/etc/init.d/kibana"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure location of Kibana bin</span></span><br><span class="line">KIBANA_BIN=/usr/<span class="built_in">local</span>/kibana/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># PID Info</span></span><br><span class="line">PID_FOLDER=/var/run/kibana/</span><br><span class="line">PID_FILE=/var/run/kibana/<span class="variable">$NAME</span>.pid</span><br><span class="line">LOCK_FILE=/var/lock/subsys/<span class="variable">$NAME</span></span><br><span class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin:<span class="variable">$KIBANA_BIN</span></span><br><span class="line">DAEMON=<span class="variable">$KIBANA_BIN</span>/<span class="variable">$NAME</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure User to run daemon process</span></span><br><span class="line">DAEMON_USER=root</span><br><span class="line"><span class="comment"># Configure logging location</span></span><br><span class="line">KIBANA_LOG=/var/<span class="built_in">log</span>/kibana.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># Begin Script</span></span><br><span class="line">RETVAL=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ `id -u` <span class="operator">-ne</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"You need root privileges to run this script"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Function library</span></span><br><span class="line">. /etc/init.d/<span class="built_in">functions</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"Starting <span class="variable">$DESC</span> : "</span></span><br><span class="line"></span><br><span class="line">pid=`pidofproc -p <span class="variable">$PID_FILE</span> kibana`</span><br><span class="line">        <span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">"Already running."</span></span><br><span class="line">                <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="comment"># Start Daemon</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$PID_FOLDER</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">                        mkdir <span class="variable">$PID_FOLDER</span></span><br><span class="line">                <span class="keyword">fi</span></span><br><span class="line">daemon --user=<span class="variable">$DAEMON_USER</span> --pidfile=<span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span> <span class="number">1</span>&gt;<span class="string">"<span class="variable">$KIBANA_LOG</span>"</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line">                sleep <span class="number">2</span></span><br><span class="line">                pidofproc node &gt; <span class="variable">$PID_FILE</span></span><br><span class="line">                RETVAL=$?</span><br><span class="line">                [[ $? <span class="operator">-eq</span> <span class="number">0</span> ]] &amp;&amp; success || failure</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">                [ <span class="variable">$RETVAL</span> = <span class="number">0</span> ] &amp;&amp; touch <span class="variable">$LOCK_FILE</span></span><br><span class="line">                <span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">reload</span></span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Reload command is not implemented for this service."</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$RETVAL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">"Stopping <span class="variable">$DESC</span> : "</span></span><br><span class="line">        killproc -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></span><br><span class="line">        RETVAL=$?</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">        [ <span class="variable">$RETVAL</span> = <span class="number">0</span> ] &amp;&amp; rm <span class="operator">-f</span> <span class="variable">$PID_FILE</span> <span class="variable">$LOCK_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">  start)</span><br><span class="line">        start</span><br><span class="line">;;</span><br><span class="line">  stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">  status)</span><br><span class="line">        status -p <span class="variable">$PID_FILE</span> <span class="variable">$DAEMON</span></span><br><span class="line">        RETVAL=$?</span><br><span class="line">        ;;</span><br><span class="line">  restart)</span><br><span class="line">        stop</span><br><span class="line">        start</span><br><span class="line">        ;;</span><br><span class="line">  reload)</span><br><span class="line">reload</span><br><span class="line">;;</span><br><span class="line">  *)</span><br><span class="line"><span class="comment"># Invalid Arguments, print the following message.</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart&#125;"</span> &gt;&amp;<span class="number">2</span></span><br><span class="line"><span class="built_in">exit</span> <span class="number">2</span></span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改启动权限</span></span><br><span class="line">chmod +x /etc/rc.d/init.d/kibana</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动kibana服务</span></span><br><span class="line">service kibana start</span><br><span class="line">service kibana status</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看端口</span></span><br><span class="line">netstat -nltp</span><br><span class="line"></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9200</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9300</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">22</span>                  <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1509</span>/sshd           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5601</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1876</span>/node           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> :::<span class="number">22</span>                       :::*                        LISTEN      <span class="number">1509</span>/sshd</span><br></pre></td></tr></table></figure>
<h3 id="Logstash">Logstash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#下载rpm包</span></span><br><span class="line">wget https://download.elastic.co/logstash/logstash/packages/centos/logstash-<span class="number">1.5</span>.<span class="number">4</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line"><span class="comment">#安装</span></span><br><span class="line">yum localinstall logstash-<span class="number">1.5</span>.<span class="number">4</span>-<span class="number">1</span>.noarch.rpm </span><br><span class="line"></span><br><span class="line"><span class="comment">#设置ssl，之前设置的FQDN是elk.ooxx.com</span></span><br><span class="line"><span class="built_in">cd</span> /etc/pki/tls</span><br><span class="line"><span class="comment">#openssl req -x509  -batch -nodes -newkey rsa:2048 -keyout lumberjack.key -out lumberjack.crt -subj /CN=logstash.example.com</span></span><br><span class="line">openssl req -subj <span class="string">'/CN=elk.ooxx.com/'</span> -x509 -days <span class="number">3650</span> -batch -nodes -newkey rsa:<span class="number">2048</span> -keyout private/logstash-forwarder.key -out certs/logstash-forwarder.crt</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#创建一个01-logstash-initial.conf文件</span></span><br><span class="line">cat &gt; /etc/logstash/conf.d/<span class="number">01</span>-logstash-initial.conf &lt;&lt; EOF</span><br><span class="line">input &#123;</span><br><span class="line">  lumberjack &#123;</span><br><span class="line">    port =&gt; <span class="number">5000</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; <span class="string">"logs"</span></span><br><span class="line">    ssl_certificate =&gt; <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span></span><br><span class="line">    ssl_key =&gt; <span class="string">"/etc/pki/tls/private/logstash-forwarder.key"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"syslog"</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;GREEDYDATA:syslog_message&#125;"</span> &#125;</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_at"</span>, <span class="string">"%&#123;@timestamp&#125;"</span> ]</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_from"</span>, <span class="string">"%&#123;host&#125;"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    syslog_pri &#123; &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      match =&gt; [ <span class="string">"syslog_timestamp"</span>, <span class="string">"MMM  d HH:mm:ss"</span>, <span class="string">"MMM dd HH:mm:ss"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; host =&gt; localhost &#125;</span><br><span class="line">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动logstash服务</span></span><br><span class="line">service logstash start</span><br><span class="line">service logstash status</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看5000端口</span></span><br><span class="line">netstat -nltp</span><br><span class="line"></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9200</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9300</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1765</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">9301</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">2309</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">22</span>                  <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1509</span>/sshd           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5601</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">1876</span>/node           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">5000</span>                <span class="number">0.0</span>.<span class="number">0.0</span>:*                   LISTEN      <span class="number">2309</span>/java           </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> :::<span class="number">22</span>                       :::*                        LISTEN      <span class="number">1509</span>/sshd  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务</span></span><br><span class="line">service logstash-forwarder start</span><br><span class="line">service logstash-forwarder status</span><br><span class="line"></span><br><span class="line"><span class="comment">#访问Kibana，Time-field name 选择 @timestamp</span></span><br><span class="line">http://localhost:<span class="number">5601</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加节点和客户端配置一样，注意同步证书</span></span><br><span class="line">/etc/pki/tls/certs/logstash-forwarder.crt</span><br></pre></td></tr></table></figure>
<h2 id="客户端">客户端</h2><h3 id="Logstash_Forwarder">Logstash Forwarder</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#登陆到客户端，安装Logstash Forwarder</span></span><br><span class="line">wget https://download.elastic.co/logstash-forwarder/binaries/logstash-forwarder-<span class="number">0.4</span>.<span class="number">0</span>-<span class="number">1</span>.x86_64.rpm</span><br><span class="line">yum localinstall logstash-forwarder-<span class="number">0.4</span>.<span class="number">0</span>-<span class="number">1</span>.x86_64.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看logstash-forwarder的配置文件位置</span></span><br><span class="line">rpm -qc logstash-forwarder</span><br><span class="line">/etc/logstash-forwarder.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份配置文件</span></span><br><span class="line">cp /etc/logstash-forwarder.conf /etc/logstash-forwarder.conf.save</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑 /etc/logstash-forwarder.conf，需要根据实际情况进行修改</span></span><br><span class="line"></span><br><span class="line">cat &gt; /etc/logstash-forwarder.conf &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"network"</span>: &#123;</span><br><span class="line">    <span class="string">"servers"</span>: [ <span class="string">"elk.ooxx.com:5000"</span> ],</span><br><span class="line"></span><br><span class="line">    <span class="string">"ssl ca"</span>: <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"timeout"</span>: <span class="number">15</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"paths"</span>: [</span><br><span class="line">        <span class="string">"/var/log/messages"</span>,</span><br><span class="line">        <span class="string">"/var/log/secure"</span></span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      <span class="string">"fields"</span>: &#123; <span class="string">"type"</span>: <span class="string">"syslog"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="配置Nginx日志策略">配置Nginx日志策略</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#修改客户端配置</span></span><br><span class="line">vi /etc/logstash-forwarder.conf</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"network"</span>: &#123;</span><br><span class="line">    <span class="string">"servers"</span>: [ <span class="string">"elk.ooxx.com:5000"</span> ],</span><br><span class="line"></span><br><span class="line">    <span class="string">"ssl ca"</span>: <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"timeout"</span>: <span class="number">15</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"paths"</span>: [</span><br><span class="line">        <span class="string">"/var/log/messages"</span>,</span><br><span class="line">        <span class="string">"/var/log/secure"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"fields"</span>: &#123; <span class="string">"type"</span>: <span class="string">"syslog"</span> &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="string">"paths"</span>: [</span><br><span class="line">        <span class="string">"/app/local/nginx/logs/access.log"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"fields"</span>: &#123; <span class="string">"type"</span>: <span class="string">"nginx"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端增加patterns</span></span><br><span class="line">mkdir /opt/logstash/patterns</span><br><span class="line">vi /opt/logstash/patterns/nginx</span><br><span class="line"></span><br><span class="line">NGUSERNAME [a-zA-Z\.\@\-\+_%]+</span><br><span class="line">NGUSER %&#123;NGUSERNAME&#125;</span><br><span class="line">NGINXACCESS %&#123;IPORHOST:remote_addr&#125; - - \[%&#123;HTTPDATE:time_<span class="built_in">local</span>&#125;\] <span class="string">"%&#123;WORD:method&#125; %&#123;URIPATH:path&#125;(?:%&#123;URIPARAM:param&#125;)? HTTP/%&#123;NUMBER:httpversion&#125;"</span> %&#123;INT:status&#125; %&#123;INT:body_bytes_sent&#125; %&#123;QS:http_referer&#125; %&#123;QS:http_user_agent&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#官网pattern的debug在线工具</span></span><br><span class="line">https://grokdebug.herokuapp.com/</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改logstash权限</span></span><br><span class="line">chown -R logstash:logstash /opt/logstash/patterns</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改服务端配置</span></span><br><span class="line">vi /etc/logstash/conf.d/<span class="number">01</span>-logstash-initial.conf </span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">  lumberjack &#123;</span><br><span class="line">    port =&gt; <span class="number">5000</span></span><br><span class="line">    <span class="built_in">type</span> =&gt; <span class="string">"logs"</span></span><br><span class="line">    ssl_certificate =&gt; <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span></span><br><span class="line">    ssl_key =&gt; <span class="string">"/etc/pki/tls/private/logstash-forwarder.key"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"syslog"</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;GREEDYDATA:syslog_message&#125;"</span> &#125;</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_at"</span>, <span class="string">"%&#123;@timestamp&#125;"</span> ]</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_from"</span>, <span class="string">"%&#123;host&#125;"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    syslog_pri &#123; &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      match =&gt; [ <span class="string">"syslog_timestamp"</span>, <span class="string">"MMM  d HH:mm:ss"</span>, <span class="string">"MMM dd HH:mm:ss"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> [<span class="built_in">type</span>] == <span class="string">"nginx"</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">       match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;NGINXACCESS&#125;"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; host =&gt; localhost &#125;</span><br><span class="line">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="其它注意事项">其它注意事项</h2><h3 id="修改kibana端口">修改kibana端口</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑kibana.yaml</span></span><br><span class="line">vi /usr/<span class="built_in">local</span>/kibana/config/kibana.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana is served by a back end server. This controls which port to use.</span></span><br><span class="line"><span class="comment">#port: 5601</span></span><br><span class="line">port: <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The host to bind the server to.</span></span><br><span class="line">host: <span class="string">"0.0.0.0"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Elasticsearch instance to use for all your queries.</span></span><br><span class="line">elasticsearch_url: <span class="string">"http://localhost:9200"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,</span></span><br><span class="line"><span class="comment"># then the host you use to connect to *this* Kibana instance will be sent.</span></span><br><span class="line">elasticsearch_preserve_host: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kibana uses an index in Elasticsearch to store saved searches, visualizations</span></span><br><span class="line"><span class="comment"># and dashboards. It will create a new index if it doesn't already exist.</span></span><br><span class="line">kibana_index: <span class="string">".kibana"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If your Elasticsearch is protected with basic auth, this is the user credentials</span></span><br><span class="line"><span class="comment"># used by the Kibana server to perform maintence on the kibana_index at statup. Your Kibana</span></span><br><span class="line"><span class="comment"># users will still need to authenticate with Elasticsearch (which is proxied thorugh</span></span><br><span class="line"><span class="comment"># the Kibana server)</span></span><br><span class="line"><span class="comment"># kibana_elasticsearch_username: user</span></span><br><span class="line"><span class="comment"># kibana_elasticsearch_password: pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If your Elasticsearch requires client certificate and key</span></span><br><span class="line"><span class="comment"># kibana_elasticsearch_client_crt: /path/to/your/client.crt</span></span><br><span class="line"><span class="comment"># kibana_elasticsearch_client_key: /path/to/your/client.key</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you need to provide a CA certificate for your Elasticsarech instance, put</span></span><br><span class="line"><span class="comment"># the path of the pem file here.</span></span><br><span class="line"><span class="comment"># ca: /path/to/your/CA.pem</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default application to load.</span></span><br><span class="line">default_app_id: <span class="string">"discover"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for elasticsearch to respond to pings, defaults to</span></span><br><span class="line"><span class="comment"># request_timeout setting</span></span><br><span class="line"><span class="comment"># ping_timeout: 1500</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for responses from the back end or elasticsearch.</span></span><br><span class="line"><span class="comment"># This must be &gt; 0</span></span><br><span class="line">request_timeout: <span class="number">300000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds for Elasticsearch to wait for responses from shards.</span></span><br><span class="line"><span class="comment"># Set to 0 to disable.</span></span><br><span class="line">shard_timeout: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying</span></span><br><span class="line"><span class="comment"># startup_timeout: 5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set to false to have a complete disregard for the validity of the SSL</span></span><br><span class="line"><span class="comment"># certificate.</span></span><br><span class="line">verify_ssl: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SSL for outgoing requests from the Kibana Server (PEM formatted)</span></span><br><span class="line"><span class="comment"># ssl_key_file: /path/to/your/server.key</span></span><br><span class="line"><span class="comment"># ssl_cert_file: /path/to/your/server.crt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the path to where you would like the process id file to be created.</span></span><br><span class="line"><span class="comment"># pid_file: /var/run/kibana.pid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you would like to send the log output to a file you can set the path below.</span></span><br><span class="line"><span class="comment"># This will also turn off the STDOUT log output.</span></span><br><span class="line"><span class="comment"># log_file: ./kibana.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plugins that are included in the build, and no longer found in the plugins/ folder</span></span><br><span class="line">bundled_plugin_ids:</span><br><span class="line"> - plugins/dashboard/index</span><br><span class="line"> - plugins/discover/index</span><br><span class="line"> - plugins/doc/index</span><br><span class="line"> - plugins/kibana/index</span><br><span class="line"> - plugins/markdown_vis/index</span><br><span class="line"> - plugins/metric_vis/index</span><br><span class="line"> - plugins/settings/index</span><br><span class="line"> - plugins/table_vis/index</span><br><span class="line"> - plugins/vis_types/index</span><br><span class="line"> - plugins/visualize/index</span><br></pre></td></tr></table></figure>
<h3 id="JVM调优">JVM调优</h3><pre><code class="bash"><span class="comment">#修改elasticsearch.in.sh</span>
vi /usr/share/elasticsearch/bin/elasticsearch.in.sh

<span class="keyword">if</span> [ <span class="string">"x<span class="variable">$ES_MIN_MEM</span>"</span> = <span class="string">"x"</span> ]; <span class="keyword">then</span>
    ES_MIN_MEM=<span class="number">1</span>g
<span class="keyword">fi</span>
<span class="keyword">if</span> [ <span class="string">"x<span class="variable">$ES_MAX_MEM</span>"</span> = <span class="string">"x"</span> ]; <span class="keyword">then</span>
    ES_MAX_MEM=<span class="number">1</span>g
</code></pre>
]]></content>
    <summary type="html">
    <![CDATA[ELK(Elasticsearch + Logstash + Kibana)]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用GoAccess分析Nginx日志以及sed/awk手动分析实践]]></title>
    <link href="http://wsgzao.github.io/post/goaccess/"/>
    <id>http://wsgzao.github.io/post/goaccess/</id>
    <published>2015-08-31T02:48:05.000Z</published>
    <updated>2015-08-31T06:29:30.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://www.goaccess.io/images/goaccess-html-report.png" alt=""></p>
<h2 id="前言">前言</h2><p>使用Nginx的网站可能会遇到访问流量异常、被友情检测、程序出现Bug等各种突然情况，这时大家的反应想必都是第一时间分析日志，然后发现日志有几十GB之多，又需要按照时间、错误类型或者关键字段检索信息时会不会有种醍醐灌顶、菊花一紧的错觉。文中介绍的方法不管是GoAccess还是sed/awk虽然可以解决一时的问题但未必能够治本，也许<code>ELK(Logstash+ElasticSearch+Kibana)</code>对我们大多数人来说是更合理的集中化日志管理解决方案。</p>
<blockquote>
<p>日志固然重要，但努力建设适合业务发展的集中化日志管理平台才是基础核心</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月31日 - 增加Nginx日志按时间分割<br>2015年07月16日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/goaccess/" target="_blank" rel="external">http://wsgzao.github.io/post/goaccess/</a></p>
<p>扩展阅读</p>
<p>GoAccess - <a href="http://goaccess.io/" target="_blank" rel="external">http://goaccess.io/</a><br>用GoAccess分析Nginx的日志 - <a href="http://www.fancycoding.com/log-analyse-using-goaccess/" target="_blank" rel="external">http://www.fancycoding.com/log-analyse-using-goaccess/</a><br>sed 简明教程 - <a href="http://coolshell.cn/articles/9104.html" target="_blank" rel="external">http://coolshell.cn/articles/9104.html</a><br>AWK 简明教程 - <a href="http://coolshell.cn/articles/9070.html" target="_blank" rel="external">http://coolshell.cn/articles/9070.html</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="安装GoAccess">安装GoAccess</h2><blockquote>
<p>各平台都有灰常简单的部署方案 - <a href="http://goaccess.io/download" target="_blank" rel="external">http://goaccess.io/download</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://tar.goaccess.io/goaccess-<span class="number">0.9</span>.<span class="number">2</span>.tar.gz</span><br><span class="line">tar -xzvf goaccess-<span class="number">0.9</span>.<span class="number">2</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> goaccess-<span class="number">0.9</span>.<span class="number">2</span>/</span><br><span class="line">./configure --enable-utf8</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h2 id="使用方式">使用方式</h2><blockquote>
<p>更多常见问题请参考官方FAQ - <a href="http://goaccess.io/faq" target="_blank" rel="external">http://goaccess.io/faq</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#直接打开</span></span><br><span class="line">goaccess <span class="operator">-f</span> access.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#选择日志格式</span></span><br><span class="line">NCSA Combined Log Format</span><br><span class="line"></span><br><span class="line"><span class="comment">#剩下的操作都蛮简单的，参考扩展阅读和官方文档吧</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导出HTML报告会遇到的问题</span></span><br><span class="line">goaccess <span class="operator">-f</span> time_access.log <span class="operator">-a</span> &gt; report.html</span><br><span class="line"></span><br><span class="line">GoAccess - version <span class="number">0.9</span>.<span class="number">2</span> - Jul <span class="number">15</span> <span class="number">2015</span> <span class="number">16</span>:<span class="number">23</span>:<span class="number">20</span></span><br><span class="line">Config file: /usr/<span class="built_in">local</span>/etc/goaccess.conf</span><br><span class="line"></span><br><span class="line">Fatal error has occurred</span><br><span class="line">Error occured at: src/parser.c - verify_formats - <span class="number">1691</span></span><br><span class="line">No time format was found on your conf file.</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加配置文件</span></span><br><span class="line">vi ~/.goaccessrc</span><br><span class="line"></span><br><span class="line">time-format %T</span><br><span class="line">date-format %d/%b/%Y</span><br><span class="line"><span class="built_in">log</span>-format %h %^[%d:%t %^] <span class="string">"%r"</span> %s %b <span class="string">"%R"</span> <span class="string">"%u"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新指定配置文件后执行</span></span><br><span class="line">goaccess <span class="operator">-f</span> time_access.log -p ~/.goaccessrc <span class="operator">-a</span> &gt; report.html</span><br></pre></td></tr></table></figure>
<h2 id="使用bash/sed/awk手动查找Nginx日志">使用bash/sed/awk手动查找Nginx日志</h2><blockquote>
<p>更多技巧可以参考扩展阅读，Python的处理效率或者更优</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#按日期查找时间段</span></span><br><span class="line">sed -n <span class="string">"/30\/Aug\/2015:00:00:01/,/30\/Aug\/2015:23:59:59/"</span>p access.log &gt; time_access.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找504错误的页面和数量</span></span><br><span class="line">awk <span class="string">'($9 ~ /504/)'</span> time_access.log | awk <span class="string">'&#123;print $7&#125;'</span> | sort | uniq -c | sort -rn &gt; <span class="number">504</span>.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#查找访问最多的20个IP及访问次数</span></span><br><span class="line">awk <span class="string">'&#123;print $1&#125;'</span> time_access.log | sort | uniq -c | sort -n -k <span class="number">1</span> -r | head -n <span class="number">20</span> &gt; top.log</span><br></pre></td></tr></table></figure>
<h2 id="Nginx日志按时间分割">Nginx日志按时间分割</h2><blockquote>
<p>这个脚本可以作为通用模板，其它业务需求也可以参照</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#增加自定义脚本</span></span><br><span class="line">vi nginx_log.sh</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment">#设置crontab -e为每日凌晨3点</span></span><br><span class="line"><span class="comment">#0 3 * * * /root/OMCS/script/nginx_log.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ngix_i <span class="keyword">in</span> `ls /app/<span class="built_in">local</span>`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">     <span class="comment">#设置临时变量</span></span><br><span class="line">     nginx_dir=`basename <span class="variable">$&#123;ngix_i&#125;</span>`</span><br><span class="line">     <span class="keyword">if</span> ( <span class="built_in">echo</span> <span class="string">"<span class="variable">$nginx_dir</span>"</span>|grep <span class="string">"nginx"</span> &gt; /dev/null ); <span class="keyword">then</span></span><br><span class="line">          <span class="comment"># echo $nginx_dir</span></span><br><span class="line">          <span class="comment">#设置日志文件存放目录</span></span><br><span class="line">          logs_path=<span class="string">"/app/local/<span class="variable">$nginx_dir</span>/logs/"</span></span><br><span class="line">          <span class="comment">#设置备份日志存放目录</span></span><br><span class="line">          logs_bak=<span class="string">"/app/local/<span class="variable">$nginx_dir</span>/logs/bak/"</span></span><br><span class="line">          <span class="comment">#设置pid文件</span></span><br><span class="line">          pid_path=<span class="string">"/app/local/<span class="variable">$nginx_dir</span>/logs/nginx.pid"</span></span><br><span class="line">         </span><br><span class="line">          <span class="comment">#判断目录是否存在</span></span><br><span class="line">          <span class="keyword">if</span>  [ ! <span class="operator">-d</span>  <span class="string">"<span class="variable">$logs_path</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">               <span class="built_in">continue</span></span><br><span class="line">          <span class="keyword">fi</span></span><br><span class="line">          <span class="comment">#判断文件是否存在</span></span><br><span class="line">          <span class="keyword">if</span>  [ ! <span class="operator">-e</span>  <span class="string">"<span class="variable">$pid_path</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">               <span class="built_in">continue</span></span><br><span class="line">          <span class="keyword">fi</span></span><br><span class="line">         </span><br><span class="line">          <span class="comment">#判断目录是否存在</span></span><br><span class="line">          <span class="keyword">if</span>  [ ! <span class="operator">-d</span>  <span class="string">"<span class="variable">$logs_bak</span>"</span> ]; <span class="keyword">then</span> </span><br><span class="line">               mkdir -p <span class="string">"<span class="variable">$logs_bak</span>"</span> </span><br><span class="line">          <span class="keyword">fi</span> </span><br><span class="line">         </span><br><span class="line">          <span class="built_in">cd</span> <span class="variable">$&#123;logs_path&#125;</span></span><br><span class="line">          logfiles=(`ls *.log`)</span><br><span class="line"></span><br><span class="line">          array_i=<span class="number">0</span></span><br><span class="line">          <span class="comment">#迁移日志循环模块</span></span><br><span class="line">          <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;logfiles[@]&#125;</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">               <span class="comment">#设置临时变量</span></span><br><span class="line">               j=`basename <span class="variable">$&#123;i&#125;</span>`</span><br><span class="line">               <span class="comment">#重命名并迁移日志文件</span></span><br><span class="line">               baklogname=<span class="variable">$&#123;j&#125;</span>_$(date <span class="operator">-d</span> <span class="string">"yesterday"</span> +<span class="string">"%Y%m%d%H%M%S"</span>)</span><br><span class="line">               baklognames[<span class="variable">$array_i</span>]=<span class="variable">$baklogname</span></span><br><span class="line">               mv <span class="variable">$&#123;i&#125;</span> <span class="variable">$&#123;logs_bak&#125;</span><span class="variable">$&#123;baklogname&#125;</span></span><br><span class="line">               array_i=`expr <span class="variable">$array_i</span> + <span class="number">1</span>`</span><br><span class="line">          <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">#向nginx主进程发信号重新打开日志</span></span><br><span class="line">          <span class="built_in">kill</span> -USR1 `cat <span class="variable">$&#123;pid_path&#125;</span>`</span><br><span class="line">         </span><br><span class="line">          <span class="built_in">cd</span> <span class="variable">$&#123;logs_bak&#125;</span></span><br><span class="line">          <span class="comment">#压缩日志循环模块</span></span><br><span class="line">          <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$&#123;baklognames[@]&#125;</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">               <span class="comment">#压缩并删除原日志</span></span><br><span class="line">               tar -zcvf <span class="variable">$&#123;i&#125;</span>.tar.gz <span class="variable">$&#123;i&#125;</span> --remove-files &gt; /dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">          <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">#清理7天前的日志</span></span><br><span class="line">          find <span class="variable">$&#123;logs_bak&#125;</span> -name <span class="string">'*'</span>  -mtime +<span class="number">90</span> | xargs rm -rf &#123;&#125;</span><br><span class="line">             </span><br><span class="line">     <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#增加执行权限</span></span><br><span class="line">chmod u+x nginx_log.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置crontab -e为每日凌晨3点</span></span><br><span class="line">crontab <span class="operator">-e</span></span><br><span class="line"></span><br><span class="line"><span class="number">0</span> <span class="number">3</span> * * * /root/OMCS/script/nginx_log.sh</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[日志固然重要，但努力建设适合业务发展的集中化日志管理平台才是基础核心]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[乔布斯在斯坦福大学毕业典礼上的演讲]]></title>
    <link href="http://wsgzao.github.io/post/stay-hungry-stay-foolish/"/>
    <id>http://wsgzao.github.io/post/stay-hungry-stay-foolish/</id>
    <published>2015-08-26T10:43:14.000Z</published>
    <updated>2015-08-27T01:11:08.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/R0AsTZ14.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>也许99%的朋友听过<code>Stay Hungry, Stay Foolish</code>这句话，其中90%的人知道乔布斯说过这句话，但很可能仅有10%的人完整看过乔布斯在2005年斯坦福大学毕业典礼上的演讲视频。虽然视频只有15分钟时长，但其中3个小故事放在今日依旧值得深思。感谢<code>@阮一峰</code>不断更新译文，同时也希望擅长字幕的同学在百忙之中重新制作一份高清双字幕视频，让更多的朋友了解完整的内容，重拾经典。</p>
<blockquote>
<p>Stay Hungry, Stay Foolish</p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月26日 - 转载初稿，感谢@阮一峰，整合Youtube Stanford官方原版超清视频</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/stay-hungry-stay-foolish/" target="_blank" rel="external">http://wsgzao.github.io/post/stay-hungry-stay-foolish/</a></p>
<p>扩展阅读</p>
<ul>
<li>乔布斯在斯坦福大学毕业典礼上的演讲 - <a href="http://www.ruanyifeng.com/docs/speech/steve_jobs.html" target="_blank" rel="external">http://www.ruanyifeng.com/docs/speech/steve_jobs.html</a></li>
<li>Steve Jobs’ 2005 Stanford Commencement Address - <a href="https://www.youtube.com/watch?v=Hd_ptbiPoXM" target="_blank" rel="external">https://www.youtube.com/watch?v=Hd_ptbiPoXM</a></li>
</ul>
<hr>
<h2 id="原版视频">原版视频</h2><blockquote>
<p>希望字幕组的朋友帮帮忙，需要重新剪辑和中英字幕校对，我会提供超清视频原始素材，先在此谢过啦。</p>
</blockquote>
<script type="text/javascript"> var letvcloud_player_conf =  {"uu":"v03kdsemua","vu":"3f4896da40","auto_play":0,"gpcflag":1,"width":640,"height":360};</script><script type="text/javascript" src="http://yuntv.letv.com/bcloud.js"></script>


<h2 id="中英译文">中英译文</h2><p>译者：阮一峰<br>（时间：2005年6月12日）</p>
<p>I am honored to be with you today at your commencement from one of the finest universities in the world. I never graduated from college. Truth be told, this is the closest I’ve ever gotten to a college graduation. Today I want to tell you three stories from my life. That’s it. No big deal. Just three stories.<br>今天，我很荣幸和大家在一起，参加这个世界上最好的大学之一的毕业典礼。我从没有大学毕业。说实话，这是迄今为止我最接近大学毕业的一天。今天我要向你们讲我人生中的三个故事。不是什么大事，只是三个小故事而已。</p>
<p>The first story is about connecting the dots.<br>第一个故事讲的是，把生命中的点连接起来。.</p>
<p>I dropped out of Reed College after the first 6 months, but then stayed around as a drop-in for another 18 months or so before I really quit. So why did I drop out?<br>我在Reed大学读了六个月之后就退学了，但是又在校园里旁听了十八个月左右，然后才真正离开。我为什么要退学呢？</p>
<p>It started before I was born. My biological mother was a young, unwed college graduate student, and she decided to put me up for adoption. She felt very strongly that I should be adopted by college graduates, so everything was all set for me to be adopted at birth by a lawyer and his wife. Except that when I popped out they decided at the last minute that they really wanted a girl. So my parents, who were on a waiting list, got a call in the middle of the night asking: “We have an unexpected baby boy; do you want him?” They said: “Of course.” My biological mother later found out that my mother had never graduated from college and that my father had never graduated from high school. She refused to sign the final adoption papers. She only relented a few months later when my parents promised that I would someday go to college.<br>这要从我出生前讲起，我的生母是一个未婚怀孕的年轻大学生，她决定把肚子里的我送给别人抚养。她强烈希望收养我的家庭具有大学学历，所以在我还没出生的时候，一切都已经安排好了，一个律师和他的妻子收养我。但是意想不到的是，在我来到人世的那一刻，他们突然反悔了，决定只收养女孩。因此，在收养名单上排在后面的我的养父母，半夜接到电话：”我们有一个不在计划之中的男孩，你们想要他吗？”他们回答：”当然。”我的生母后来发现，我的养母没有大学毕业，我的养父没有高中毕业。她拒绝签署最终的收养协议。几个月后，我的养父母承诺送我上大学，她才同意签署协议。</p>
<p>And 17 years later I did go to college. But I naively chose a college that was almost as expensive as Stanford, and all of my working-class parents’ savings were being spent on my college tuition. After six months, I couldn’t see the value in it. I had no idea what I wanted to do with my life and no idea how college was going to help me figure it out. And here I was spending all of the money my parents had saved their entire life. So I decided to drop out and trust that it would all work out OK. It was pretty scary at the time, but looking back it was one of the best decisions I ever made. The minute I dropped out I could stop taking the required classes that didn’t interest me, and begin dropping in on the ones that looked interesting.<br>十七年后，我真的上大学了。但是，我很幼稚地选择了一所几乎与斯坦福大学一样贵的学校。我的养父母都是蓝领阶层，他们的所有积蓄都用来付我的学费。读了六个月以后，我看不到这样做的价值。我不知道自己的人生应该干什么，也不知道大学如何帮我找到答案。而且，如果我在大学里待下去，就会花光我的父母整整一生的积蓄。所以，我就决定退学了，相信这样行得通。那个时候，我确实担心害怕，但是回过头来看，那是我的最佳决策之一。一旦我退学了，就能不上那些我毫无兴趣的必修课，可以开始旁听那些我有兴趣的课了。</p>
<p>It wasn’t all romantic. I didn’t have a dorm room, so I slept on the floor in friends’ rooms, I returned coke bottles for the 5¢ deposits to buy food with, and I would walk the 7 miles across town every Sunday night to get one good meal a week at the Hare Krishna temple. I loved it. And much of what I stumbled into by following my curiosity and intuition turned out to be priceless later on. Let me give you one example:<br>这件事也有艰苦的一面。我没有宿舍了，就睡在朋友家的地板上。退回可乐瓶可以拿到5美分，我把它们积累起来换东西吃。每个星期天晚上，我步行7英里穿过城市，到教会吃一顿免费的丰盛晚餐。但是，我还是心甘情愿。跟着自己的好奇心和直觉走，我误打误撞遇到的许多东西，日后都被证明是无价之宝。我给你们举一个例子。</p>
<p>Reed College at that time offered perhaps the best calligraphy instruction in the country. Throughout the campus every poster, every label on every drawer, was beautifully hand calligraphed. Because I had dropped out and didn’t have to take the normal classes, I decided to take a calligraphy class to learn how to do this. I learned about serif and san serif typefaces, about varying the amount of space between different letter combinations, about what makes great typography great. It was beautiful, historical, artistically subtle in a way that science can’t capture, and I found it fascinating.<br>那时，Reed大学开设可能是全国最好的书法课。校园里的每一张海报、每个抽屉上的每张标签，都是优美的手写体。因为退学后不用上那些常规课程，我决定去上书法课，学习如何写出优美的字。在那里，我学到了衬线字体和无衬线字体，学到了改变不同字母组合之间的间距，学到了版面设计如何才能优美。它是那样的美、富有历史感、艺术的精妙，科学不能捕捉到这些，我发现它太迷人了。</p>
<p>None of this had even a hope of any practical application in my life. But ten years later, when we were designing the first Macintosh computer, it all came back to me. And we designed it all into the Mac. It was the first computer with beautiful typography. If I had never dropped in on that single course in college, the Mac would have never had multiple typefaces or proportionally spaced fonts. And since Windows just copied the Mac, its likely that no personal computer would have them. If I had never dropped out, I would have never dropped in on this calligraphy class, and personal computers might not have the wonderful typography that they do. Of course it was impossible to connect the dots looking forward when I was in college. But it was very, very clear looking backwards ten years later.<br>这些东西，没有一件看上去对我的人生有实际的价值。但是十年后，当我们设计第一台Macintosh电脑的时候，它们都帮到我了。我们把它们都设计进了产品。那是第一台有着优美操作界面的电脑。如果我不曾在大学里旁听那门课，Mac电脑就不会有多种字形，或者按比例间隔的字体。因为后来Windows操作系统抄袭了Mac，那么很可能所有个人电脑都没有它们。如果我没有退学，我就不会旁听书法课，那么个人电脑可能就不会有它们现在的那样漂亮的界面了。当然，我还在大学里展望人生的时候，不可能把这些点都联系起来。但是十年后回头看，它们之间的联系真的是非常非常清楚。</p>
<p>Again, you can’t connect the dots looking forward; you can only connect them looking backwards. So you have to trust that the dots will somehow connect in your future. You have to trust in something — your gut, destiny, life, karma, whatever. This approach has never let me down, and it has made all the difference in my life.<br>再说一遍，你展望人生的时候，不可能把这些点连起来；只有当你回顾人生的时候，才能发现它们之间的联系。所以你必须有信心，相信这些点总会以某种方式，对你的未来产生影响。你必须相信一些事情——你的勇气、命运、人生、缘分等等。这样做从未令我失望，反而决定了我人生中所有与众不同之处。</p>
<p>My second story is about love and loss.<br>我的第二个故事，是关于爱和损失的。</p>
<p>I was lucky — I found what I loved to do early in life. Woz and I started Apple in my parents garage when I was 20. We worked hard, and in 10 years Apple had grown from just the two of us in a garage into a $2 billion company with over 4000 employees. We had just released our finest creation — the Macintosh — a year earlier, and I had just turned 30. And then I got fired. How can you get fired from a company you started? Well, as Apple grew we hired someone who I thought was very talented to run the company with me, and for the first year or so things went well. But then our visions of the future began to diverge and eventually we had a falling out. When we did, our Board of Directors sided with him. So at 30 I was out. And very publicly out. What had been the focus of my entire adult life was gone, and it was devastating.<br>我很幸运，在人生很早的时候，就找到了热爱的事情。我和沃兹尼亚克在我父母的车库里创立苹果公司的时候，我只有20岁。我们勤奋工作，十年后苹果公司从一个车库里的两人小公司，成长为超过4000个雇员的20亿美元大公司。在那之前一年，我们刚刚发布了最完美的产品——Macintosh电脑，我也才刚过30岁。但是接下来，我就被解雇了。你怎么可能被一家自己创立的公司解雇呢？事情是这样的，随着公司的发展，我们雇来了一位我眼中的天才，与我一起管理公司。第一年，一切还算顺利。但是那以后，我们对公司发展的看法出现了分歧，最终导致了分裂。最后，董事会站在了他的一边。所以，30岁的那一年，我被解雇了，而且是在众目睽睽之下。我整个成年人生的生活重心，离我远去，真是毁灭性的打击。</p>
<p>I really didn’t know what to do for a few months. I felt that I had let the previous generation of entrepreneurs down - that I had dropped the baton as it was being passed to me. I met with David Packard and Bob Noyce and tried to apologize for screwing up so badly. I was a very public failure, and I even thought about running away from the valley. But something slowly began to dawn on me — I still loved what I did. The turn of events at Apple had not changed that one bit. I had been rejected, but I was still in love. And so I decided to start over<br>最初几个月，我真的不知道干什么。我觉得自己太让人失望，上一代企业家交给我的接力棒，已经被我掉了。我与 David Packard和Bob Noyce见面，试着道歉我把事情搞得这么糟。我的失败被大肆曝光，我甚至想过从硅谷逃走。但是，慢慢地，有一件东西让我看到了曙光——我依然热爱我做的事情。苹果公司发生的问题，丝毫没有改变这一点。我确实被否决了，但是我仍然热爱这个事业。所以，我决定从头开始。</p>
<p>I didn’t see it then, but it turned out that getting fired from Apple was the best thing that could have ever happened to me. The heaviness of being successful was replaced by the lightness of being a beginner again, less sure about everything. It freed me to enter one of the most creative periods of my life.<br>我当时没有意识到，但是事后证明，被苹果解雇是我一生中经历的最好的事情。成功者的负担，重新被初学者的轻快取代，对任何事情都不是很有把握。它解放了我，让我重新进入又一个人生最具有创造力的时期。</p>
<p>During the next five years, I started a company named NeXT, another company named Pixar, and fell in love with an amazing woman who would become my wife. Pixar went on to create the worlds first computer animated feature film, Toy Story, and is now the most successful animation studio in the world. In a remarkable turn of events, Apple bought NeXT, I retuned to Apple, and the technology we developed at NeXT is at the heart of Apple’s current renaissance. And Laurene and I have a wonderful family together.<br>接下来的五年，我成立了一家叫做NeXT的公司，以及一家叫做Pixar的公司，与一个美妙的女子坠入爱河，然后结为夫妻。Pixar生产出世界上第一部计算机动画电影《玩具故事》，目前是全世界最成功的动画电影工作室。通过一系列事件的奇妙转变，苹果公司收购了NeXT，我又回到了苹果公司。我们在NeXT开发的技术，现在是苹果公司复兴的关键。我还和劳伦妮组建了一个美好的家庭。</p>
<p>I’m pretty sure none of this would have happened if I hadn’t been fired from Apple. It was awful tasting medicine, but I guess the patient needed it. Sometimes life hits you in the head with a brick. Don’t lose faith. I’m convinced that the only thing that kept me going was that I loved what I did. You’ve got to find what you love. And that is as true for your work as it is for your lovers. Your work is going to fill a large part of your life, and the only way to be truly satisfied is to do what you believe is great work. And the only way to do great work is to love what you do. If you haven’t found it yet, keep looking. Don’t settle. As with all matters of the heart, you’ll know when you find it. And, like any great relationship, it just gets better and better as the years roll on. So keep looking until you find it. Don’t settle.<br>我很肯定，如果我不被苹果公司解雇，这一切都不会发生。虽然这个事件的滋味像药物一样苦不堪言，但是我想病人需要服用它。有时，生活会对你迎头一击，这时不要丧失信心。我确信，唯一让我保持前进的动力，就是我热爱自己做的事情。你必须找到你热爱的东西。无论对于公众，还是对于爱人，都是如此。你的工作是你人生的很大一部分，真正令你感到满足的唯一方法，就是去做你心目中的伟大工作。做成伟大工作的唯一方法，就是热爱你自己做的事情。如果你还没有找到这样的事情，那就继续寻找，不要妥协。就像与内心有关的其他事情一样，当你找到的时候，你自己会知道的。并且与所有伟大的感情一样，时间越久，它的情况会变得越来越好。所以，不停地找，直到找到为止，不要妥协。</p>
<p>My third story is about death.<br>我的第三个故事是关于死亡的。</p>
<p>When I was 17, I read a quote that went something like: “If you live each day as if it was your last, someday you’ll most certainly be right.” It made an impression on me, and since then, for the past 33 years, I have looked in the mirror every morning and asked myself: “If today were the last day of my life, would I want to do what I am about to do today?” And whenever the answer has been “No” for too many days in a row, I know I need to change something.<br>十七岁的时候，我读到一句话，大意是这样的：”如果你把每一天都当做生命的最后一天，那么将来你最可能过上正确的生活。”它给我留下了很深的印象，过去33年来，我每天早上看着镜子问自己：”如果今天是人生的最后一天，我会不会愿意去做今天将要做的事情？”无论何时，如果一连好多天，答案都是NO，我就知道需要作出改变了。</p>
<p>Remembering that I’ll be dead soon is the most important tool I’ve ever encountered to help me make the big choices in life. Because almost everything — all external expectations, all pride, all fear of embarrassment or failure - these things just fall away in the face of death, leaving only what is truly important. Remembering that you are going to die is the best way I know to avoid the trap of thinking you have something to lose. You are already naked. There is no reason not to follow your heart.<br>记住自己不久就将死去，这是我发现的最重要的工具，帮助我做出人生中的重大决定。因为几乎所有事情——外人的期待，内心的骄傲，对于失败或出丑的恐惧——所有这些事情在死亡面前，都会消失，只留下那些真正重要的事情。记住你将要死，这是我所知道最好方法，免于念念不忘你可能会失去某件东西。你已经赤身裸体了，没有理由不跟随你的内心。</p>
<p>About a year ago I was diagnosed with cancer. I had a scan at 7:30 in the morning, and it clearly showed a tumor on my pancreas. I didn’t even know what a pancreas was. The doctors told me this was almost certainly a type of cancer that is incurable, and that I should expect to live no longer than three to six months. My doctor advised me to go home and get my affairs in order, which is doctor’s code for prepare to die. It means to try to tell your kids everything you thought you’d have the next 10 years to tell them in just a few months. It means to make sure everything is buttoned up so that it will be as easy as possible for your family. It means to say your goodbyes.<br>大概一年前，我被诊断得了癌症。早晨7点半，我做了一次全身扫描，它清楚地显示我的胰脏上有一个肿瘤。我那时甚至都不知道胰脏是什么。医生告诉我，已经可以肯定，那是一种无法治疗的癌症，我的生命预计不超过3到6个月。医生建议我回家把事情安排好，这是医生对于”将要死亡”的表达方式。它意味着，你要试着把你原以为未来10年才对孩子们说的事情，放着几个月里告诉他们。它意味着，你要确定把原件事情都安排好，使得对于你的家人来说，一切变得尽可能的简单。它意味着，你要和一切告别。</p>
<p>I lived with that diagnosis all day. Later that evening I had a biopsy, where they stuck an endoscope down my throat, through my stomach and into my intestines, put a needle into my pancreas and got a few cells from the tumor. I was sedated, but my wife, who was there, told me that when they viewed the cells under a microscope the doctors started crying because it turned out to be a very rare form of pancreatic cancer that is curable with surgery. I had the surgery and I’m fine now.<br>一整天，我无时无刻不想着那个诊断。当天晚上，我做了一个活检，医生将内窥镜塞进我的喉咙，穿过胃，进入肠子，又用一根针刺进胰脏，从肿瘤上得到一些细胞。我很镇定，但是我的妻子（她也在场）告诉我，当医生从显微镜观察那些细胞时，他们开始发出惊叹，因为他们发现那是一种非常罕见的胰腺癌，可以通过手术治愈。我做了手术，现在感觉很好。</p>
<p>This was the closest I’ve been to facing death, and I hope its the closest I get for a few more decades. Having lived through it, I can now say this to you with a bit more certainty than when death was a useful but purely intellectual concept:<br>那是我最接近死亡的时刻，我希望今后几十年都是如此。有了这样的经历，对我来说，死亡就不仅仅是一种纯粹智力上的有用概念，我可以更确定地告诉你们：</p>
<p>No one wants to die. Even people who want to go to heaven don’t want to die to get there. And yet death is the destination we all share. No one has ever escaped it. And that is as it should be, because Death is very likely the single best invention of Life. It is Life’s change agent. It clears out the old to make way for the new. Right now the new is you, but someday not too long from now, you will gradually become the old and be cleared away. Sorry to be so dramatic, but it is quite true.<br>没有人想死，甚至那些渴望升入天堂的人也不想死。但是，死亡是我们所有人都不可避免的人生终点。没有人可以逃脱。事情可能本来就应该如此，因为死亡很可能是生活中最好的单项发明。它是让生活改变的一种手段。它清理旧的一代，为新的一代创造空间。现在你们是新人，但是在并不太遥远的某一天，你们将慢慢成为旧的一代，被清理出去。很抱歉，我不想说得这么戏剧化，但是事实就是如此。</p>
<p>Your time is limited, so don’t waste it living someone else’s life. Don’t be trapped by dogma — which is living with the results of other people’s thinking. Don’t let the noise of others’ opinions drown out your own inner voice. And most important, have the courage to follow your heart and intuition. They somehow already know what you truly want to become. Everything else is secondary.<br>你们的时间有限，所以不要把它浪费在过其他人的生活。不要被教条束缚，那是其他人思考的结果。不要让其他人的意见淹没你自己内心的声音。最重要的是，你要有勇气跟随你的内心和直觉。某种程度上，它们已经知道你真正想要成为什么样子。其他所有事情都是次要的。</p>
<p>When I was young, there was an amazing publication called The Whole Earth Catalog, which was one of the bibles of my generation. It was created by a fellow named Stewart Brand not far from here in Menlo Park, and he brought it to life with his poetic touch. This was in the late 1960’s, before personal computers and desktop publishing, so it was all made with typewriters, scissors, and polaroid cameras. It was sort of like Google in paperback form, 35 years before Google came along: it was idealistic, and overflowing with neat tools and great notions.<br>我年轻的时候，有一本奇妙的出版物，叫做《地球商品目录》（The Whole Earth Catalog），那是我们那一代人的圣经之一。它是由一个叫做Stewart Brand的人，在距离此处不远的Menlo公园创造的。他诗一般地将它带到了人世。那是六十年代末期，个人电脑和桌面出版还没有问世，它是由打字机、剪刀和一次成像照相机做成的。它有点像纸质的Google，不过是在Google诞生35年之前。它充满了理想主义，包含了许多灵巧的工具和伟大的想法。</p>
<p>Stewart and his team put out several issues of The Whole Earth Catalog, and then when it had run its course, they put out a final issue. It was the mid-1970s, and I was your age. On the back cover of their final issue was a photograph of an early morning country road, the kind you might find yourself hitchhiking on if you were so adventurous. Beneath it were the words: “Stay Hungry. Stay Foolish.” It was their farewell message as they signed off. Stay Hungry. Stay Foolish. And I have always wished that for myself. And now, as you graduate to begin anew, I wish that for you.<br>Stewart<br>和他的团队发行了几期《地球商品目录》，然后他们顺其自然地推出了最后一期。那是70年代中期，我跟你们现在一样大。最后一期的封底，有一幅清晨乡间公路的照片，如果你喜欢冒险，那就是你可能会搭便车旅行的那种道路。在它下面有一行字：”保持饥饿，保持愚蠢”。我总是希望自己可以做到这一点。现在，你们即将毕业，开始新的旅程，我也这样地祝愿你们。</p>
<p>Stay Hungry. Stay Foolish.<br>保持饥饿，保持愚蠢。</p>
<p>Thank you all very much.<br>非常感谢各位。<br>（完）</p>
<p>最后修改时间： 2015-07-13 18:42:55</p>
]]></content>
    <summary type="html">
    <![CDATA[Stay Hungry, Stay Foolish]]>
    
    </summary>
    
      <category term="生活 | Life" scheme="http://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Mac新手入门以及常用软件推荐]]></title>
    <link href="http://wsgzao.github.io/post/mac/"/>
    <id>http://wsgzao.github.io/post/mac/</id>
    <published>2015-08-25T10:43:14.000Z</published>
    <updated>2015-08-25T07:03:01.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/y2JB0IAD.png" alt=""></p>
<h2 id="前言">前言</h2><p>大学时期折腾过黑苹果，VMware vSphere也搭建了虚拟环境测试，现在除了满大街的iPhone外，使用MacBook的朋友也越来越多，尽管对我而言也是触手可及，但总觉得少了当初的某种特殊追求。在新公司有机会接触到Mac Mini，顺势再重新整理下Mac入门以及常用软件的推荐。</p>
<blockquote>
<p>Mac是一段改变自己习惯的有趣经历 </p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月25日 - 统一名称为Mac新手入门以及常用软件推荐<br>2015年02月23日 - 扩展阅读增加MAC下常用软件推荐，感谢<a href="http://miao.hu/about.html" target="_blank" rel="external">@humiaozuzu</a><br>2015年02月22日 - 更新Office 2011 SP4，VMware Fusion 7，Adobe Photoshop CS6 Extended<br>2015年02月20日 - 独立Mac和iOS部分</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/mac/" target="_blank" rel="external">http://wsgzao.github.io/post/mac/</a></p>
<p>扩展阅读</p>
<ul>
<li>BestApp - <a href="https://github.com/hzlzh/Best-App" target="_blank" rel="external">https://github.com/hzlzh/Best-App</a></li>
<li>MAC下常用软件推荐 - <a href="http://miao.hu/2012/02/26/osx-exp-share/" target="_blank" rel="external">http://miao.hu/2012/02/26/osx-exp-share/</a></li>
<li>Mac 键盘快捷键 - <a href="https://support.apple.com/zh-cn/HT201236" target="_blank" rel="external">https://support.apple.com/zh-cn/HT201236</a></li>
<li>Mac 开发配置手册 - <a href="https://www.gitbook.com/book/aaaaaashu/mac-dev-setup/" target="_blank" rel="external">https://www.gitbook.com/book/aaaaaashu/mac-dev-setup/</a></li>
<li>Mac入门 - <a href="http://www.cnblogs.com/TankXiao/archive/2013/01/05/2845413.html" target="_blank" rel="external">http://www.cnblogs.com/TankXiao/archive/2013/01/05/2845413.html</a></li>
<li>高效MacBook工作环境配置 - <a href="http://www.xialeizhou.com/?p=71" target="_blank" rel="external">http://www.xialeizhou.com/?p=71</a></li>
<li>小闷的水果店 - <a href="http://appled.cc/" target="_blank" rel="external">http://appled.cc/</a></li>
<li>Apps索引 - <a href="http://wsgzao.github.io/index/#Apps" target="_blank" rel="external">http://wsgzao.github.io/index/#Apps</a></li>
</ul>
<hr>
<h2 id="Mac入门">Mac入门</h2><p><img src="http://ww2.sinaimg.cn/large/7207510dgw1evep6dhkflj20tx0m2dms.jpg" alt=""></p>
<blockquote>
<p>Mac是一个学习和适应的过程，慢慢来就好，扩展阅读中提供了丰富的参考信息</p>
</blockquote>
<ol>
<li>Command+空格键：Spotlight（推荐使用Alfred代替）</li>
<li>Command+{C/V/X/A/Z/F}：复制/粘帖/剪切/全选/撤销/查找</li>
<li>Command+Q：退出当前应用</li>
<li>Command+Option+Esc：强制退出应用程序管理器</li>
<li>Command+Delete：删除到回收站</li>
<li>选定文件-回车：重命名文件</li>
</ol>
<h2 id="特别推荐">特别推荐</h2><p>Mac操作说明完全指南 - <a href="http://pan.baidu.com/s/1mg7kmta" target="_blank" rel="external">http://pan.baidu.com/s/1mg7kmta</a></p>
<ul>
<li>Mac操作说明完全指南 Mavericks 10.9 张宁博 编写【高清】</li>
</ul>
<p>Alfred - <a href="https://www.alfredapp.com/" target="_blank" rel="external">https://www.alfredapp.com/</a></p>
<ul>
<li>无数人推荐的神兵利器，引用MacTalk的介绍，小帽子是 Mac 平台上最为传奇的效率作品</li>
</ul>
<p>Tuxera NTFS for Mac - <a href="http://pan.baidu.com/s/1qW3NOsO" target="_blank" rel="external">http://pan.baidu.com/s/1qW3NOsO</a></p>
<ul>
<li>代替Paragon NTFS提供Mac平台下的NFS读写功能支持</li>
</ul>
<p>开发环境4件套（可选）</p>
<ul>
<li>Xcode - <a href="http://developer.apple.com/xcode/downloads/" target="_blank" rel="external">http://developer.apple.com/xcode/downloads/</a></li>
<li>Homebrew - <a href="http://brew.sh/" target="_blank" rel="external">http://brew.sh/</a></li>
<li>Homebrew Cask - <a href="http://caskroom.io/" target="_blank" rel="external">http://caskroom.io/</a></li>
<li>Oh My Zsh - <a href="http://ohmyz.sh/" target="_blank" rel="external">http://ohmyz.sh/</a></li>
</ul>
<h2 id="Mac_OS_X">Mac OS X</h2><p>Office 2016 - <a href="http://pan.baidu.com/s/1dDdLKml" target="_blank" rel="external">http://pan.baidu.com/s/1dDdLKml</a></p>
<ul>
<li>iWork和Keynote也应该是大家常用的神器吧</li>
</ul>
<p>VMware Fusion - <a href="http://www.0daydown.com/?s=VMware+Fusion" target="_blank" rel="external">http://www.0daydown.com/?s=VMware+Fusion</a></p>
<ul>
<li>不喜欢BootCamp那就直接用VMware虚拟机玩Windows吧</li>
<li>Parallels Desktop for Mac或许也是你的首选</li>
</ul>
<p>Adobe Photoshop - <a href="http://pan.baidu.com/s/1dDjl2Bf" target="_blank" rel="external">http://pan.baidu.com/s/1dDjl2Bf</a></p>
<ul>
<li>Adobe Photoshop CC 2015 for Mac 16.0，PS必备</li>
</ul>
<p>MPlayerX - <a href="http://mplayerx.org/" target="_blank" rel="external">http://mplayerx.org/</a></p>
<ul>
<li>优秀免费视频播放器</li>
</ul>
<p>百度输入法 For Mac - <a href="http://wuxian.baidu.com/input/mac.html" target="_blank" rel="external">http://wuxian.baidu.com/input/mac.html</a></p>
<ul>
<li>腾讯因战略需要拱手相让输入法于搜狗，而百度凭借先天的搜索优势正步步为营</li>
</ul>
<p>迅雷 For Mac - <a href="http://mac.xunlei.com/" target="_blank" rel="external">http://mac.xunlei.com/</a></p>
<ul>
<li>纯粹的下载</li>
</ul>
<p>QQ电脑管家 For Mac - <a href="http://mac.gj.qq.com/" target="_blank" rel="external">http://mac.gj.qq.com/</a></p>
<ul>
<li>以简奴繁，和360又干上了，但真的很好用</li>
</ul>
<p>Snip - <a href="http://www.snip.qq.com/" target="_blank" rel="external">http://www.snip.qq.com/</a></p>
<ul>
<li>简单高效的截图工具</li>
</ul>
<p>ShadowsocksX - <a href="http://pan.baidu.com/s/1qW9nxxi" target="_blank" rel="external">http://pan.baidu.com/s/1qW9nxxi</a></p>
<ul>
<li>感谢@clowwindy</li>
</ul>
<hr>
<p>题图 - 苹果2015新春广告<a href="http://www.apple.com/cn/start-something-new/#film-holiday" target="_blank" rel="external">《老唱片》</a></p>
]]></content>
    <summary type="html">
    <![CDATA[Mac是一段改变自己习惯的有趣经历]]>
    
    </summary>
    
      <category term="软件 | Soft" scheme="http://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[vsftpd安装以及配置FTP虚拟用户实践]]></title>
    <link href="http://wsgzao.github.io/post/vsftpd/"/>
    <id>http://wsgzao.github.io/post/vsftpd/</id>
    <published>2015-08-24T07:42:19.000Z</published>
    <updated>2015-08-24T06:42:16.000Z</updated>
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>正如vsftpd官方宣传中所说<code>Probably the most secure and fastest FTP server for UNIX-like systems.</code>我相信这是大多数人选择vsftpd来搭建Linux的FTP服务器的原因，当然ProFTPD用的人应该也不在少数。文章将以清晰直观的方式介绍安装vsftpd以及配置FTP虚拟用户的过程，希望对大家有帮助。</p>
<blockquote>
<p>首选的FTP服务器搭建方式</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月24日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/vsftpd/" target="_blank" rel="external">http://wsgzao.github.io/post/vsftpd/</a></p>
<p>扩展阅读</p>
<p>CentOS 6.4 下安装vsftpd - <a href="http://www.cnblogs.com/xiongpq/p/3384759.html" target="_blank" rel="external">http://www.cnblogs.com/xiongpq/p/3384759.html</a><br>ProFTPD - <a href="http://www.proftpd.org/" target="_blank" rel="external">http://www.proftpd.org/</a><br>vsftpd - <a href="http://vsftpd.beasts.org" target="_blank" rel="external">http://vsftpd.beasts.org</a></p>
<hr>
<h2 id="安装vsftpd">安装vsftpd</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前系统版本</span></span><br><span class="line">cat /etc/redhat-release </span><br><span class="line">CentOS release <span class="number">6.6</span> (Final)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看是否已经安装vsftpd</span></span><br><span class="line">rpm -qa | grep vsftpd</span><br><span class="line"><span class="comment">#如果没有，就安装，并设置开机启动</span></span><br><span class="line">yum -y install vsftpd</span><br><span class="line">chkconfig vsftpd on</span><br></pre></td></tr></table></figure>
<h2 id="基于虚拟用户的配置">基于虚拟用户的配置</h2><blockquote>
<p>所谓虚拟用户就是没有使用真实的帐户，只是通过映射到真实帐户和设置权限的目的。虚拟用户不能登录CentOS系统。</p>
</blockquote>
<h3 id="修改配置文件">修改配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器独立运行</span></span><br><span class="line">listen=YES</span><br><span class="line"><span class="comment">#设定不允许匿名访问</span></span><br><span class="line">anonymous_<span class="built_in">enable</span>=NO</span><br><span class="line"><span class="comment">#设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为NO的情况下所有虚拟用户将无法访问</span></span><br><span class="line"><span class="built_in">local</span>_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="comment">#使用户不能离开主目录</span></span><br><span class="line">chroot_list_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="comment">#设定支持ASCII模式的上传和下载功能</span></span><br><span class="line">ascii_upload_<span class="built_in">enable</span>=YES</span><br><span class="line">ascii_download_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="comment">#PAM认证文件名。PAM将根据/etc/pam.d/vsftpd进行认证</span></span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line"><span class="comment">#设定启用虚拟用户功能</span></span><br><span class="line">guest_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="comment">#指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了</span></span><br><span class="line">guest_username=ftp</span><br><span class="line"><span class="comment">#设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)</span></span><br><span class="line">user_config_dir=/etc/vsftpd/vuser_conf</span><br><span class="line"><span class="comment">#配置vsftpd日志（可选）</span></span><br><span class="line">xferlog_<span class="built_in">enable</span>=YES</span><br><span class="line">xferlog_std_format=YES</span><br><span class="line">xferlog_file=/var/<span class="built_in">log</span>/xferlog</span><br><span class="line">dual_<span class="built_in">log</span>_<span class="built_in">enable</span>=YES</span><br><span class="line">vsftpd_<span class="built_in">log</span>_file=/var/<span class="built_in">log</span>/vsftpd.log</span><br></pre></td></tr></table></figure>
<h3 id="进行认证">进行认证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装Berkeley DB工具，很多人找不到db_load的问题就是没有安装这个包</span></span><br><span class="line">yum install db4 db4-utils</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户密码文本，注意奇行是用户名，偶行是密码</span></span><br><span class="line">vi /etc/vsftpd/vuser_passwd.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line"><span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#生成虚拟用户认证的db文件</span></span><br><span class="line">db_load -T -t <span class="built_in">hash</span> <span class="operator">-f</span> /etc/vsftpd/vuser_passwd.txt /etc/vsftpd/vuser_passwd.db</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑认证文件，全部注释掉原来语句，再增加以下两句</span></span><br><span class="line">vi /etc/pam.d/vsftpd</span><br><span class="line"></span><br><span class="line">auth required pam_userdb.so db=/etc/vsftpd/vuser_passwd</span><br><span class="line">account required pam_userdb.so db=/etc/vsftpd/vuser_passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建虚拟用户配置文件</span></span><br><span class="line">mkdir /etc/vsftpd/vuser_conf/</span><br><span class="line"><span class="comment">#文件名等于vuser_passwd.txt里面的账户名，否则下面设置无效</span></span><br><span class="line">vi /etc/vsftpd/vuser_conf/<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#虚拟用户根目录,根据实际情况修改</span></span><br><span class="line"><span class="built_in">local</span>_root=/data/ftp</span><br><span class="line">write_<span class="built_in">enable</span>=YES</span><br><span class="line">anon_<span class="built_in">umask</span>=<span class="number">022</span></span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line">anon_upload_<span class="built_in">enable</span>=YES</span><br><span class="line">anon_mkdir_write_<span class="built_in">enable</span>=YES</span><br><span class="line">anon_other_write_<span class="built_in">enable</span>=YES</span><br></pre></td></tr></table></figure>
<h3 id="设置FTP根目录权限">设置FTP根目录权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#最新的vsftpd要求对主目录不能有写的权限所以ftp为755，主目录下面的子目录再设置777权限</span></span><br><span class="line">mkdir /data/ftp</span><br><span class="line">chmod -R <span class="number">755</span> /data</span><br><span class="line">chmod -R <span class="number">777</span> /data/ftp</span><br><span class="line"></span><br><span class="line"><span class="comment">#建立限制用户访问目录的空文件</span></span><br><span class="line">touch /etc/vsftpd/chroot_list</span><br><span class="line"></span><br><span class="line"><span class="comment">#如果启用vsftpd日志需手动建立日志文件</span></span><br><span class="line">touch /var/<span class="built_in">log</span>/xferlog </span><br><span class="line">touch /var/<span class="built_in">log</span>/vsftpd.log</span><br></pre></td></tr></table></figure>
<h3 id="配置PASV模式（可选）">配置PASV模式（可选）</h3><blockquote>
<p>vsftpd默认没有开启PASV模式，现在FTP只能通过PORT模式连接，要开启PASV默认需要通过下面的配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">打开/etc/vsftpd/vsftpd.conf，在末尾添加</span><br><span class="line"></span><br><span class="line"><span class="comment">#开启PASV模式</span></span><br><span class="line">pasv_<span class="built_in">enable</span>=YES</span><br><span class="line"><span class="comment">#最小端口号</span></span><br><span class="line">pasv_min_port=<span class="number">40000</span></span><br><span class="line"><span class="comment">#最大端口号</span></span><br><span class="line">pasv_max_port=<span class="number">40080</span></span><br><span class="line">pasv_promiscuous=YES</span><br><span class="line"></span><br><span class="line"><span class="comment">#在防火墙配置内开启40000到40080端口</span></span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p -dport <span class="number">40000</span>:<span class="number">40080</span> -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment">#重启iptabls和vsftpd</span></span><br><span class="line">service iptables restart</span><br><span class="line">service vsftpd restart</span><br><span class="line"></span><br><span class="line">现在可以使用PASV模式连接你的FTP服务器了~</span><br></pre></td></tr></table></figure>
<h3 id="Selinux和防火墙">Selinux和防火墙</h3><blockquote>
<p>该关闭的关闭，该放行的放行</p>
</blockquote>
<pre><code><span class="keyword">service</span> vsftpd <span class="literal">start</span>
</code></pre><h2 id="常见问题">常见问题</h2><p>如果登录时出现</p>
<pre><code><span class="number">500</span> OOPS: priv_sock_get_result. Connection closed <span class="keyword">by</span> remote host.
</code></pre><p>这样的错误，需要升级pam</p>
<pre><code><span class="title">yum</span> update pam
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[首选的FTP服务器搭建方式]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[phpMyAdmin无需填写IP管理多个MySQL实践]]></title>
    <link href="http://wsgzao.github.io/post/phpmyadmin/"/>
    <id>http://wsgzao.github.io/post/phpmyadmin/</id>
    <published>2015-08-18T07:42:19.000Z</published>
    <updated>2015-08-19T08:13:16.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/68353qlH.png" alt=""></p>
<h2 id="前言">前言</h2><p>默认安装phpMyAdmin，通常只能连一台MySQL服务器，其配置信息是保存在phpMyAdmin的配置文件里的，当我们需要在多台服务器之间进行切换登陆的时候，修改起来非常麻烦。遵照下面的配置方法，我们可以方便的使用phpMyAdmin连接多台MySQL。</p>
<blockquote>
<p>用phpMyAdmin简化MySQL数据库管理工作</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月19日 - 增加Adminer，感谢<a href="http://www.v2ex.com/member/BOYPT" target="_blank" rel="external">@BOYPT</a>推荐<br>2015年08月12日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/phpmyadmin/" target="_blank" rel="external">http://wsgzao.github.io/post/phpmyadmin/</a></p>
<p>扩展阅读</p>
<p>配置phpmyadmin使登录时可填写IP管理多台MySQL - <a href="http://www.oicto.com/phpmyadmin-mysql-ip/" target="_blank" rel="external">http://www.oicto.com/phpmyadmin-mysql-ip/</a><br>phpMyAdmin - <a href="http://docs.phpmyadmin.net/" target="_blank" rel="external">http://docs.phpmyadmin.net/</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="下载文件">下载文件</h2><p>1.从官方下载最新的版本<br><a href="http://www.phpmyadmin.net/downloads/" target="_blank" rel="external">http://www.phpmyadmin.net/downloads/</a></p>
<p>2.解压上传至服务器中</p>
<p>3.PHP环境搭建可以参考以下文章</p>
<p>LTMP手动编译安装以及全自动化部署实践 - <a href="http://wsgzao.github.io/post/ltmp/" target="_blank" rel="external">http://wsgzao.github.io/post/ltmp/</a></p>
<h2 id="方法1">方法1</h2><blockquote>
<p>phpMyAdmin允许定义输入的MySQL服务器IP地址，用户名和密码</p>
</blockquote>
<p>修改<code>/libraries/config.default.php</code>为真即可，简单安全省事</p>
<pre><code><span class="variable">$cfg</span>[<span class="string">'AllowArbitraryServer'</span>] = <span class="literal">true</span>;
</code></pre><h2 id="方法2">方法2</h2><blockquote>
<p>phpMyAdmin修改config.inc.php，服务器地址为下拉列表可选登录多个服务器</p>
</blockquote>
<p>增加<code>config.sample.inc.php</code>文件，参考下面配置或者访问setup手动生成</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> * Generated configuration file</span><br><span class="line"> * Generated by: phpMyAdmin 4.4.11 setup script</span><br><span class="line"> * Date: Fri, 10 Jul 2015 15:54:42 +0800</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Servers configuration */</span></span><br><span class="line"><span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Server: 10.4.14.64 [1] */</span></span><br><span class="line"><span class="variable">$i</span>++;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'verbose'</span>] = <span class="string">'10.10.6.64'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'host'</span>] = <span class="string">'10.10.6.64'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'port'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'socket'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'connect_type'</span>] = <span class="string">'tcp'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'cookie'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>] = <span class="string">'root'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>] = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Server: 10.10.1.172 [2] */</span></span><br><span class="line"><span class="variable">$i</span>++;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'verbose'</span>] = <span class="string">'10.10.1.172'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'host'</span>] = <span class="string">'10.10.1.172'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'port'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'socket'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'connect_type'</span>] = <span class="string">'tcp'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'auth_type'</span>] = <span class="string">'cookie'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'user'</span>] = <span class="string">'root'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'Servers'</span>][<span class="variable">$i</span>][<span class="string">'password'</span>] = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* End of servers configuration */</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'blowfish_secret'</span>] = <span class="string">'559f78c86f22d8.48481095'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'DefaultLang'</span>] = <span class="string">'zh_CN'</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'ServerDefault'</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'UploadDir'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="variable">$cfg</span>[<span class="string">'SaveDir'</span>] = <span class="string">''</span>;</span><br><span class="line"><span class="preprocessor">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="方法3">方法3</h2><blockquote>
<p>不多说了，直接看官方的对比报告吧，感谢<a href="http://www.v2ex.com/member/BOYPT" target="_blank" rel="external">@BOYPT</a>推荐</p>
</blockquote>
<p>Adminer - <a href="http://www.adminer.org/" target="_blank" rel="external">http://www.adminer.org/</a></p>
<p>Why is Adminer better than phpMyAdmin?</p>
<p>Replace phpMyAdmin with Adminer and you will get a tidier user interface, better support for MySQL features, higher performance and more security. See detailed comparison.</p>
<p>Adminer development priorities are: 1. Security, 2. User experience, 3. Performance, 4. Feature set, 5. Size.</p>
<p><a href="http://www.adminer.org/en/phpmyadmin/" target="_blank" rel="external">http://www.adminer.org/en/phpmyadmin/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[用phpMyAdmin简化MySQL数据库管理工作]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[LTMP手动编译安装以及全自动化部署实践]]></title>
    <link href="http://wsgzao.github.io/post/ltmp/"/>
    <id>http://wsgzao.github.io/post/ltmp/</id>
    <published>2015-08-14T07:42:19.000Z</published>
    <updated>2015-08-14T09:42:26.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/Up79Hq7l.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>现在很多朋友都了解或者已经在使用LNMP架构，一般可以理解为Linux Shell为CentOS/RadHat/Fedora/Debian/Ubuntu/等平台安装LNMP(Nginx/MySQL/PHP)，LNMPA(Nginx/MySQL/PHP/Apache)，LAMP(Apache/MySQL/PHP)等类似的开发或生产环境。我自己是从SuSE/Oracle商业化环境走出来的，对于开源的部署方案也是在一点一点摸索，我相信其中也必然包含某些坑爹的配置。这篇文章较为详细的描述了基于LTMP架构的部署过程，之后会再考虑独立各个模块分享细节和技巧，如果大家有更合适的配置实践手册欢迎一起分享，文章中的错误和改进点也请帮忙指点下哈。</p>
<blockquote>
<p>LTMP(CentOS/Tengine/MySQL/PHP)</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月14日 - 更新GitHub自动部署源码和安装包<br>2015年08月04日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/ltmp/" target="_blank" rel="external">http://wsgzao.github.io/post/ltmp/</a></p>
<p>扩展阅读</p>
<p>CentOS - <a href="http://www.centos.org/" target="_blank" rel="external">http://www.centos.org/</a><br>Tengine - <a href="http://tengine.taobao.org/" target="_blank" rel="external">http://tengine.taobao.org/</a><br>Nginx - <a href="http://nginx.org/en/docs/" target="_blank" rel="external">http://nginx.org/en/docs/</a><br>MySQL - <a href="http://www.mysql.com/" target="_blank" rel="external">http://www.mysql.com/</a><br>PHP - <a href="http://php.net/" target="_blank" rel="external">http://php.net/</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="LTMP版本">LTMP版本</h2><ol>
<li>CentOS_6.5_64</li>
<li>Tengine-2.1.0</li>
<li>MySQL_5.6.25</li>
<li>PHP_5.5.27</li>
<li>Apache_2.2.31(酱油)</li>
</ol>
<h2 id="准备工作">准备工作</h2><blockquote>
<p>如果允许公网访问会方便很多</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化History历史记录</span></span><br><span class="line">vi /etc/bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置保存历史命令的文件大小</span></span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=<span class="number">1000000000</span></span><br><span class="line"><span class="comment">#保存历史命令条数</span></span><br><span class="line"><span class="built_in">export</span> HISTSIZE=<span class="number">1000000</span></span><br><span class="line"><span class="comment">#实时记录历史命令，默认只有在用户退出之后才会统一记录，很容易造成多个用户间的相互覆盖。</span></span><br><span class="line"><span class="built_in">export</span> PROMPT_COMMAND=<span class="string">"history -a"</span></span><br><span class="line"><span class="comment">#记录每条历史命令的执行时间</span></span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">"%Y-%m-%d_%H:%M:%S "</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置时区（可选）</span></span><br><span class="line">rm -rf /etc/localtime</span><br><span class="line">ln <span class="operator">-s</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用NetworkManager（可选）</span></span><br><span class="line">/etc/init.d/NetworkManager stop</span><br><span class="line">chkconfig NetworkManager off</span><br><span class="line">/etc/init.d/network restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭iptables（可选） </span></span><br><span class="line">/etc/init.d/iptables stop</span><br><span class="line">chkconfig iptables off</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置dns（可选）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nameserver 114.114.114.114"</span> &gt; /etc/resolv.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭maildrop</span></span><br><span class="line"><span class="comment">#cd /var/spool/postfix/maildrop;ls | xargs rm -rf; </span></span><br><span class="line">sed <span class="string">'s/MAILTO=root/MAILTO=""/g'</span> /etc/crontab</span><br><span class="line">service crond restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#关闭selinux</span></span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#文件打开数量，</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">ulimit</span> -SHn <span class="number">65535</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改最大进程和最大文件打开数限制</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nproc <span class="number">11000</span></span><br><span class="line">* hard nproc <span class="number">11000</span></span><br><span class="line">* soft nofile <span class="number">655350</span></span><br><span class="line">* hard nofile <span class="number">655350</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="operator">-e</span> <span class="string">'/# End of file/i\* soft  nofile 65535\n* hard nofile 65535'</span>  /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#优化TCP</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用包过滤功能 </span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#启用源路由核查功能 </span></span><br><span class="line">net.ipv4.conf.default.rp_filter = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#禁用所有IP源路由 </span></span><br><span class="line">net.ipv4.conf.default.accept_<span class="built_in">source</span>_route = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#使用sysrq组合键是了解系统目前运行情况，为安全起见设为0关闭</span></span><br><span class="line">kernel.sysrq = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#控制core文件的文件名是否添加pid作为扩展</span></span><br><span class="line">kernel.core_uses_pid = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启SYN Cookies，当出现SYN等待队列溢出时，启用cookies来处理</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#每个消息队列的大小（单位：字节）限制</span></span><br><span class="line">kernel.msgmnb = <span class="number">65536</span>  </span><br><span class="line"><span class="comment">#整个系统最大消息队列数量限制</span></span><br><span class="line">kernel.msgmax = <span class="number">65536</span>  </span><br><span class="line"><span class="comment">#单个共享内存段的大小（单位：字节）限制，计算公式64G*1024*1024*1024(字节)</span></span><br><span class="line">kernel.shmmax = <span class="number">68719476736</span>  </span><br><span class="line"><span class="comment">#所有内存大小（单位：页，1页 = 4Kb），计算公式16G*1024*1024*1024/4KB(页)</span></span><br><span class="line">kernel.shmall = <span class="number">4294967296</span>  </span><br><span class="line"><span class="comment">#timewait的数量，默认是180000</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = <span class="number">6000</span>  </span><br><span class="line"><span class="comment">#开启有选择的应答</span></span><br><span class="line">net.ipv4.tcp_sack = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#支持更大的TCP窗口. 如果TCP窗口最大超过65535(64K), 必须设置该数值为1</span></span><br><span class="line">net.ipv4.tcp_window_scaling = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#TCP读buffer</span></span><br><span class="line">net.ipv4.tcp_rmem = <span class="number">4096</span> <span class="number">131072</span> <span class="number">1048576</span></span><br><span class="line"><span class="comment">#TCP写buffer</span></span><br><span class="line">net.ipv4.tcp_wmem = <span class="number">4096</span> <span class="number">131072</span> <span class="number">1048576</span>   </span><br><span class="line"><span class="comment">#为TCP socket预留用于发送缓冲的内存默认值（单位：字节）</span></span><br><span class="line">net.core.wmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="comment">#为TCP socket预留用于发送缓冲的内存最大值（单位：字节）</span></span><br><span class="line">net.core.wmem_max = <span class="number">16777216</span>  </span><br><span class="line"><span class="comment">#为TCP socket预留用于接收缓冲的内存默认值（单位：字节）  </span></span><br><span class="line">net.core.rmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="comment">#为TCP socket预留用于接收缓冲的内存最大值（单位：字节）</span></span><br><span class="line">net.core.rmem_max = <span class="number">16777216</span></span><br><span class="line"><span class="comment">#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span></span><br><span class="line">net.core.netdev_max_backlog = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128，而nginx定义的NGX_LISTEN_BACKLOG默认为511，所以有必要调整这个值</span></span><br><span class="line">net.core.somaxconn = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上。这个限制仅仅是为了防止简单的DoS攻击，不能过分依靠它或者人为地减小这个值，更应该增加这个值(如果增加了内存之后)</span></span><br><span class="line">net.ipv4.tcp_max_orphans = <span class="number">3276800</span>  </span><br><span class="line"><span class="comment">#记录的那些尚未收到客户端确认信息的连接请求的最大值。对于有128M内存的系统而言，缺省值是1024，小内存的系统则是128</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#时间戳可以避免序列号的卷绕。一个1Gbps的链路肯定会遇到以前用过的序列号。时间戳能够让内核接受这种“异常”的数据包。这里需要将其关掉</span></span><br><span class="line">net.ipv4.tcp_timestamps = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#为了打开对端的连接，内核需要发送一个SYN并附带一个回应前面一个SYN的ACK。也就是所谓三次握手中的第二次握手。这个设置决定了内核放弃连接之前发送SYN+ACK包的数量</span></span><br><span class="line">net.ipv4.tcp_synack_retries = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#在内核放弃建立连接之前发送SYN包的数量</span></span><br><span class="line">net.ipv4.tcp_syn_retries = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启TCP连接中time_wait sockets的快速回收</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启TCP连接复用功能，允许将time_wait sockets重新用于新的TCP连接（主要针对time_wait连接）</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#1st低于此值,TCP没有内存压力,2nd进入内存压力阶段,3rdTCP拒绝分配socket(单位：内存页)</span></span><br><span class="line">net.ipv4.tcp_mem = <span class="number">94500000</span> <span class="number">915000000</span> <span class="number">927000000</span>   </span><br><span class="line"><span class="comment">#如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间。对端可以出错并永远不关闭连接，甚至意外当机。缺省值是60 秒。2.2 内核的通常值是180秒，你可以按这个设置，但要记住的是，即使你的机器是一个轻载的WEB服务器，也有因为大量的死套接字而内存溢出的风险，FIN- WAIT-2的危险性比FIN-WAIT-1要小，因为它最多只能吃掉1.5K内存，但是它们的生存期长些。</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = <span class="number">15</span>  </span><br><span class="line"><span class="comment">#表示当keepalive起用的时候，TCP发送keepalive消息的频度（单位：秒）</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = <span class="number">30</span>  </span><br><span class="line"><span class="comment">#对外连接端口范围</span></span><br><span class="line">net.ipv4.ip_<span class="built_in">local</span>_port_range = <span class="number">2048</span> <span class="number">65000</span></span><br><span class="line"><span class="comment">#表示文件句柄的最大数量</span></span><br><span class="line">fs.file-max = <span class="number">102400</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#云主机上的优化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kernel sysctl configuration file for Red Hat Linux</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and</span></span><br><span class="line"><span class="comment"># sysctl.conf(5) for more details.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls IP packet forwarding</span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls source route verification</span></span><br><span class="line">net.ipv4.conf.default.rp_filter = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not accept source routing</span></span><br><span class="line">net.ipv4.conf.default.accept_<span class="built_in">source</span>_route = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the System Request debugging functionality of the kernel</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls whether core dumps will append the PID to the core filename.</span></span><br><span class="line"><span class="comment"># Useful for debugging multi-threaded applications.</span></span><br><span class="line">kernel.core_uses_pid = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the use of TCP syncookies</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable netfilter on bridges.</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = <span class="number">0</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables = <span class="number">0</span></span><br><span class="line">net.bridge.bridge-nf-call-arptables = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the default maxmimum size of a mesage queue</span></span><br><span class="line">kernel.msgmnb = <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum size of a message, in bytes</span></span><br><span class="line">kernel.msgmax = <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum shared segment size, in bytes</span></span><br><span class="line">kernel.shmmax = <span class="number">68719476736</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum number of shared memory segments, in pages</span></span><br><span class="line">kernel.shmall = <span class="number">4294967296</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br><span class="line">net.netfilter.nf_conntrack_max = <span class="number">1000000</span></span><br><span class="line">kernel.unknown_nmi_panic = <span class="number">0</span></span><br><span class="line">kernel.sysrq = <span class="number">0</span></span><br><span class="line">fs.file-max = <span class="number">1000000</span></span><br><span class="line">vm.swappiness = <span class="number">10</span></span><br><span class="line">fs.inotify.max_user_watches = <span class="number">10000000</span></span><br><span class="line">net.core.wmem_max = <span class="number">327679</span></span><br><span class="line">net.core.rmem_max = <span class="number">327679</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">/sbin/sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#自动选择最快的yum源</span></span><br><span class="line">yum -y install yum-fastestmirror</span><br><span class="line"></span><br><span class="line"><span class="comment">#移除系统自带的rpm包的http mysql php</span></span><br><span class="line"><span class="comment">#yum remove httpd* php*</span></span><br><span class="line">yum remove httpd mysql mysql-server php php-cli php-common php-devel php-gd  -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#升级基础库</span></span><br><span class="line">yum install -y wget gcc gcc-c++ openssl* curl curl-devel libxml2 libxml2-devel glibc glibc-devel glib2 glib2-devel gd gd2 gd-devel gd2-devel libaio autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel </span><br><span class="line"></span><br><span class="line"><span class="comment">#yum安装基础必备环境包，可以先将yum源更换为阿里云的源</span></span><br><span class="line">阿里：http://mirrors.aliyun.com/ </span><br><span class="line">搜狐：http://mirrors.sohu.com/ </span><br><span class="line">网易：http://mirrors.<span class="number">163</span>.com/</span><br><span class="line"></span><br><span class="line"><span class="comment">#备份原先的yum源信息</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br><span class="line"></span><br><span class="line"><span class="comment">#从阿里云镜像站下载centos6的repo</span></span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-<span class="number">6</span>.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#最后yum重新生成缓存</span></span><br><span class="line">yum makecache</span><br><span class="line"></span><br><span class="line"><span class="comment">#yum安装软件包（可选）</span></span><br><span class="line">yum -y install tar zip unzip openssl* gd gd-devel gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap openldap-devel openldap-clients openldap-servers make libmcrypt libmcrypt-devel fontconfig fontconfig-devel libXpm* libtool* libxml2 libxml2-devel t1lib t1lib-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义目录结构，下载安装包</span></span><br><span class="line">mkdir -p /app/&#123;<span class="built_in">local</span>,data&#125;</span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PCRE - Perl Compatible Regular Expressions</span></span><br><span class="line">wget <span class="string">"ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz"</span></span><br><span class="line"><span class="comment">#Tengine</span></span><br><span class="line">wget <span class="string">"http://tengine.taobao.org/download/tengine-2.1.0.tar.gz"</span></span><br><span class="line"><span class="comment">#MySQL</span></span><br><span class="line">wget <span class="string">"https://downloads.mariadb.com/archives/mysql-5.6/mysql-5.6.25-linux-glibc2.5-x86_64.tar.gz"</span></span><br><span class="line"><span class="comment">#PHP</span></span><br><span class="line">wget <span class="string">"http://cn2.php.net/distributions/php-5.6.11.tar.gz"</span></span><br><span class="line"><span class="comment">#Mhash</span></span><br><span class="line">wget <span class="string">"http://downloads.sourceforge.net/mhash/mhash-0.9.9.9.tar.gz"</span></span><br><span class="line"><span class="comment">#libmcrypt</span></span><br><span class="line">wget <span class="string">"http://downloads.sourceforge.net/mcrypt/libmcrypt-2.5.8.tar.gz"</span></span><br><span class="line"><span class="comment">#Mcrypt</span></span><br><span class="line">wget <span class="string">"http://downloads.sourceforge.net/mcrypt/mcrypt-2.6.8.tar.gz"</span></span><br></pre></td></tr></table></figure>
<h2 id="配置Tengine">配置Tengine</h2><h3 id="安装PCRE">安装PCRE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf pcre-<span class="number">8.37</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> pcre-<span class="number">8.37</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure>
<h2 id="安装Tengine">安装Tengine</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加www用户和组</span></span><br><span class="line">groupadd www</span><br><span class="line">useradd -g www www</span><br><span class="line"><span class="comment">#安装Tengine</span></span><br><span class="line">tar zxvf tengine-<span class="number">2.1</span>.<span class="number">0</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> tengine-<span class="number">2.1</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line">./configure --user=www --group=www \</span><br><span class="line">--prefix=/app/<span class="built_in">local</span>/nginx \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-pcre=/app/<span class="built_in">local</span>/pcre-<span class="number">8.37</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br></pre></td></tr></table></figure>
<h3 id="配置Nginx">配置Nginx</h3><blockquote>
<p>Nginx配置文件的优化很重要，理解每一步的意义</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改nginx.conf</span></span><br><span class="line">vi /app/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#用户和用户组</span></span><br><span class="line">user  www www;</span><br><span class="line"><span class="comment">#工作进程，一般可以按CPU核数设定</span></span><br><span class="line">worker_processes  auto;</span><br><span class="line">worker_cpu_affinity auto;</span><br><span class="line"><span class="comment">#全局错误日志级别</span></span><br><span class="line"><span class="comment"># [ debug | info | notice | warn | error | crit ]</span></span><br><span class="line">error_<span class="built_in">log</span>  logs/error.log  error;</span><br><span class="line"><span class="comment">#PID文件位置</span></span><br><span class="line">pid  logs/nginx.pid;</span><br><span class="line"><span class="comment">#更改worker进程的最大打开文件数限制，避免"too many open files"</span></span><br><span class="line">worker_rlimit_nofile <span class="number">65535</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#events事件指令是设定Nginx的工作模式及连接数上限</span></span><br><span class="line">events&#123;</span><br><span class="line">     <span class="comment">#epoll是Linux首选的高效工作模式</span></span><br><span class="line">     use epoll;</span><br><span class="line">     <span class="comment">#告诉nginx收到一个新连接通知后接受尽可能多的连接</span></span><br><span class="line">     multi_accept on;</span><br><span class="line">     <span class="comment">#用于定义Nginx每个进程的最大连接数</span></span><br><span class="line">     worker_connections      <span class="number">65536</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#HTTP模块控制着nginx http处理的所有核心特性</span></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    <span class="comment">#设置文件使用的默认的MIME-type</span></span><br><span class="line">    default_<span class="built_in">type</span>  application/octet-stream;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">#对日志格式的设定，main为日志格式别名</span></span><br><span class="line">    <span class="built_in">log</span>_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line">    <span class="comment">#设置nginx是否将存储访问日志。关闭这个选项可以让读取磁盘IO操作更快</span></span><br><span class="line">    access_<span class="built_in">log</span> off;</span><br><span class="line">    <span class="comment"># access_log logs/access.log main buffer=16k;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#开启gzip压缩，实时压缩输出数据流</span></span><br><span class="line">    gzip on;</span><br><span class="line">    <span class="comment">#设置IE6或者更低版本禁用gzip功能</span></span><br><span class="line">    gzip_<span class="built_in">disable</span> <span class="string">"MSIE [1-6]\."</span>;</span><br><span class="line">    <span class="comment">#前端的缓存服务器缓存经过gzip压缩的页面</span></span><br><span class="line">    gzip_vary on;</span><br><span class="line">    <span class="comment">#允许压缩基于请求和响应的响应流</span></span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    <span class="comment">#设置数据的压缩等级</span></span><br><span class="line">    gzip_comp_level <span class="number">4</span>;</span><br><span class="line">    <span class="comment">#设置对数据启用压缩的最少字节数</span></span><br><span class="line">    gzip_min_length <span class="number">1</span>k;</span><br><span class="line">    <span class="comment">#表示申请16个单位为64K的内存作为压缩结果流缓存</span></span><br><span class="line">    gzip_buffers <span class="number">16</span> <span class="number">64</span>k;</span><br><span class="line">    <span class="comment">#用于设置识别HTTP协议版本</span></span><br><span class="line">    gzip_http_version <span class="number">1.1</span>;</span><br><span class="line">    <span class="comment">#用来指定压缩的类型</span></span><br><span class="line">    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">    <span class="comment">#打开缓存的同时也指定了缓存最大数目，以及缓存的时间</span></span><br><span class="line">    open_file_cache max=<span class="number">200000</span> inactive=<span class="number">20</span>s;</span><br><span class="line">    <span class="comment">#在open_file_cache中指定检测正确信息的间隔时间</span></span><br><span class="line">    open_file_cache_valid <span class="number">30</span>s;</span><br><span class="line">    <span class="comment">#定义了open_file_cache中指令参数不活动时间期间里最小的文件数</span></span><br><span class="line">    open_file_cache_min_uses <span class="number">2</span>;</span><br><span class="line">    <span class="comment">#指定了当搜索一个文件时是否缓存错误信息，也包括再次给配置中添加文件</span></span><br><span class="line">    open_file_cache_errors on; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">#设置允许客户端请求的最大的单个文件字节数</span></span><br><span class="line">    client_max_body_size <span class="number">30</span>M;</span><br><span class="line">    <span class="comment">#设置客户端请求主体读取超时时间</span></span><br><span class="line">    client_body_timeout <span class="number">10</span>;</span><br><span class="line">    <span class="comment">#设置客户端请求头读取超时时间</span></span><br><span class="line">    client_header_timeout <span class="number">10</span>;</span><br><span class="line">    <span class="comment">#指定来自客户端请求头的headerbuffer大小</span></span><br><span class="line">    client_header_buffer_size <span class="number">32</span>k;</span><br><span class="line">    <span class="comment">#设置客户端连接保持活动的超时时间</span></span><br><span class="line">    keepalive_timeout <span class="number">60</span>;</span><br><span class="line">    <span class="comment">#关闭不响应的客户端连接</span></span><br><span class="line">    reset_timedout_connection on;</span><br><span class="line">    <span class="comment">#设置响应客户端的超时时间</span></span><br><span class="line">    send_timeout <span class="number">10</span>;</span><br><span class="line">    <span class="comment">#开启高效文件传输模式</span></span><br><span class="line">    sendfile on;</span><br><span class="line">    <span class="comment">#告诉nginx在一个数据包里发送所有头文件，而不一个接一个的发送</span></span><br><span class="line">    tcp_nopush on;</span><br><span class="line">    <span class="comment">#告诉nginx不要缓存数据，而是一段一段的发送</span></span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    <span class="comment">#设置用于保存各种key（比如当前连接数）的共享内存的参数</span></span><br><span class="line">    <span class="built_in">limit</span>_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:<span class="number">5</span>m; </span><br><span class="line">    <span class="comment">#给定的key设置最大连接数，允许每一个IP地址最多同时打开有100个连接</span></span><br><span class="line">    <span class="built_in">limit</span>_conn addr <span class="number">100</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度</span></span><br><span class="line">    fastcgi_buffers <span class="number">256</span> <span class="number">16</span>k;</span><br><span class="line">    fastcgi_buffer_size <span class="number">128</span>k;</span><br><span class="line">    fastcgi_connect_timeout <span class="number">3</span>s;</span><br><span class="line">    fastcgi_send_timeout <span class="number">120</span>s;</span><br><span class="line">    fastcgi_<span class="built_in">read</span>_timeout <span class="number">120</span>s;</span><br><span class="line">    server_names_<span class="built_in">hash</span>_bucket_size <span class="number">128</span>;</span><br><span class="line">    <span class="comment">#不在error_log中记录不存在的错误</span></span><br><span class="line">    <span class="built_in">log</span>_not_found off;</span><br><span class="line">    <span class="comment">#关闭在错误页面中的nginx版本数字，提高安全性</span></span><br><span class="line">    <span class="comment">#server_tag Apache;</span></span><br><span class="line">    server_tokens off;</span><br><span class="line">    <span class="comment">#tengine</span></span><br><span class="line">    server_tag off;</span><br><span class="line">    server_info off;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#添加虚拟主机的配置文件</span></span><br><span class="line">    include vhosts/*.conf;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#负载均衡配置（暂时略过）</span></span><br><span class="line">    <span class="comment">#upstream test.com</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#设定虚拟主机配置</span></span><br><span class="line">    server &#123;</span><br><span class="line">        <span class="comment">#侦听80端口</span></span><br><span class="line">        listen       <span class="number">80</span>;</span><br><span class="line">        <span class="comment">#定义使用localhost访问</span></span><br><span class="line">        server_name  localhost;</span><br><span class="line">        <span class="comment">#定义首页索引文件的名称</span></span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        <span class="comment">#定义服务器的默认网站根目录位置</span></span><br><span class="line">        root    /app/data/localhost/;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">#定义错误提示页面</span></span><br><span class="line">        error_page  <span class="number">404</span>              /<span class="number">404</span>.html;</span><br><span class="line">        error_page  <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">        location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">#PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.     </span></span><br><span class="line">        location ~ .*\.(php|php5)?$ &#123;</span><br><span class="line">            fastcgi_pass   <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>;</span><br><span class="line">            fastcgi_index  index.php;</span><br><span class="line">            include        fastcgi.conf;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#静态文件</span></span><br><span class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|ico)$</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">#过期30天，频繁更新可设置小一点</span></span><br><span class="line">            expires      <span class="number">30</span>d;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        location ~ .*\.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">#过期1小时，不更新可设置大一些</span></span><br><span class="line">            expires      <span class="number">1</span>h;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#禁止访问</span></span><br><span class="line">        location ~ /\. &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>简化配置文件<br>vi /app/local/nginx/conf/nginx.conf</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">user  www www;</span><br><span class="line">worker_processes auto;</span><br><span class="line">worker_cpu_affinity auto;</span><br><span class="line"></span><br><span class="line">error_<span class="built_in">log</span>  logs/error.log  crit;</span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">worker_rlimit_nofile <span class="number">51200</span>;</span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">    use epoll;</span><br><span class="line">    multi_accept on;</span><br><span class="line">    worker_connections <span class="number">51200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_<span class="built_in">type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">log</span>_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">    access_<span class="built_in">log</span> off;</span><br><span class="line">    <span class="comment">#access_log logs/access.log main buffer=16k;</span></span><br><span class="line"></span><br><span class="line">    server_names_<span class="built_in">hash</span>_bucket_size <span class="number">128</span>;</span><br><span class="line">    client_header_buffer_size <span class="number">32</span>k;</span><br><span class="line">    large_client_header_buffers <span class="number">4</span> <span class="number">32</span>k;</span><br><span class="line">    client_max_body_size <span class="number">50</span>M; </span><br><span class="line"></span><br><span class="line">    sendfile on;</span><br><span class="line">    tcp_nopush on;</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    keepalive_timeout <span class="number">60</span>; </span><br><span class="line">    server_tokens off;</span><br><span class="line">    server_tag off;</span><br><span class="line">    server_info off;</span><br><span class="line"></span><br><span class="line">    fastcgi_connect_timeout <span class="number">300</span>;</span><br><span class="line">    fastcgi_send_timeout <span class="number">300</span>;</span><br><span class="line">    fastcgi_<span class="built_in">read</span>_timeout <span class="number">300</span>;</span><br><span class="line">    fastcgi_buffer_size <span class="number">64</span>k;</span><br><span class="line">    fastcgi_buffers <span class="number">4</span> <span class="number">64</span>k;</span><br><span class="line">    fastcgi_busy_buffers_size <span class="number">128</span>k;</span><br><span class="line">    fastcgi_temp_file_write_size <span class="number">256</span>k;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip on;</span></span><br><span class="line">    <span class="comment">#gzip_min_length  1k;</span></span><br><span class="line">    <span class="comment">#gzip_buffers     4 16k;</span></span><br><span class="line">    <span class="comment">#gzip_http_version 1.1;</span></span><br><span class="line">    <span class="comment">#gzip_comp_level 5;</span></span><br><span class="line">    <span class="comment">#gzip_types       text/plain application/x-javascript text/css application/xml;</span></span><br><span class="line">    <span class="comment">#gzip_vary on;</span></span><br><span class="line"></span><br><span class="line">    include vhosts/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>分离server写入vhosts<br>mkdir -p  /app/local/nginx/conf/vhosts/<br>vi /app/local/nginx/conf/vhosts/localhost.conf</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    index index.php index.html index.htm;</span><br><span class="line">    access_<span class="built_in">log</span>  logs/localhost.log  main;</span><br><span class="line"></span><br><span class="line">    root    /app/data/localhost/;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        index  index.php index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line">    <span class="comment">#error_page  500 502 503 504  /50x.html;</span></span><br><span class="line"></span><br><span class="line">    location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(php|php5)?$ &#123;</span><br><span class="line">        fastcgi_pass   <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span>;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">      <span class="comment">#fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;</span></span><br><span class="line">        include        fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf|ico)$</span><br><span class="line">    &#123;</span><br><span class="line">        expires      <span class="number">30</span>d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(js|css)?$</span><br><span class="line">    &#123;</span><br><span class="line">        expires      <span class="number">1</span>h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ /\. &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检查语法</span></span><br><span class="line">/app/<span class="built_in">local</span>/nginx/sbin/nginx -t</span><br><span class="line"><span class="comment"># ./nginx -t</span></span><br><span class="line">the configuration file /app/<span class="built_in">local</span>/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">configuration file /app/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试用例</span></span><br><span class="line">mkdir -p /app/data/localhost</span><br><span class="line">chmod +w /app/data/localhost</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?php phpinfo();?&gt;"</span> &gt; /app/data/localhost/phpinfo.php</span><br><span class="line">chown -R www:www /app/data/localhost</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置nginx系统变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/app/local/nginx/sbin'</span>&gt;&gt;/etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试访问</span></span><br><span class="line">curl -I http://localhost</span><br><span class="line"></span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">Server: Tengine/<span class="number">2.1</span>.<span class="number">0</span></span><br><span class="line">Date: Mon, <span class="number">27</span> Jul <span class="number">2015</span> <span class="number">06</span>:<span class="number">42</span>:<span class="number">25</span> GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-<span class="number">8</span></span><br><span class="line">Connection: keep-alive</span><br><span class="line">X-Powered-By: PHP/<span class="number">5.6</span>.<span class="number">11</span></span><br></pre></td></tr></table></figure>
<h3 id="添加Tengine到服务">添加Tengine到服务</h3><blockquote>
<p>配置服务后便于统一管理<br>vi /etc/rc.d/init.d/nginx</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span><br><span class="line"> </span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$NETWORKING</span>"</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">nginx=<span class="string">"/app/local/nginx/sbin/nginx"</span></span><br><span class="line">prog=$(basename <span class="variable">$nginx</span>)</span><br><span class="line"> </span><br><span class="line">NGINX_CONF_FILE=<span class="string">"/app/local/nginx/conf/nginx.conf"</span></span><br><span class="line"> </span><br><span class="line">[ <span class="operator">-f</span> /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line"> </span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">make_dirs</span></span>() &#123;</span><br><span class="line">   <span class="comment"># make required directories</span></span><br><span class="line">   user=`<span class="variable">$nginx</span> -V <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep <span class="string">"configure arguments:"</span> | sed <span class="string">'s/[^*]*--user=\([^ ]*\).*/\1/g'</span> -`</span><br><span class="line">   <span class="keyword">if</span> [ -z <span class="string">"`grep <span class="variable">$user</span> /etc/passwd`"</span> ]; <span class="keyword">then</span></span><br><span class="line">       useradd -M <span class="operator">-s</span> /bin/nologin <span class="variable">$user</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   options=`<span class="variable">$nginx</span> -V <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep <span class="string">'configure arguments:'</span>`</span><br><span class="line">   <span class="keyword">for</span> opt <span class="keyword">in</span> <span class="variable">$options</span>; <span class="keyword">do</span></span><br><span class="line">       <span class="keyword">if</span> [ `<span class="built_in">echo</span> <span class="variable">$opt</span> | grep <span class="string">'.*-temp-path'</span>` ]; <span class="keyword">then</span></span><br><span class="line">           value=`<span class="built_in">echo</span> <span class="variable">$opt</span> | cut <span class="operator">-d</span> <span class="string">"="</span> <span class="operator">-f</span> <span class="number">2</span>`</span><br><span class="line">           <span class="keyword">if</span> [ ! <span class="operator">-d</span> <span class="string">"<span class="variable">$value</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">               <span class="comment"># echo "creating" $value</span></span><br><span class="line">               mkdir -p <span class="variable">$value</span> &amp;&amp; chown -R <span class="variable">$user</span> <span class="variable">$value</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">       <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    [ -x <span class="variable">$nginx</span> ] || <span class="built_in">exit</span> <span class="number">5</span></span><br><span class="line">    [ <span class="operator">-f</span> <span class="variable">$NGINX_CONF_FILE</span> ] || <span class="built_in">exit</span> <span class="number">6</span></span><br><span class="line">    make_<span class="built_in">dirs</span></span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">    daemon <span class="variable">$nginx</span> -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> <span class="operator">-eq</span> <span class="number">0</span> ] &amp;&amp; touch <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$prog</span> -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> <span class="operator">-eq</span> <span class="number">0</span> ] &amp;&amp; rm <span class="operator">-f</span> <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    stop</span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Reloading <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$nginx</span> -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">force_reload</span></span>() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">configtest</span></span>() &#123;</span><br><span class="line">  <span class="variable">$nginx</span> -t -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">rh_status</span></span>() &#123;</span><br><span class="line">    status <span class="variable">$prog</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">rh_status_q</span></span>() &#123;</span><br><span class="line">    rh_status &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">7</span></span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改执行权限</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line"><span class="built_in">ulimit</span> -SHn <span class="number">65535</span></span><br><span class="line">service nginx start</span><br></pre></td></tr></table></figure>
<h2 id="安装MySQL">安装MySQL</h2><blockquote>
<p>注意目录和字符集等配置文件，推荐使用InnoDB作为存储引擎</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#解压mysql</span></span><br><span class="line">mkdir -p /app/<span class="built_in">local</span>/mysql</span><br><span class="line">tar zxvf mysql-<span class="number">5.6</span>.<span class="number">25</span>-linux-glibc2.<span class="number">5</span>-x86_64.tar.gz</span><br><span class="line">mv mysql-<span class="number">5.6</span>.<span class="number">25</span>-linux-glibc2.<span class="number">5</span>-x86_64/* /app/<span class="built_in">local</span>/mysql</span><br><span class="line"><span class="comment">#增加mysql用户组</span></span><br><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line">mkdir -p /app/data/mysql/data/</span><br><span class="line">mkdir -p /app/data/mysql/binlog/</span><br><span class="line">mkdir -p /app/data/mysql/relaylog/</span><br><span class="line">chown -R mysql:mysql /app/data/mysql/</span><br><span class="line"> <span class="comment">#安装mysql</span></span><br><span class="line">/app/<span class="built_in">local</span>/mysql/scripts/mysql_install_db --basedir=/app/<span class="built_in">local</span>/mysql --datadir=/app/data/mysql/data --user=mysql</span><br><span class="line"><span class="comment">#修改mysqld_safe配置路径</span></span><br><span class="line">sed -i <span class="string">"s#/usr/local/mysql#/app/local/mysql#g"</span> /app/<span class="built_in">local</span>/mysql/bin/mysqld_safe</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#修改my.cnf配置文件</span></span><br><span class="line">vi /app/<span class="built_in">local</span>/mysql/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL客户端</span></span><br><span class="line">[client]</span><br><span class="line">character-set-server = utf8</span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"><span class="comment">#prompt="(\u:HOSTNAME:)[\d]&gt; "</span></span><br><span class="line"><span class="comment">#mysql提示符中显示当前用户、数据库、时间等信息</span></span><br><span class="line">prompt=<span class="string">"\u@\h \R:\m:\s [\d]&gt; "</span></span><br><span class="line"><span class="comment">#取消自动补全</span></span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL服务端 </span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">#唯一的服务标识号，主从同步会涉及</span></span><br><span class="line">server-id = <span class="number">1</span></span><br><span class="line">port = <span class="number">3306</span></span><br><span class="line">user = mysql</span><br><span class="line">basedir = /app/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir = /app/data/mysql/data</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"><span class="built_in">log</span>-error = /app/data/mysql/mysql_error.log</span><br><span class="line">pid-file = /app/data/mysql/mysql.pid</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line"><span class="comment">#默认存储引擎</span></span><br><span class="line">default-storage-engine = InnoDB</span><br><span class="line"><span class="comment">#设置最大并发连接数，如果前端程序是PHP，可适当加大，但不可过大。如果前端程序采用连接池，可适当调小，避免连接数过大</span></span><br><span class="line">max_connections = <span class="number">512</span></span><br><span class="line"><span class="comment">#最大连接错误次数，可适当加大，防止频繁连接错误后，前端host被mysql拒绝掉</span></span><br><span class="line">max_connect_errors = <span class="number">100000</span></span><br><span class="line"><span class="comment">#所有线程所打开表的数量</span></span><br><span class="line">table_open_cache = <span class="number">512</span></span><br><span class="line"><span class="comment">#不允许外部文件级别的锁. 打开文件锁会对性能造成负面影响</span></span><br><span class="line">external-locking = FALSE</span><br><span class="line"><span class="comment">#服务所能处理的请求包的最大大小以及服务所能处理的最大的请求大小</span></span><br><span class="line">max_allowed_packet = <span class="number">32</span>M</span><br><span class="line"><span class="comment">#启用慢查询日志</span></span><br><span class="line">slow_query_<span class="built_in">log</span> = <span class="number">1</span></span><br><span class="line">slow_query_<span class="built_in">log</span>_file = /app/data/mysql/slow.log</span><br><span class="line"><span class="comment">#MySQL打开的文件描述符限制</span></span><br><span class="line">open_files_<span class="built_in">limit</span> = <span class="number">10240</span></span><br><span class="line"><span class="comment">#操作系统在监听队列中所能保持的连接数</span></span><br><span class="line">back_<span class="built_in">log</span> = <span class="number">600</span></span><br><span class="line"><span class="comment">#每个连接都会分配的一些排序、连接等缓冲</span></span><br><span class="line">sort_buffer_size = <span class="number">16</span>M</span><br><span class="line">join_buffer_size = <span class="number">16</span>M</span><br><span class="line"><span class="built_in">read</span>_buffer_size = <span class="number">16</span>M</span><br><span class="line"><span class="built_in">read</span>_rnd_buffer_size = <span class="number">16</span>M</span><br><span class="line"><span class="comment">#在cache中保留多少线程用于重用</span></span><br><span class="line">thread_cache_size = <span class="number">300</span></span><br><span class="line"><span class="comment">#查询缓冲     </span></span><br><span class="line">query_cache_size = <span class="number">128</span>M</span><br><span class="line"><span class="comment">#只有小于此设定值的结果才会被缓冲     </span></span><br><span class="line">query_cache_<span class="built_in">limit</span> = <span class="number">4</span>M</span><br><span class="line"><span class="comment">#设置查询缓存分配内存的最小单位</span></span><br><span class="line">query_cache_min_res_unit = <span class="number">2</span>k</span><br><span class="line"><span class="comment">#线程使用的堆大小</span></span><br><span class="line">thread_stack = <span class="number">512</span>K</span><br><span class="line"><span class="comment">#设置事务隔离级别为 READ-COMMITED，提高事务效率，通常都满足事务一致性要求</span></span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line"><span class="comment">#临时表的最大大小</span></span><br><span class="line">tmp_table_size = <span class="number">256</span>M</span><br><span class="line"><span class="comment">#独立的内存表所允许的最大容量</span></span><br><span class="line">max_heap_table_size = <span class="number">256</span>M</span><br><span class="line"><span class="comment">#设置慢查询阀值</span></span><br><span class="line">long_query_time = <span class="number">3</span></span><br><span class="line"><span class="comment">#表示slave将复制事件写进自己的二进制日志</span></span><br><span class="line"><span class="built_in">log</span>-slave-updates</span><br><span class="line"><span class="comment">#打开二进制日志功能</span></span><br><span class="line"><span class="built_in">log</span>-bin = /app/data/mysql/binlog/binlog</span><br><span class="line">sync_binlog = <span class="number">1</span></span><br><span class="line"><span class="comment">#在一个事务中binlog为了记录SQL状态所持有的cache大小  </span></span><br><span class="line">binlog_cache_size = <span class="number">4</span>M</span><br><span class="line"><span class="comment">#设置混合模式</span></span><br><span class="line">binlog_format = MIXED</span><br><span class="line"><span class="comment">#表示的是binlog能够使用的最大cache 内存大小</span></span><br><span class="line">max_binlog_cache_size = <span class="number">8</span>M</span><br><span class="line"><span class="comment">#binlog最大值</span></span><br><span class="line">max_binlog_size = <span class="number">1</span>G</span><br><span class="line"><span class="comment">#启用中继日志</span></span><br><span class="line">relay-log-index = /app/data/mysql/relaylog/relaylog</span><br><span class="line">relay-log-info-file = /app/data/mysql/relaylog/relaylog</span><br><span class="line">relay-log = /app/data/mysql/relaylog/relaylog</span><br><span class="line"><span class="comment">#设置了只保留7天binlog</span></span><br><span class="line">expire_logs_days = <span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MyISAM 相关选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#关键词缓冲的大小, 一般用来缓冲MyISAM表的索引块</span></span><br><span class="line">key_buffer_size = <span class="number">128</span>M</span><br><span class="line"><span class="comment">#排序缓存</span></span><br><span class="line"><span class="built_in">read</span>_rnd_buffer_size = <span class="number">64</span>M</span><br><span class="line"><span class="comment">#限制每个进程中缓冲树的字节数</span></span><br><span class="line">bulk_insert_buffer_size = <span class="number">256</span>M</span><br><span class="line"><span class="comment">#MyISAM表发生变化时重新排序所需的缓冲</span></span><br><span class="line">myisam_sort_buffer_size = <span class="number">256</span>M</span><br><span class="line"><span class="comment">#MySQL重建索引时所允许的最大临时文件的大小</span></span><br><span class="line">myisam_max_sort_file_size = <span class="number">10</span>G</span><br><span class="line"><span class="comment">#如果一个表拥有超过一个索引, MyISAM 可以通过并行排序使用超过一个线程去修复他们</span></span><br><span class="line">myisam_repair_threads = <span class="number">1</span></span><br><span class="line"><span class="comment">#自动检查和修复没有适当关闭的 MyISAM 表</span></span><br><span class="line">myisam_recover</span><br><span class="line"></span><br><span class="line"><span class="comment">#InnoDB 相关选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#InnoDB存储数据字典、内部数据结构的缓冲池，16MB 已经足够大了     </span></span><br><span class="line">innodb_additional_mem_pool_size = <span class="number">16</span>M</span><br><span class="line"><span class="comment">#InnoDB用于缓存数据、索引、锁、插入缓冲、数据字典等</span></span><br><span class="line"><span class="comment">#如果是专用的DB服务器，且以InnoDB引擎为主的场景，通常可设置物理内存的50%</span></span><br><span class="line"><span class="comment">#如果是非专用DB服务器，可以先尝试设置成内存的1/4，如果有问题再调整</span></span><br><span class="line">innodb_buffer_pool_size = <span class="number">4</span>G</span><br><span class="line"><span class="comment">#InnoDB共享表空间初始化大小，默认是 10MB，也非常坑X，改成 1GB，并且自动扩展</span></span><br><span class="line">innodb_data_file_path = ibdata1:<span class="number">1</span>G:autoextend</span><br><span class="line"><span class="comment">#如果将此参数设置为1，将在每次提交事务后将日志写入磁盘，能较好保护数据可靠性。为提供性能可以设置为0或2，但要承担在发生故障时丢失数据的风险</span></span><br><span class="line">innodb_flush_<span class="built_in">log</span>_at_trx_commit = <span class="number">1</span></span><br><span class="line"><span class="comment">#InnoDB的log buffer，通常设置为 64MB 就足够了</span></span><br><span class="line">innodb_<span class="built_in">log</span>_buffer_size = <span class="number">64</span>M</span><br><span class="line"><span class="comment">#InnoDB redo log大小，通常设置256MB 就足够了</span></span><br><span class="line">innodb_<span class="built_in">log</span>_file_size = <span class="number">256</span>M</span><br><span class="line"><span class="comment">#InnoDB redo log文件组，通常设置为 2 就足够了</span></span><br><span class="line">innodb_<span class="built_in">log</span>_files_<span class="keyword">in</span>_group = <span class="number">2</span></span><br><span class="line"><span class="comment">#Buffer_Pool中Dirty_Page所占的数量，直接影响InnoDB的关闭时间</span></span><br><span class="line">innodb_max_dirty_pages_pct = <span class="number">90</span></span><br><span class="line"><span class="comment">#启用InnoDB的独立表空间模式，便于管理</span></span><br><span class="line">innodb_file_per_table = <span class="number">1</span></span><br><span class="line"><span class="comment">#控制innodb是否对gap加锁</span></span><br><span class="line">innodb_locks_unsafe_<span class="keyword">for</span>_binlog = <span class="number">0</span></span><br><span class="line"><span class="comment">#设置连接超时阀值，如果前端程序采用短连接，建议缩短这2个值</span></span><br><span class="line"><span class="comment">#如果前端程序采用长连接，可直接注释掉这两个选项，是用默认配置(8小时)</span></span><br><span class="line">interactive_timeout = <span class="number">120</span></span><br><span class="line"><span class="built_in">wait</span>_timeout = <span class="number">120</span></span><br><span class="line"><span class="comment">#不再进行反解析(ip不反解成域名)，这样可以加快数据库的反应时间</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="comment">#主从复制跳过错误</span></span><br><span class="line">slave-skip-errors = <span class="number">1032</span>,<span class="number">1062</span>,<span class="number">126</span>,<span class="number">1114</span>,<span class="number">1146</span>,<span class="number">1048</span>,<span class="number">1396</span></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line"><span class="comment">#不要在将内存中的整个结果写入磁盘之前缓存. 在导出非常巨大的表时需要此项</span></span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = <span class="number">32</span>M</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#添加mysql到服务</span></span><br><span class="line">vi /etc/rc.d/init.d/mysqld</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line">basedir=/app/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir=/app/data/mysql/data</span><br><span class="line">service_startup_timeout=<span class="number">900</span></span><br><span class="line">lockdir=<span class="string">'/var/lock/subsys'</span></span><br><span class="line">lock_file_path=<span class="string">"<span class="variable">$lockdir</span>/mysql"</span></span><br><span class="line">mysqld_pid_file_path=/app/data/mysql/mysql.pid</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$basedir</span>"</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  basedir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">  bindir=/usr/<span class="built_in">local</span>/mysql/bin</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$datadir</span>"</span></span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    datadir=/usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  sbindir=/usr/<span class="built_in">local</span>/mysql/bin</span><br><span class="line">  libexecdir=/usr/<span class="built_in">local</span>/mysql/bin</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  bindir=<span class="string">"<span class="variable">$basedir</span>/bin"</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$datadir</span>"</span></span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    datadir=<span class="string">"<span class="variable">$basedir</span>/data"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  sbindir=<span class="string">"<span class="variable">$basedir</span>/sbin"</span></span><br><span class="line">  libexecdir=<span class="string">"<span class="variable">$basedir</span>/libexec"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">datadir_<span class="built_in">set</span>=</span><br><span class="line">lsb_<span class="built_in">functions</span>=<span class="string">"/lib/lsb/init-functions"</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-f</span> <span class="variable">$lsb_functions</span> ; <span class="keyword">then</span></span><br><span class="line">  . <span class="variable">$lsb_functions</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="function"><span class="title">log_success_msg</span></span>()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">" SUCCESS! <span class="variable">$@</span>"</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">log_failure_msg</span></span>()</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">" ERROR! <span class="variable">$@</span>"</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">PATH=<span class="string">"/sbin:/usr/sbin:/bin:/usr/bin:<span class="variable">$basedir</span>/bin"</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"> </span><br><span class="line">mode=<span class="variable">$1</span>    <span class="comment"># start or stop</span></span><br><span class="line"> </span><br><span class="line">[ <span class="variable">$#</span> -ge <span class="number">1</span> ] &amp;&amp; <span class="built_in">shift</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">other_args=<span class="string">"$*"</span>   <span class="comment"># uncommon, but needed when called from an RPM upgrade action</span></span><br><span class="line">           <span class="comment"># Expected: "--skip-networking --skip-grant-tables"</span></span><br><span class="line">           <span class="comment"># They are not checked here, intentionally, as it is the resposibility</span></span><br><span class="line">           <span class="comment"># of the "spec" file author to give correct arguments only.</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> `<span class="built_in">echo</span> <span class="string">"testing\c"</span>`,`<span class="built_in">echo</span> -n testing` <span class="keyword">in</span></span><br><span class="line">    *c*,-n*) <span class="built_in">echo</span>_n=   <span class="built_in">echo</span>_c=     ;;</span><br><span class="line">    *c*,*)   <span class="built_in">echo</span>_n=-n <span class="built_in">echo</span>_c=     ;;</span><br><span class="line">    *)       <span class="built_in">echo</span>_n=   <span class="built_in">echo</span>_c=<span class="string">'\c'</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">parse_server_arguments</span></span>() &#123;</span><br><span class="line">  <span class="keyword">for</span> arg <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"<span class="variable">$arg</span>"</span> <span class="keyword">in</span></span><br><span class="line">      --basedir=*)  basedir=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$arg</span>"</span> | sed <span class="operator">-e</span> <span class="string">'s/^[^=]*=//'</span>`</span><br><span class="line">                    bindir=<span class="string">"<span class="variable">$basedir</span>/bin"</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$datadir_set</span>"</span>; <span class="keyword">then</span></span><br><span class="line">              datadir=<span class="string">"<span class="variable">$basedir</span>/data"</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            sbindir=<span class="string">"<span class="variable">$basedir</span>/sbin"</span></span><br><span class="line">            libexecdir=<span class="string">"<span class="variable">$basedir</span>/libexec"</span></span><br><span class="line">        ;;</span><br><span class="line">      --datadir=*)  datadir=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$arg</span>"</span> | sed <span class="operator">-e</span> <span class="string">'s/^[^=]*=//'</span>`</span><br><span class="line">            datadir_<span class="built_in">set</span>=<span class="number">1</span></span><br><span class="line">    ;;</span><br><span class="line">      --pid-file=*) mysqld_pid_file_path=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$arg</span>"</span> | sed <span class="operator">-e</span> <span class="string">'s/^[^=]*=//'</span>` ;;</span><br><span class="line">      --service-startup-timeout=*) service_startup_timeout=`<span class="built_in">echo</span> <span class="string">"<span class="variable">$arg</span>"</span> | sed <span class="operator">-e</span> <span class="string">'s/^[^=]*=//'</span>` ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">wait_for_pid</span></span> () &#123;</span><br><span class="line">  verb=<span class="string">"<span class="variable">$1</span>"</span>           <span class="comment"># created | removed</span></span><br><span class="line">  pid=<span class="string">"<span class="variable">$2</span>"</span>            <span class="comment"># process ID of the program operating on the pid-file</span></span><br><span class="line">  pid_file_path=<span class="string">"<span class="variable">$3</span>"</span> <span class="comment"># path to the PID file.</span></span><br><span class="line"> </span><br><span class="line">  i=<span class="number">0</span></span><br><span class="line">  avoid_race_condition=<span class="string">"by checking again"</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">while</span> <span class="built_in">test</span> <span class="variable">$i</span> <span class="operator">-ne</span> <span class="variable">$service_startup_timeout</span> ; <span class="keyword">do</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">case</span> <span class="string">"<span class="variable">$verb</span>"</span> <span class="keyword">in</span></span><br><span class="line">      <span class="string">'created'</span>)</span><br><span class="line">        <span class="comment"># wait for a PID-file to pop into existence.</span></span><br><span class="line">        <span class="built_in">test</span> <span class="operator">-s</span> <span class="string">"<span class="variable">$pid_file_path</span>"</span> &amp;&amp; i=<span class="string">''</span> &amp;&amp; <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">      <span class="string">'removed'</span>)</span><br><span class="line">        <span class="comment"># wait for this PID-file to disappear</span></span><br><span class="line">        <span class="built_in">test</span> ! <span class="operator">-s</span> <span class="string">"<span class="variable">$pid_file_path</span>"</span> &amp;&amp; i=<span class="string">''</span> &amp;&amp; <span class="built_in">break</span></span><br><span class="line">        ;;</span><br><span class="line">      *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"wait_for_pid () usage: wait_for_pid created|removed pid pid_file_path"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># if server isn't running, then pid-file will never be updated</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -n <span class="string">"<span class="variable">$pid</span>"</span>; <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">kill</span> -<span class="number">0</span> <span class="string">"<span class="variable">$pid</span>"</span> <span class="number">2</span>&gt;/dev/null; <span class="keyword">then</span></span><br><span class="line">        :  <span class="comment"># the server still runs</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="comment"># The server may have exited between the last pid-file check and now.  </span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> -n <span class="string">"<span class="variable">$avoid_race_condition</span>"</span>; <span class="keyword">then</span></span><br><span class="line">          avoid_race_condition=<span class="string">""</span></span><br><span class="line">          <span class="built_in">continue</span>  <span class="comment"># Check again.</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># there's nothing that will affect the file.</span></span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"The server quit without updating PID file (<span class="variable">$pid_file_path</span>)."</span></span><br><span class="line">        <span class="built_in">return</span> <span class="number">1</span>  <span class="comment"># not waiting any more.</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$echo_n</span> <span class="string">".<span class="variable">$echo_c</span>"</span></span><br><span class="line">    i=`expr <span class="variable">$i</span> + <span class="number">1</span>`</span><br><span class="line">    sleep <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$i</span>"</span> ; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">log</span>_success_msg</span><br><span class="line">    <span class="built_in">return</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">log</span>_failure_msg</span><br><span class="line">    <span class="built_in">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Get arguments from the my.cnf file,</span></span><br><span class="line"><span class="comment"># the only group, which is read from now on is [mysqld]</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -x ./bin/my_<span class="built_in">print</span>_defaults</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">print</span>_defaults=<span class="string">"./bin/my_print_defaults"</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> -x <span class="variable">$bindir</span>/my_<span class="built_in">print</span>_defaults</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">print</span>_defaults=<span class="string">"<span class="variable">$bindir</span>/my_print_defaults"</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">test</span> -x <span class="variable">$bindir</span>/mysql_<span class="built_in">print</span>_defaults</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">print</span>_defaults=<span class="string">"<span class="variable">$bindir</span>/mysql_print_defaults"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># Try to find basedir in /etc/my.cnf</span></span><br><span class="line">  conf=/etc/my.cnf</span><br><span class="line">  <span class="built_in">print</span>_defaults=</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -r <span class="variable">$conf</span></span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    subpat=<span class="string">'^[^=]*basedir[^=]*=\(.*\)$'</span></span><br><span class="line">    <span class="built_in">dirs</span>=`sed <span class="operator">-e</span> <span class="string">"/<span class="variable">$subpat</span>/!d"</span> <span class="operator">-e</span> <span class="string">'s//\1/'</span> <span class="variable">$conf</span>`</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> <span class="variable">$dirs</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      d=`<span class="built_in">echo</span> <span class="variable">$d</span> | sed <span class="operator">-e</span> <span class="string">'s/[     ]//g'</span>`</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">test</span> -x <span class="string">"<span class="variable">$d</span>/bin/my_print_defaults"</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>_defaults=<span class="string">"<span class="variable">$d</span>/bin/my_print_defaults"</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">test</span> -x <span class="string">"<span class="variable">$d</span>/bin/mysql_print_defaults"</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>_defaults=<span class="string">"<span class="variable">$d</span>/bin/mysql_print_defaults"</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Hope it's in the PATH ... but I doubt it</span></span><br><span class="line">  <span class="built_in">test</span> -z <span class="string">"<span class="variable">$print_defaults</span>"</span> &amp;&amp; <span class="built_in">print</span>_defaults=<span class="string">"my_print_defaults"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Read defaults file from 'basedir'.   If there is no defaults file there</span></span><br><span class="line"><span class="comment"># check if it's in the old (depricated) place (datadir) and read it from there</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"> </span><br><span class="line">extra_args=<span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -r <span class="string">"<span class="variable">$basedir</span>/my.cnf"</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  extra_args=<span class="string">"-e <span class="variable">$basedir</span>/my.cnf"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -r <span class="string">"<span class="variable">$datadir</span>/my.cnf"</span></span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    extra_args=<span class="string">"-e <span class="variable">$datadir</span>/my.cnf"</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">parse_server_arguments `<span class="variable">$print_defaults</span> <span class="variable">$extra_args</span> mysqld server mysql_server mysql.server`</span><br><span class="line"> </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Set pid file if not given</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  mysqld_pid_file_path=<span class="variable">$datadir</span>/`hostname`.pid</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">case</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span> <span class="keyword">in</span></span><br><span class="line">    /* ) ;;</span><br><span class="line">    * )  mysqld_pid_file_path=<span class="string">"<span class="variable">$datadir</span>/<span class="variable">$mysqld_pid_file_path</span>"</span> ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$mode</span>"</span> <span class="keyword">in</span></span><br><span class="line">  <span class="string">'start'</span>)</span><br><span class="line">    <span class="comment"># Start daemon</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># Safeguard (relative paths, core dumps..)</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$basedir</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$echo_n</span> <span class="string">"Starting MySQL"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> -x <span class="variable">$bindir</span>/mysqld_safe</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">      <span class="comment"># Give extra arguments to mysqld with the my.cnf file. This script</span></span><br><span class="line">      <span class="comment"># may be overwritten at next upgrade.</span></span><br><span class="line">      <span class="variable">$bindir</span>/mysqld_safe --datadir=<span class="string">"<span class="variable">$datadir</span>"</span> --pid-file=<span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span> <span class="variable">$other_args</span> &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line">      <span class="built_in">wait</span>_<span class="keyword">for</span>_pid created <span class="string">"$!"</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span>; <span class="built_in">return</span>_value=$?</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># Make lock for RedHat / SuSE</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">test</span> -w <span class="string">"<span class="variable">$lockdir</span>"</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        touch <span class="string">"<span class="variable">$lock_file_path</span>"</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">      <span class="built_in">exit</span> <span class="variable">$return_value</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">log</span>_failure_msg <span class="string">"Couldn't find MySQL server (<span class="variable">$bindir</span>/mysqld_safe)"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line"> </span><br><span class="line">  <span class="string">'stop'</span>)</span><br><span class="line">    <span class="comment"># Stop daemon. We use a signal here to avoid having to know the</span></span><br><span class="line">    <span class="comment"># root password.</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-s</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">      mysqld_pid=`cat <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span>`</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">kill</span> -<span class="number">0</span> <span class="variable">$mysqld_pid</span> <span class="number">2</span>&gt;/dev/null)</span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$echo_n</span> <span class="string">"Shutting down MySQL"</span></span><br><span class="line">        <span class="built_in">kill</span> <span class="variable">$mysqld_pid</span></span><br><span class="line">        <span class="comment"># mysqld should remove the pid file when it exits, so wait for it.</span></span><br><span class="line">        <span class="built_in">wait</span>_<span class="keyword">for</span>_pid removed <span class="string">"<span class="variable">$mysqld_pid</span>"</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span>; <span class="built_in">return</span>_value=$?</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"MySQL server process #<span class="variable">$mysqld_pid</span> is not running!"</span></span><br><span class="line">        rm <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment"># Delete lock for RedHat / SuSE</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-f</span> <span class="string">"<span class="variable">$lock_file_path</span>"</span></span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        rm <span class="operator">-f</span> <span class="string">"<span class="variable">$lock_file_path</span>"</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">      <span class="built_in">exit</span> <span class="variable">$return_value</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">log</span>_failure_msg <span class="string">"MySQL server PID file could not be found!"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line"> </span><br><span class="line">  <span class="string">'restart'</span>)</span><br><span class="line">    <span class="comment"># Stop the service and regardless of whether it was</span></span><br><span class="line">    <span class="comment"># running or not, start it again.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">$0</span> stop  <span class="variable">$other_args</span>; <span class="keyword">then</span></span><br><span class="line">      <span class="variable">$0</span> start <span class="variable">$other_args</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">log</span>_failure_msg <span class="string">"Failed to stop running server, so refusing to try to start."</span></span><br><span class="line">      <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line"> </span><br><span class="line">  <span class="string">'reload'</span>|<span class="string">'force-reload'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-s</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span> ; <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">read</span> mysqld_pid &lt;  <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line">      <span class="built_in">kill</span> -HUP <span class="variable">$mysqld_pid</span> &amp;&amp; <span class="built_in">log</span>_success_msg <span class="string">"Reloading service MySQL"</span></span><br><span class="line">      touch <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">log</span>_failure_msg <span class="string">"MySQL PID file could not be found!"</span></span><br><span class="line">      <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">  <span class="string">'status'</span>)</span><br><span class="line">    <span class="comment"># First, check to see if pid file exists</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-s</span> <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span> ; <span class="keyword">then</span> </span><br><span class="line">      <span class="built_in">read</span> mysqld_pid &lt; <span class="string">"<span class="variable">$mysqld_pid_file_path</span>"</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">kill</span> -<span class="number">0</span> <span class="variable">$mysqld_pid</span> <span class="number">2</span>&gt;/dev/null ; <span class="keyword">then</span> </span><br><span class="line">        <span class="built_in">log</span>_success_msg <span class="string">"MySQL running (<span class="variable">$mysqld_pid</span>)"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">0</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"MySQL is not running, but PID file exists"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="comment"># Try to find appropriate mysqld process</span></span><br><span class="line">      mysqld_pid=`pidof <span class="variable">$libexecdir</span>/mysqld`</span><br><span class="line"> </span><br><span class="line">      <span class="comment"># test if multiple pids exist</span></span><br><span class="line">      pid_count=`<span class="built_in">echo</span> <span class="variable">$mysqld_pid</span> | wc -w`</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$pid_count</span> <span class="operator">-gt</span> <span class="number">1</span> ; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"Multiple MySQL running but PID file could not be found (<span class="variable">$mysqld_pid</span>)"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">5</span></span><br><span class="line">      <span class="keyword">elif</span> <span class="built_in">test</span> -z <span class="variable">$mysqld_pid</span> ; <span class="keyword">then</span> </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> <span class="operator">-f</span> <span class="string">"<span class="variable">$lock_file_path</span>"</span> ; <span class="keyword">then</span> </span><br><span class="line">          <span class="built_in">log</span>_failure_msg <span class="string">"MySQL is not running, but lock file (<span class="variable">$lock_file_path</span>) exists"</span></span><br><span class="line">          <span class="built_in">exit</span> <span class="number">2</span></span><br><span class="line">        <span class="keyword">fi</span> </span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"MySQL is not running"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">3</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">log</span>_failure_msg <span class="string">"MySQL is running but PID file could not be found"</span></span><br><span class="line">        <span class="built_in">exit</span> <span class="number">4</span></span><br><span class="line">      <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">    *)</span><br><span class="line">      <span class="comment"># usage</span></span><br><span class="line">      basename=`basename <span class="string">"<span class="variable">$0</span>"</span>`</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$basename</span>  &#123;start|stop|restart|reload|force-reload|status&#125;  [ MySQL server options ]"</span></span><br><span class="line">      <span class="built_in">exit</span> <span class="number">1</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">exit</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改权限</span></span><br><span class="line">chmod +x /etc/init.d/mysqld</span><br><span class="line">service mysqld start</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加MySQL系统环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/app/local/mysql/bin'</span>&gt;&gt;/etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看错误日志</span></span><br><span class="line">tail <span class="operator">-f</span> /var/<span class="built_in">log</span>/mysqld.log </span><br><span class="line"></span><br><span class="line"><span class="comment">#用root账户登录并作简单的安全设置</span></span><br><span class="line">/app/<span class="built_in">local</span>/mysql/bin/mysql -uroot -p</span><br><span class="line">直接回车空密码</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#进入数据库</span><br><span class="line"><span class="operator"><span class="keyword">use</span> mysql;</span></span><br><span class="line">#设置root密码</span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> mysql.<span class="keyword">user</span> <span class="keyword">SET</span> <span class="keyword">Password</span>=<span class="keyword">password</span>(<span class="string">'root'</span>) <span class="keyword">WHERE</span> <span class="keyword">User</span>=<span class="string">'root'</span>;</span></span><br><span class="line">#清除root密码</span><br><span class="line"><span class="operator"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">password</span>=<span class="string">''</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span>;</span></span><br><span class="line">#删除无名用户</span><br><span class="line"><span class="operator"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span> <span class="keyword">WHERE</span> <span class="keyword">User</span>=<span class="string">''</span>;</span></span><br><span class="line">#删除root远程访问（可选）</span><br><span class="line">#<span class="operator"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span> <span class="keyword">WHERE</span> <span class="keyword">User</span>=<span class="string">'root'</span> <span class="keyword">AND</span> Host <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>, <span class="string">'::1'</span>);</span></span><br><span class="line">#删除“test”数据库</span><br><span class="line"><span class="operator"><span class="keyword">DROP</span> <span class="keyword">database</span> test;</span></span><br><span class="line">#允许远程访问</span><br><span class="line"><span class="operator"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host=<span class="string">'%'</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">'root'</span> <span class="keyword">AND</span> host=<span class="string">'localhost'</span>;</span></span><br><span class="line">#查看所有用户权限</span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">CONCAT</span>(<span class="string">'User: '''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>) <span class="keyword">AS</span> <span class="keyword">query</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span>;</span></span><br><span class="line">#立即生效并退出MYSQL命令窗体</span><br><span class="line"><span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span>QUIT;</span><br><span class="line"></span><br><span class="line">#创建数据库</span><br><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> ooxx;</span></span><br><span class="line">#创建用户</span><br><span class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">user</span> ooxx@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'ooxx'</span>;</span></span><br><span class="line">#对用户授权</span><br><span class="line"><span class="operator"><span class="keyword">grant</span> <span class="keyword">all</span> <span class="keyword">privileges</span> <span class="keyword">on</span> ooxx.* <span class="keyword">to</span> ooxx;</span></span><br><span class="line">#刷新MySQL的系统权限相关表</span><br><span class="line"><span class="operator"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span></span><br><span class="line">#查看所有用户权限</span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">CONCAT</span>(<span class="string">'User: '''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>) <span class="keyword">AS</span> <span class="keyword">query</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span>;</span></span><br></pre></td></tr></table></figure>
<h2 id="安装Apache">安装Apache</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">tar zxvf httpd-<span class="number">2.2</span>.<span class="number">29</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> httpd-<span class="number">2.2</span>.<span class="number">29</span></span><br><span class="line"></span><br><span class="line">./configure --prefix=/app/<span class="built_in">local</span>/apache \</span><br><span class="line">--enable-so \</span><br><span class="line">--enable-rewrite \</span><br><span class="line">--enable-modes-shared=most</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install </span><br><span class="line"></span><br><span class="line">vi /app/<span class="built_in">local</span>/apache/conf/httpd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改主机名</span></span><br><span class="line">ServerName localhost:<span class="number">80</span></span><br><span class="line"><span class="comment">#查找AddType application/x-gzip .gz .tgz,在该行下面添加</span></span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line"><span class="comment">#查找DirectoryIndex index.html 把该行修改成</span></span><br><span class="line">DirectoryIndex index.html index.htm index.php</span><br><span class="line"></span><br><span class="line">/app/<span class="built_in">local</span>/apache/bin/apachectl -t</span><br><span class="line">cp /app/<span class="built_in">local</span>/apache/bin/apachectl /etc/init.d/httpd</span><br></pre></td></tr></table></figure>
<h2 id="安装PHP">安装PHP</h2><h3 id="PHP基础环境">PHP基础环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum安装或者使用下面源包编译安装</span></span><br><span class="line">yum install libmcrypt libmcrypt-devel mcrypt mhash</span><br><span class="line"></span><br><span class="line"><span class="comment">#下载地址</span></span><br><span class="line">http://sourceforge.net/projects/mcrypt/files/Libmcrypt/</span><br><span class="line">http://sourceforge.net/projects/mcrypt/files/MCrypt/</span><br><span class="line">http://sourceforge.net/projects/mhash/files/mhash/</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装Libmcrypt</span></span><br><span class="line">tar -zxvf libmcrypt-<span class="number">2.5</span>.<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libmcrypt-<span class="number">2.5</span>.<span class="number">8</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.安装mhash</span><br><span class="line"></span><br><span class="line">tar -zxvf mhash-<span class="number">0.9</span>.<span class="number">9.9</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mhash-<span class="number">0.9</span>.<span class="number">9.9</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>.安装mcrypt</span><br><span class="line"></span><br><span class="line">tar -zxvf mcrypt-<span class="number">2.6</span>.<span class="number">8</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> mcrypt-<span class="number">2.6</span>.<span class="number">8</span></span><br><span class="line">LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/lib ./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"></span><br><span class="line"><span class="comment">### 安装PHP</span></span><br><span class="line"></span><br><span class="line">&gt;extension按需定制，支持phpize动态增加，新增的OPcache建议酌情开启</span><br><span class="line"></span><br><span class="line">``` bash</span><br><span class="line">tar zxvf php-<span class="number">5.5</span>.<span class="number">27</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> php-<span class="number">5.5</span>.<span class="number">27</span></span><br><span class="line"></span><br><span class="line">./configure --prefix=/app/<span class="built_in">local</span>/php \</span><br><span class="line">--with-config-file-path=/app/<span class="built_in">local</span>/php/etc \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mysql=mysqlnd \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd \</span><br><span class="line">--with-apxs2=/app/<span class="built_in">local</span>/apache/bin/apxs </span><br><span class="line"><span class="comment">#--enable-opcache</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置php.ini</span></span><br><span class="line">cp php.ini-development /app/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置时区</span></span><br><span class="line">sed -i <span class="string">"s#;date.timezone =#date.timezone = Asia/Shanghai#g"</span> /app/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line"><span class="comment">#防止nginx文件类型错误解析漏洞</span></span><br><span class="line">sed -i <span class="string">"s#;cgi.fix_pathinfo=1#cgi.fix_pathinfo=0#g"</span> /app/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line"><span class="comment">#禁止显示php版本的信息</span></span><br><span class="line">sed -i <span class="string">"s#expose_php = On#expose_php = Off#g"</span> /app/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line"><span class="comment">#禁用危险函数（可选）</span></span><br><span class="line"><span class="comment">#sed -i "s#disable_functions =#disable_functions = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source#g" /app/local/php/etc/php.ini</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#enable-opcache后设置（可选）</span></span><br><span class="line">[OPcache]</span><br><span class="line">zend_extension = opcache.so</span><br><span class="line">opcache.enable=<span class="number">1</span></span><br><span class="line">opcache.memory_consumption=<span class="number">128</span></span><br><span class="line">opcache.interned_strings_buffer=<span class="number">8</span></span><br><span class="line">opcache.max_accelerated_files=<span class="number">4000</span></span><br><span class="line">opcache.revalidate_freq=<span class="number">1</span></span><br><span class="line">opcache.fast_shutdown=<span class="number">1</span></span><br><span class="line">opcache.enable_cli=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="配置php-fpm">配置php-fpm</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑php-fpm</span></span><br><span class="line">cp /app/<span class="built_in">local</span>/php/etc/php-fpm.conf.default /app/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line">vi /app/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">;错误日志</span><br><span class="line">error_<span class="built_in">log</span> = <span class="built_in">log</span>/php-fpm.log</span><br><span class="line">;错误日志级别</span><br><span class="line"><span class="built_in">log</span>_level = notice</span><br><span class="line">[www]</span><br><span class="line">;php-fpm监听端口</span><br><span class="line">listen = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span></span><br><span class="line">;启动进程的帐户和组</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line">;如果选择static，则由pm.max_children指定固定的子进程数。如果选择dynamic，则由后面<span class="number">3</span>个参数动态决定</span><br><span class="line">pm = dynamic</span><br><span class="line">;子进程最大数</span><br><span class="line">pm.max_children = <span class="number">384</span></span><br><span class="line">;启动时的进程数</span><br><span class="line">pm.start_servers = <span class="number">20</span></span><br><span class="line">;保证空闲进程数最小值，如果空闲进程小于此值，则创建新的子进程</span><br><span class="line">pm.min_spare_servers = <span class="number">5</span></span><br><span class="line">;保证空闲进程数最大值，如果空闲进程大于此值，此进行清理</span><br><span class="line">pm.max_spare_servers = <span class="number">35</span></span><br><span class="line"></span><br><span class="line">;设置每个子进程重生之前服务的请求数。对于可能存在内存泄漏的第三方模块来说是非常有用的。如果设置为 <span class="string">'0'</span> 则一直接受请求。等同于 PHP_FCGI_MAX_REQUESTS 环境变量。默认值: <span class="number">0</span>。</span><br><span class="line">pm.max_requests = <span class="number">1000</span></span><br><span class="line">;每个子进程闲置多长时间就自杀</span><br><span class="line">pm.process_idle_timeout = <span class="number">10</span>s</span><br><span class="line">;设置单个请求的超时中止时间。该选项可能会对php.ini设置中的<span class="string">'max_execution_time'</span>因为某些特殊原因没有中止运行的脚本有用。设置为 <span class="string">'0'</span> 表示 <span class="string">'Off'</span>.当经常出现<span class="number">502</span>错误时可以尝试更改此选项。</span><br><span class="line">request_terminate_timeout = <span class="number">120</span></span><br><span class="line">;当一个请求该设置的超时时间后，就会将对应的PHP调用堆栈信息完整写入到慢日志中。设置为 <span class="string">'0'</span> 表示 <span class="string">'Off'</span></span><br><span class="line">request_slowlog_timeout = <span class="number">3</span>s</span><br><span class="line">;慢请求的记录日志,配合request_slowlog_timeout使用</span><br><span class="line">slowlog = /app/<span class="built_in">local</span>/php/var/<span class="built_in">log</span>/php-fpm.slow.log</span><br><span class="line">;设置文件打开描述符的rlimit限制。默认值: 系统定义值默认可打开句柄是<span class="number">1024</span>，可使用 <span class="built_in">ulimit</span> -n查看，<span class="built_in">ulimit</span> -n <span class="number">2048</span>修改。</span><br><span class="line">rlimit_files = <span class="number">65535</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#设置php环境变量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/app/local/php/bin'</span>&gt;&gt;/etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line">touch /app/<span class="built_in">local</span>/php/var/<span class="built_in">log</span>/php-fpm.slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加php-fpm服务</span></span><br><span class="line">cp /app/<span class="built_in">local</span>/php-<span class="number">5.5</span>.<span class="number">27</span>/sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm</span><br><span class="line">chmod +x /etc/rc.d/init.d/php-fpm</span><br><span class="line">service php-fpm start</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置开机自动启动服务</span></span><br><span class="line">vi /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="built_in">ulimit</span> -SHn <span class="number">65535</span></span><br><span class="line">service php-fpm start</span><br><span class="line">service nginx start</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<h3 id="配置memcache/mongo/redis">配置memcache/mongo/redis</h3><blockquote>
<p>其它extension扩展都可以动态添加，没事的</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#memcache</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">tar zxvf memcache-<span class="number">3.0</span>.<span class="number">8</span>.tgz</span><br><span class="line"><span class="built_in">cd</span> memcache-<span class="number">3.0</span>.<span class="number">8</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --enable-memcache \</span><br><span class="line">--with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config \</span><br><span class="line">--with-zlib-dir</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#mongo</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">tar zxvf mongo-<span class="number">1.6</span>.<span class="number">10</span>.tgz</span><br><span class="line"><span class="built_in">cd</span> mongo-<span class="number">1.6</span>.<span class="number">10</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">tar zxvf redis-<span class="number">2.2</span>.<span class="number">7</span>.tgz</span><br><span class="line"><span class="built_in">cd</span> redis-<span class="number">2.2</span>.<span class="number">7</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#php.ini</span></span><br><span class="line">vi /app/<span class="built_in">local</span>/php/etc/php.ini  </span><br><span class="line"></span><br><span class="line">[memcached]  </span><br><span class="line">extension=memcached.so</span><br><span class="line">[mongodb]  </span><br><span class="line">extension=mongo.so </span><br><span class="line">[redis]  </span><br><span class="line">extension=redis.so </span><br><span class="line"></span><br><span class="line"><span class="comment">#重启生效</span></span><br><span class="line">service php-fpm restart</span><br><span class="line">php -i | grep php.ini</span><br><span class="line">php -m</span><br></pre></td></tr></table></figure>
<h2 id="自动化部署">自动化部署</h2><blockquote>
<p>服务器的上传目录可以自定义，安装目录默认统一修改为/app/{local,data}，执行脚本为web.sh</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#web.sh</span></span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span><br><span class="line"></span></span><br><span class="line"><span class="comment">## alias</span></span><br><span class="line">ltmp_<span class="built_in">local</span>=$(<span class="built_in">cd</span> <span class="string">"<span class="variable">$(dirname "$0")</span>"</span>; <span class="built_in">pwd</span>)</span><br><span class="line">mkdir -p /app/&#123;<span class="built_in">local</span>,data&#125;</span><br><span class="line"><span class="built_in">unalias</span> cp</span><br><span class="line">ltmp_init=<span class="variable">$ltmp_local</span>/init/</span><br><span class="line">ltmp_src=<span class="variable">$ltmp_local</span>/src/</span><br><span class="line"></span><br><span class="line"><span class="comment">## system</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#history</span></span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>bashrc /etc/</span><br><span class="line"><span class="comment">#time</span></span><br><span class="line">rm -rf /etc/localtime</span><br><span class="line">ln <span class="operator">-s</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br><span class="line"><span class="comment">#maildrop</span></span><br><span class="line">sed <span class="string">'s/MAILTO=root/MAILTO=""/g'</span> /etc/crontab</span><br><span class="line">service crond restart</span><br><span class="line"><span class="comment">#selinux</span></span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config</span><br><span class="line"><span class="comment">#limits</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">ulimit</span> -SHn <span class="number">65535</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>limits.conf /etc/security/</span><br><span class="line"><span class="comment">#tcp</span></span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>sysctl.conf  /etc/</span><br><span class="line"><span class="comment">#yum</span></span><br><span class="line">yum -y install yum-fastestmirror</span><br><span class="line">yum remove httpd mysql mysql-server php php-cli php-common php-devel php-gd  -y</span><br><span class="line">yum install -y wget gcc gcc-c++ openssl* curl curl-devel libxml2 libxml2-devel glibc glibc-devel glib2 glib2-devel gd gd2 gd-devel gd2-devel libaio autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel</span><br><span class="line"><span class="comment">#download</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line"><span class="comment">##PCRE - Perl Compatible Regular Expressions</span></span><br><span class="line"><span class="comment">#wget "ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz"</span></span><br><span class="line"><span class="comment">##Tengine</span></span><br><span class="line"><span class="comment">#wget "http://tengine.taobao.org/download/tengine-2.1.0.tar.gz"</span></span><br><span class="line"><span class="comment">##MySQL</span></span><br><span class="line"><span class="comment">#wget "https://downloads.mariadb.com/archives/mysql-5.6/mysql-5.6.25-linux-glibc2.5-x86_64.tar.gz"</span></span><br><span class="line"><span class="comment">##PHP</span></span><br><span class="line"><span class="comment">#wget "http://cn2.php.net/distributions/php-5.6.11.tar.gz"</span></span><br><span class="line"><span class="comment">##Mhash</span></span><br><span class="line"><span class="comment">#wget "http://downloads.sourceforge.net/mhash/mhash-0.9.9.9.tar.gz"</span></span><br><span class="line"><span class="comment">##libmcrypt</span></span><br><span class="line"><span class="comment">#wget "http://downloads.sourceforge.net/mcrypt/libmcrypt-2.5.8.tar.gz"</span></span><br><span class="line"><span class="comment">##Mcrypt</span></span><br><span class="line"><span class="comment">#wget "http://downloads.sourceforge.net/mcrypt/mcrypt-2.6.8.tar.gz"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## soft</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_local</span></span><br><span class="line"><span class="comment">#pcre</span></span><br><span class="line">tar zxvf pcre-<span class="number">8.37</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> pcre-<span class="number">8.37</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"><span class="comment">#tengine</span></span><br><span class="line">groupadd www</span><br><span class="line">useradd -g www www</span><br><span class="line"><span class="comment">#安装Tengine</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_local</span></span><br><span class="line">tar zxvf tengine-<span class="number">2.1</span>.<span class="number">0</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> tengine-<span class="number">2.1</span>.<span class="number">0</span></span><br><span class="line">./configure --user=www --group=www \</span><br><span class="line">--prefix=/app/<span class="built_in">local</span>/nginx \</span><br><span class="line">--with-http_stub_status_module \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-pcre=<span class="variable">$&#123;ltmp_local&#125;</span>/pcre-<span class="number">8.37</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"><span class="comment">#nginx config</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_local</span></span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>nginx.conf /app/<span class="built_in">local</span>/nginx/conf/</span><br><span class="line">cp -r <span class="variable">$&#123;ltmp_init&#125;</span>vhosts /app/<span class="built_in">local</span>/nginx/conf/</span><br><span class="line">mkdir -p /app/data/localhost</span><br><span class="line">chmod +w /app/data/localhost</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"&lt;?php phpinfo();?&gt;"</span> &gt; /app/data/localhost/phpinfo.php</span><br><span class="line">chown -R www:www /app/data/localhost</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/app/local/nginx/sbin'</span>&gt;&gt;/etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>nginx /etc/rc.d/init.d/</span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line"><span class="built_in">ulimit</span> -SHn <span class="number">65535</span></span><br><span class="line">service nginx start</span><br><span class="line"><span class="comment">#libmcrypt</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line">tar -zxvf libmcrypt-<span class="number">2.5</span>.<span class="number">8</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> libmcrypt-<span class="number">2.5</span>.<span class="number">8</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"><span class="comment">#mhash</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line">tar -zxvf mhash-<span class="number">0.9</span>.<span class="number">9.9</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> mhash-<span class="number">0.9</span>.<span class="number">9.9</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"><span class="comment">#mcrypt</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line">tar -zxvf mcrypt-<span class="number">2.6</span>.<span class="number">8</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> mcrypt-<span class="number">2.6</span>.<span class="number">8</span></span><br><span class="line">LD_LIBRARY_PATH=/usr/<span class="built_in">local</span>/lib ./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="built_in">cd</span> ../</span><br><span class="line"><span class="comment">#php</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_local</span></span><br><span class="line">tar zxvf php-<span class="number">5.5</span>.<span class="number">27</span>.tar.gz <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> php-<span class="number">5.5</span>.<span class="number">27</span></span><br><span class="line">./configure --prefix=/app/<span class="built_in">local</span>/php \</span><br><span class="line">--with-config-file-path=/app/<span class="built_in">local</span>/php/etc \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mysql=mysqlnd \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment">#memcache</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line">tar zxvf memcache-<span class="number">3.0</span>.<span class="number">8</span>.tgz  <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> memcache-<span class="number">3.0</span>.<span class="number">8</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --enable-memcache \</span><br><span class="line">--with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config \</span><br><span class="line">--with-zlib-dir</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment">#mongo</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line">tar zxvf mongo-<span class="number">1.6</span>.<span class="number">10</span>.tgz  <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> mongo-<span class="number">1.6</span>.<span class="number">10</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$ltmp_src</span></span><br><span class="line"><span class="comment">#redis</span></span><br><span class="line">tar zxvf redis-<span class="number">2.2</span>.<span class="number">7</span>.tgz  <span class="number">1</span>&gt; /dev/null</span><br><span class="line"><span class="built_in">cd</span> redis-<span class="number">2.2</span>.<span class="number">7</span></span><br><span class="line">/app/<span class="built_in">local</span>/php/bin/phpize</span><br><span class="line">./configure --with-php-config=/app/<span class="built_in">local</span>/php/bin/php-config</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"><span class="comment">#php-fpm</span></span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>php.ini /app/<span class="built_in">local</span>/php/etc/</span><br><span class="line">cp <span class="variable">$&#123;ltmp_init&#125;</span>php-fpm.conf /app/<span class="built_in">local</span>/php/etc/</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=$PATH:/app/local/php/bin'</span>&gt;&gt;/etc/profile &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line">touch /app/<span class="built_in">local</span>/php/var/<span class="built_in">log</span>/php-fpm.slow.log</span><br><span class="line">cp <span class="variable">$&#123;ltmp_local&#125;</span>/php-<span class="number">5.5</span>.<span class="number">27</span>/sapi/fpm/init.d.php-fpm /etc/rc.d/init.d/php-fpm</span><br><span class="line">chmod +x /etc/rc.d/init.d/php-fpm</span><br><span class="line">service php-fpm start</span><br></pre></td></tr></table></figure>
<h2 id="GitHub源码仓库">GitHub源码仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">file://E:\QQDownload\LTMP     (<span class="number">2</span> folders, <span class="number">5</span> files, <span class="number">27.66</span> MB, <span class="number">30.76</span> MB <span class="keyword">in</span> total.)</span><br><span class="line">│  httpd-<span class="number">2.2</span>.<span class="number">29</span>.tar.gz     <span class="number">7.19</span> MB</span><br><span class="line">│  pcre-<span class="number">8.37</span>.tar.gz     <span class="number">1.95</span> MB</span><br><span class="line">│  php-<span class="number">5.5</span>.<span class="number">27</span>.tar.gz     <span class="number">16.95</span> MB</span><br><span class="line">│  tengine-<span class="number">2.1</span>.<span class="number">0</span>.tar.gz     <span class="number">1.58</span> MB</span><br><span class="line">│  web.sh     <span class="number">4.10</span> KB</span><br><span class="line">├─init     (<span class="number">1</span> folders, <span class="number">12</span> files, <span class="number">91.42</span> KB, <span class="number">92.23</span> KB <span class="keyword">in</span> total.)</span><br><span class="line">│  │  allow.conf     <span class="number">35</span> bytes</span><br><span class="line">│  │  bashrc     <span class="number">2.99</span> KB</span><br><span class="line">│  │  deny.conf     <span class="number">35</span> bytes</span><br><span class="line">│  │  limits.conf     <span class="number">1.86</span> KB</span><br><span class="line">│  │  my.cnf     <span class="number">1.99</span> KB</span><br><span class="line">│  │  mysqld     <span class="number">8.39</span> KB</span><br><span class="line">│  │  nginx     <span class="number">2.22</span> KB</span><br><span class="line">│  │  nginx.conf     <span class="number">1.34</span> KB</span><br><span class="line">│  │  php-fpm     <span class="number">2.30</span> KB</span><br><span class="line">│  │  php-fpm.conf     <span class="number">416</span> bytes</span><br><span class="line">│  │  php.ini     <span class="number">67.83</span> KB</span><br><span class="line">│  │  sysctl.conf     <span class="number">2.03</span> KB</span><br><span class="line">│  └─vhosts     (<span class="number">0</span> folders, <span class="number">1</span> files, <span class="number">826</span> bytes, <span class="number">826</span> bytes <span class="keyword">in</span> total.)</span><br><span class="line">│          localhost.conf     <span class="number">826</span> bytes</span><br><span class="line">└─src     (<span class="number">0</span> folders, <span class="number">6</span> files, <span class="number">3.01</span> MB, <span class="number">3.01</span> MB <span class="keyword">in</span> total.)</span><br><span class="line">        libmcrypt-<span class="number">2.5</span>.<span class="number">8</span>.tar.gz     <span class="number">1.27</span> MB</span><br><span class="line">        mcrypt-<span class="number">2.6</span>.<span class="number">8</span>.tar.gz     <span class="number">460.85</span> KB</span><br><span class="line">        memcache-<span class="number">3.0</span>.<span class="number">8</span>.tgz     <span class="number">68.87</span> KB</span><br><span class="line">        mhash-<span class="number">0.9</span>.<span class="number">9.9</span>.tar.gz     <span class="number">909.61</span> KB</span><br><span class="line">        mongo-<span class="number">1.6</span>.<span class="number">10</span>.tgz     <span class="number">204.19</span> KB</span><br><span class="line">        redis-<span class="number">2.2</span>.<span class="number">7</span>.tgz     <span class="number">131.19</span> KB</span><br></pre></td></tr></table></figure>
<p>LTMP - <a href="https://github.com/wsgzao/LTMP" target="_blank" rel="external">https://github.com/wsgzao/LTMP</a></p>
]]></content>
    <summary type="html">
    <![CDATA[LTMP(CentOS/Tengine/MySQL/PHP)]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sersync基于rsync+inotify实现数据实时同步]]></title>
    <link href="http://wsgzao.github.io/post/sersync/"/>
    <id>http://wsgzao.github.io/post/sersync/</id>
    <published>2015-08-14T05:18:44.000Z</published>
    <updated>2015-08-14T09:58:15.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/27qp456L.png" alt=""></p>
<h2 id="前言">前言</h2><p>提到数据同步就必然会谈到<code>rsync</code>，一般简单的服务器数据传输会使用<code>ftp/sftp</code>等方式，但是这样的方式效率不高，不支持差异化增量同步也不支持实时传输。针对数据实时同步需求大多数人会选择<code>rsync+inotify-tools</code>的解决方案，但是这样的方案也存在一些缺陷（文章中会具体指出），<code>sersync</code>是国人基于前两者开发的工具，不仅保留了优点同时还强化了实时监控，文件过滤，简化配置等功能，帮助用户提高运行效率，节省时间和网络资源。</p>
<blockquote>
<p>可靠高效的数据实时同步方式</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月14日 - 更新GitHub源码安装包<br>2015年08月13日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/sersync/" target="_blank" rel="external">http://wsgzao.github.io/post/sersync/</a></p>
<p>扩展阅读</p>
<p>基于rsync+sersync的服务器文件同步实战 - <a href="http://www.markdream.com/technologies/server/syncfile-by-rsync.shtml" target="_blank" rel="external">http://www.markdream.com/technologies/server/syncfile-by-rsync.shtml</a><br>通过 rsync sersync 实现高效的数据实时同步架构 - <a href="https://www.cnhzz.com/rsync_sersync/" target="_blank" rel="external">https://www.cnhzz.com/rsync_sersync/</a><br>Rsync+sersync实现数据实时同步 - <a href="http://www.cnblogs.com/wjoyxt/p/4581410.html" target="_blank" rel="external">http://www.cnblogs.com/wjoyxt/p/4581410.html</a><br>rsync - <a href="https://rsync.samba.org/" target="_blank" rel="external">https://rsync.samba.org/</a><br>inotify-tools - <a href="https://github.com/rvoicilas/inotify-tools" target="_blank" rel="external">https://github.com/rvoicilas/inotify-tools</a><br>sersync - <a href="http://code.google.com/p/sersync/" target="_blank" rel="external">http://code.google.com/p/sersync/</a></p>
<hr>
<h2 id="原理">原理</h2><blockquote>
<p>Synchronize files and folders between servers -using inotiy and rsync with c++ 服务器实时同步文件，服务器镜像解决方案</p>
</blockquote>
<p><code>sersync</code>主要用于服务器同步，web镜像等功能。基于boost1.43.0,inotify api,rsync command.开发。目前使用的比较多的同步解决方案是<code>inotify-tools+rsync</code> ，另外一个是google开源项目<code>Openduckbill</code>（依赖于inotify- tools），这两个都是基于脚本语言编写的。相比较上面两个项目，本项目优点是：</p>
<ol>
<li>sersync是使用c++编写，而且对linux系统文件系统产生的临时文件和重复的文件操作进行过滤（详细见附录，这个过滤脚本程序没有实现），所以在结合rsync同步的时候，节省了运行时耗和网络资源。因此更快。</li>
<li>相比较上面两个项目，sersync配置起来很简单，其中bin目录下已经有基本上静态编译的2进制文件，配合bin目录下的xml配置文件直接使用即可。</li>
<li>另外本项目相比较其他脚本开源项目，使用多线程进行同步，尤其在同步较大文件时，能够保证多个服务器实时保持同步状态。</li>
<li>本项目有出错处理机制，通过失败队列对出错的文件重新同步，如果仍旧失败，则按设定时长对同步失败的文件重新同步。</li>
<li>本项目自带crontab功能，只需在xml配置文件中开启，即可按您的要求，隔一段时间整体同步一次。无需再额外配置crontab功能。</li>
<li>本项目socket与http插件扩展，满足您二次开发的需要。</li>
</ol>
<blockquote>
<p>针对上图的设计架构，这里做几点说明，来帮助大家阅读和理解该图</p>
</blockquote>
<p>1 ) <code>线程组线程</code>是等待线程队列的守护线程，当事件队列中有事件产生的时候，线程组守护线程就会逐个唤醒同步线程。当队列中 Inotify 事件较多的时候，同步线程就会被全部唤醒一起工作。这样设计的目的是为了能够同时处理多个 Inotify 事件，从而提升服务器的并发同步能力。同步线程的最佳数量=核数 x 2 + 2。<br>2 ) 那么之所以称之为<code>线程组线程</code>，是因为每个线程在工作的时候，会根据服务器上新写入文件的数量去建立子线程，子线程可以保证所有的文件与各个服务器同时同步。当要同步的文件较大的时候，这样的设计可以保证每个远程服务器都可以同时获得需要同步的文件。<br>3 ) 服务线程的作用有三个：</p>
<ul>
<li>处理同步失败的文件，将这些文件再次同步，对于再次同步失败的文件会生成 rsync_fail_log.sh 脚本，记录失败的事件。</li>
<li>每隔10个小时执行 rsync_fail_log.sh 脚本一次，同时清空脚本。</li>
<li>crontab功能，可以每隔一定时间，将所有路径整体同步一次。</li>
</ul>
<p>4 ) <code>过滤队列</code>的建立是为了过滤短时间内产生的重复的inotify信息，例如在删除文件夹的时候，inotify就会同时产生删除文件夹里的文件与删除文件夹的事件，通过过滤队列，当删除文件夹事件产生的时候，会将之前加入队列的删除文件的事件全部过滤掉，这样只产生一条删除文件夹的事件，从而减轻了同步的负担。同时对于修改文件的操作的时候，会产生临时文件的重复操作。</p>
<h2 id="角色">角色</h2><blockquote>
<p>注意主从配置的区别，记得调整SELinux和防火墙</p>
</blockquote>
<p>iptables配置实践 - <a href="http://wsgzao.github.io/post/iptables/" target="_blank" rel="external">http://wsgzao.github.io/post/iptables/</a><br>LTMP手动编译安装以及全自动化部署实践 - <a href="http://wsgzao.github.io/post/ltmp/" target="_blank" rel="external">http://wsgzao.github.io/post/ltmp/</a></p>
<ol>
<li>服务器A（主服务器）</li>
<li>服务器B（从服务器/备份服务器）</li>
<li>rsync默认TCP端口为873</li>
</ol>
<h3 id="服务器B">服务器B</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在服务器B上安装rsync</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">wget  http://rsync.samba.org/ftp/rsync/src/rsync-<span class="number">3.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar zxf rsync-<span class="number">3.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> rsync-<span class="number">3.1</span>.<span class="number">1</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置rsync的配置文件</span></span><br><span class="line">vi /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务器B上的rsyncd.conf文件内容</span></span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br><span class="line"><span class="comment">#最大连接数</span></span><br><span class="line">max connections=<span class="number">36000</span></span><br><span class="line"><span class="comment">#默认为true，修改为no，增加对目录文件软连接的备份 </span></span><br><span class="line">use chroot=no</span><br><span class="line"><span class="comment">#定义日志存放位置</span></span><br><span class="line"><span class="built_in">log</span> file=/var/<span class="built_in">log</span>/rsyncd.log</span><br><span class="line"><span class="comment">#忽略无关错误</span></span><br><span class="line">ignore errors = yes</span><br><span class="line"><span class="comment">#设置rsync服务端文件为读写权限</span></span><br><span class="line"><span class="built_in">read</span> only = no </span><br><span class="line"><span class="comment">#认证的用户名与系统帐户无关在认证文件做配置，如果没有这行则表明是匿名</span></span><br><span class="line">auth users = rsync</span><br><span class="line"><span class="comment">#密码认证文件，格式(虚拟用户名:密码）</span></span><br><span class="line">secrets file = /etc/rsync.pass</span><br><span class="line"><span class="comment">#这里是认证的模块名，在client端需要指定，可以设置多个模块和路径</span></span><br><span class="line">[rsync]</span><br><span class="line"><span class="comment">#自定义注释</span></span><br><span class="line">comment  = rsync</span><br><span class="line"><span class="comment">#同步到B服务器的文件存放的路径</span></span><br><span class="line">path=/app/data/site/</span><br><span class="line">[img]</span><br><span class="line">comment  = img</span><br><span class="line">path=/app/data/site/img</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建rsync认证文件  可以设置多个，每行一个用户名:密码，注意中间以“:”分割</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"rsync:rsync"</span> &gt; /etc/rsync.pass</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置文件所有者读取、写入权限</span></span><br><span class="line">chmod <span class="number">600</span> /etc/rsyncd.conf  </span><br><span class="line">chmod <span class="number">600</span> /etc/rsync.pass  </span><br><span class="line"></span><br><span class="line"><span class="comment">#启动服务器B上的rsync服务</span></span><br><span class="line"><span class="comment">#rsync --daemon -v</span></span><br><span class="line">rsync --daemon</span><br><span class="line"></span><br><span class="line"><span class="comment">#监听端口873</span></span><br><span class="line">netstat -an | grep <span class="number">873</span></span><br><span class="line">lsof -i tcp:<span class="number">873</span></span><br><span class="line"></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">rsync   <span class="number">31445</span> root    <span class="number">4</span>u  IPv4 <span class="number">443872</span>      <span class="number">0</span>t0  TCP *:rsync (LISTEN)</span><br><span class="line">rsync   <span class="number">31445</span> root    <span class="number">5</span>u  IPv6 <span class="number">443873</span>      <span class="number">0</span>t0  TCP *:rsync (LISTEN)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置rsync为服务启动项（可选）</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"/usr/local/bin/rsync --daemon"</span> &gt;&gt; /etc/rc.local</span><br><span class="line"></span><br><span class="line"><span class="comment">#要 Kill rsync 进程，不要用 kill -HUP &#123;PID&#125; 的方式重启进程，以下3种方式任选</span></span><br><span class="line"><span class="comment">#ps -ef|grep rsync|grep -v grep|awk '&#123;print $2&#125;'|xargs kill -9</span></span><br><span class="line"><span class="comment">#cat /var/run/rsyncd.pid | xargs kill -9</span></span><br><span class="line">pkill rsync</span><br><span class="line"><span class="comment">#再次启动</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/rsync --daemon</span><br></pre></td></tr></table></figure>
<h3 id="服务器A">服务器A</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装rsync</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">wget  http://rsync.samba.org/ftp/rsync/src/rsync-<span class="number">3.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar zxf rsync-<span class="number">3.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> rsync-<span class="number">3.1</span>.<span class="number">1</span></span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装inotify-tools</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">wget http://github.com/downloads/rvoicilas/inotify-tools/inotify-tools-<span class="number">3.14</span>.tar.gz</span><br><span class="line">tar zxf inotify-tools-<span class="number">3.14</span>.tar.gz</span><br><span class="line"><span class="built_in">cd</span> inotify-tools-<span class="number">3.14</span></span><br><span class="line">./configure --prefix=/app/<span class="built_in">local</span>/inotify </span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装sersync</span></span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span></span><br><span class="line">wget https://sersync.googlecode.com/files/sersync2.<span class="number">5.4</span>_64bit_binary_stable_final.tar.gz</span><br><span class="line">tar zxf sersync2.<span class="number">5.4</span>_64bit_binary_stable_final.tar.gz</span><br><span class="line">mv /app/<span class="built_in">local</span>/GNU-Linux-x86/ /app/<span class="built_in">local</span>/sersync</span><br><span class="line"><span class="built_in">cd</span> /app/<span class="built_in">local</span>/sersync</span><br><span class="line"><span class="comment">#配置下密码文件，因为这个密码是要访问服务器B需要的密码和上面服务器B的密码必须一致</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"rsync"</span> &gt; /app/<span class="built_in">local</span>/sersync/user.pass</span><br><span class="line"><span class="comment">#修改权限</span></span><br><span class="line">chmod <span class="number">600</span> /app/<span class="built_in">local</span>/sersync/user.pass</span><br><span class="line"><span class="comment">#修改confxml.conf</span></span><br><span class="line">vi /app/<span class="built_in">local</span>/sersync/confxml.xml</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span> <span class="attribute">version</span>=<span class="value">"2.5"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">host</span> <span class="attribute">hostip</span>=<span class="value">"localhost"</span> <span class="attribute">port</span>=<span class="value">"8008"</span>&gt;</span><span class="tag">&lt;/<span class="title">host</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">debug</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">fileSystem</span> <span class="attribute">xfs</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">filter</span> <span class="attribute">start</span>=<span class="value">"false"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">exclude</span> <span class="attribute">expression</span>=<span class="value">"(.*)\.php"</span>&gt;</span><span class="tag">&lt;/<span class="title">exclude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">exclude</span> <span class="attribute">expression</span>=<span class="value">"^data/*"</span>&gt;</span><span class="tag">&lt;/<span class="title">exclude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">inotify</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">delete</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">createFolder</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">createFile</span> <span class="attribute">start</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">closeWrite</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">moveFrom</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">moveTo</span> <span class="attribute">start</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">attrib</span> <span class="attribute">start</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">modify</span> <span class="attribute">start</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">inotify</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="title">sersync</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">localpath</span> <span class="attribute">watch</span>=<span class="value">"/home/"</span>&gt;</span> <span class="comment">&lt;!-- 这里填写服务器A要同步的文件夹路径--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">remote</span> <span class="attribute">ip</span>=<span class="value">"8.8.8.8"</span> <span class="attribute">name</span>=<span class="value">"rsync"</span>/&gt;</span> <span class="comment">&lt;!-- 这里填写服务器B的IP地址和模块名--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--&lt;remote ip="192.168.28.39" name="tongbu"/&gt;--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--&lt;remote ip="192.168.28.40" name="tongbu"/&gt;--&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">localpath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">rsync</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">commonParams</span> <span class="attribute">params</span>=<span class="value">"-artuz"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">auth</span> <span class="attribute">start</span>=<span class="value">"true"</span> <span class="attribute">users</span>=<span class="value">"rsync"</span> <span class="attribute">passwordfile</span>=<span class="value">"/app/local/sersync/user.pass"</span>/&gt;</span> <span class="comment">&lt;!-- rsync+密码文件 这里填写服务器B的认证信息--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">userDefinedPort</span> <span class="attribute">start</span>=<span class="value">"false"</span> <span class="attribute">port</span>=<span class="value">"874"</span>/&gt;</span><span class="comment">&lt;!-- port=874 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">timeout</span> <span class="attribute">start</span>=<span class="value">"false"</span> <span class="attribute">time</span>=<span class="value">"100"</span>/&gt;</span><span class="comment">&lt;!-- timeout=100 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">ssh</span> <span class="attribute">start</span>=<span class="value">"false"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">rsync</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">failLog</span> <span class="attribute">path</span>=<span class="value">"/tmp/rsync_fail_log.sh"</span> <span class="attribute">timeToExecute</span>=<span class="value">"60"</span>/&gt;</span><span class="comment">&lt;!--default every 60mins execute once--&gt;</span><span class="comment">&lt;!-- 修改失败日志记录（可选）--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">crontab</span> <span class="attribute">start</span>=<span class="value">"false"</span> <span class="attribute">schedule</span>=<span class="value">"600"</span>&gt;</span><span class="comment">&lt;!--600mins--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">crontabfilter</span> <span class="attribute">start</span>=<span class="value">"false"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">exclude</span> <span class="attribute">expression</span>=<span class="value">"*.php"</span>&gt;</span><span class="tag">&lt;/<span class="title">exclude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">exclude</span> <span class="attribute">expression</span>=<span class="value">"info/*"</span>&gt;</span><span class="tag">&lt;/<span class="title">exclude</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">crontabfilter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">crontab</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">plugin</span> <span class="attribute">start</span>=<span class="value">"false"</span> <span class="attribute">name</span>=<span class="value">"command"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">sersync</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">&lt;!-- 下面这些有关于插件你可以忽略了 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">plugin</span> <span class="attribute">name</span>=<span class="value">"command"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">param</span> <span class="attribute">prefix</span>=<span class="value">"/bin/sh"</span> <span class="attribute">suffix</span>=<span class="value">""</span> <span class="attribute">ignoreError</span>=<span class="value">"true"</span>/&gt;</span> <span class="comment">&lt;!--prefix /opt/tongbu/mmm.sh suffix--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">filter</span> <span class="attribute">start</span>=<span class="value">"false"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">include</span> <span class="attribute">expression</span>=<span class="value">"(.*)\.php"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">include</span> <span class="attribute">expression</span>=<span class="value">"(.*)\.sh"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="title">plugin</span> <span class="attribute">name</span>=<span class="value">"socket"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">localpath</span> <span class="attribute">watch</span>=<span class="value">"/home/demo"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">deshost</span> <span class="attribute">ip</span>=<span class="value">"210.36.158.xxx"</span> <span class="attribute">port</span>=<span class="value">"8009"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">localpath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">plugin</span> <span class="attribute">name</span>=<span class="value">"refreshCDN"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">localpath</span> <span class="attribute">watch</span>=<span class="value">"/data0/htdocs/cdn.markdream.com/site/"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">cdninfo</span> <span class="attribute">domainname</span>=<span class="value">"cdn.chinacache.com"</span> <span class="attribute">port</span>=<span class="value">"80"</span> <span class="attribute">username</span>=<span class="value">"xxxx"</span> <span class="attribute">passwd</span>=<span class="value">"xxxx"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">sendurl</span> <span class="attribute">base</span>=<span class="value">"http://cdn.markdream.com/cms"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">regexurl</span> <span class="attribute">regex</span>=<span class="value">"false"</span> <span class="attribute">match</span>=<span class="value">"cdn.markdream.com/site([/a-zA-Z0-9]*).cdn.markdream.com/images"</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">localpath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行sersync</span></span><br><span class="line">nohup /app/<span class="built_in">local</span>/sersync/sersync2 -r <span class="operator">-d</span> -o /app/<span class="built_in">local</span>/sersync/confxml.xml &gt;/app/<span class="built_in">local</span>/sersync/rsync.log <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line">nohup /app/<span class="built_in">local</span>/sersync/sersync2 -r <span class="operator">-d</span> -o /app/<span class="built_in">local</span>/sersync/img.xml &gt;/app/<span class="built_in">local</span>/sersync/img.log <span class="number">2</span>&gt;&amp;<span class="number">1</span> &amp;</span><br><span class="line"></span><br><span class="line"><span class="operator">-d</span>:启用守护进程模式</span><br><span class="line">-r:在监控前，将监控目录与远程主机用rsync命令推送一遍</span><br><span class="line">-n: 指定开启守护线程的数量，默认为<span class="number">10</span>个</span><br><span class="line">-o:指定配置文件，默认使用confxml.xml文件</span><br></pre></td></tr></table></figure>
<h2 id="GitHub源码仓库">GitHub源码仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file://E:\sersync   (<span class="number">0</span> folders, <span class="number">3</span> files, <span class="number">1.88</span> MB, <span class="number">1.88</span> MB <span class="keyword">in</span> total.)</span><br><span class="line">    inotify-tools-<span class="number">3.14</span>.tar.gz <span class="number">350.36</span> KB</span><br><span class="line">    rsync-<span class="number">3.1</span>.<span class="number">1</span>.tar.gz    <span class="number">869.26</span> KB</span><br><span class="line">    sersync2.<span class="number">5.4</span>_64bit_binary_stable_final.tar.gz <span class="number">710.24</span> KB</span><br></pre></td></tr></table></figure>
<p>sersync - <a href="https://github.com/wsgzao/sersync" target="_blank" rel="external">https://github.com/wsgzao/sersync</a></p>
]]></content>
    <summary type="html">
    <![CDATA[可靠高效的数据实时同步方式]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SSH使用密钥登录并禁止口令登录实践]]></title>
    <link href="http://wsgzao.github.io/post/ssh/"/>
    <id>http://wsgzao.github.io/post/ssh/</id>
    <published>2015-08-13T04:18:44.000Z</published>
    <updated>2015-08-13T02:23:12.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/zv9SM4PO.png" alt=""></p>
<h2 id="前言">前言</h2><p>无论是个人的VPS还是企业允许公网访问的服务器，如果开放22端口的SSH密码登录验证方式，被众多黑客暴力猜解捅破菊花也可能是经常发生的惨剧。企业可以通过防火墙来做限制，普通用户也可能借助修改22端口和强化弱口令等方式防护，但目前相对安全和简单的方案则是让SSH使用密钥登录并禁止口令登录。</p>
<blockquote>
<p>这是最相对安全的登录管理方式</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月13日 - 增加Bash Shell自动修改脚本<br>2015年07月07日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/ssh/" target="_blank" rel="external">http://wsgzao.github.io/post/ssh/</a></p>
<p>扩展阅读</p>
<ul>
<li>SSH原理与运用 -  <a href="http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html</a></li>
<li>Linode - <a href="https://www.linode.com/docs/networking/ssh/use-public-key-authentication-with-ssh" target="_blank" rel="external">https://www.linode.com/docs/networking/ssh/use-public-key-authentication-with-ssh</a></li>
</ul>
<hr>
<h2 id="生成PublicKey">生成PublicKey</h2><blockquote>
<p>建议设置并牢记passphrase密码短语，以Linux生成为例</p>
</blockquote>
<p>Linux：ssh-keygen -t rsa<br>[私钥 (id_rsa) 与公钥 (id_rsa.pub)]<br>Windows：SecurCRT/Xshell/PuTTY<br>[SSH-2 RSA 2048]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#生成SSH密钥对</span></span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line"><span class="comment">#建议直接回车使用默认路径</span></span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line"><span class="comment">#输入密码短语（留空则直接回车）</span></span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line"><span class="comment">#重复密码短语</span></span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">aa:<span class="number">8</span>b:<span class="number">61</span>:<span class="number">13</span>:<span class="number">38</span>:ad:b5:<span class="number">49</span>:ca:<span class="number">51</span>:<span class="number">45</span>:b9:<span class="number">77</span>:e1:<span class="number">97</span>:e1 root@localhost.localdomain</span><br><span class="line">The key<span class="string">'s randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|    .o.          |</span><br><span class="line">|    ..   . .     |</span><br><span class="line">|   .  . . o o    |</span><br><span class="line">| o.  . . o E     |</span><br><span class="line">|o.=   . S .      |</span><br><span class="line">|.*.+   .         |</span><br><span class="line">|o.*   .          |</span><br><span class="line">| . + .           |</span><br><span class="line">|  . o.           |</span><br><span class="line">+-----------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="复制密钥对">复制密钥对</h2><blockquote>
<p>也可以手动在客户端建立目录和authorized_keys，注意修改权限</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#复制公钥到无密码登录的服务器上,22端口改变可以使用下面的命令</span></span><br><span class="line"><span class="comment">#ssh-copy-id -i ~/.ssh/id_rsa.pub "-p 10022 user@server"</span></span><br><span class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@<span class="number">192.168</span>.<span class="number">15.241</span></span><br></pre></td></tr></table></figure>
<h2 id="修改SSH配置文件">修改SSH配置文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑sshd_config文件</span></span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment">#禁用密码验证</span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"><span class="comment">#启用密钥验证</span></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"><span class="comment">#指定公钥数据库文件</span></span><br><span class="line">AuthorsizedKeysFile .ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/^PasswordAuthentication.*/PasswordAuthentication no/g"</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">"s/^#RSAAuthentication.*/RSAAuthentication yes/g"</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">"s/^#PubkeyAuthentication.*/PubkeyAuthentication yes/g"</span> /etc/ssh/sshd_config</span><br><span class="line">sed -i <span class="string">"s/^#AuthorizedKeysFile.*/AuthorizedKeysFile .ssh\/authorized_keys/g"</span> /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重启SSH服务前建议多保留一个会话以防不测</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RHEL/CentOS系统</span></span><br><span class="line">service sshd restart</span><br><span class="line"><span class="comment">#ubuntu系统</span></span><br><span class="line">service ssh restart</span><br><span class="line"><span class="comment">#debian系统</span></span><br><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure>
<h2 id="手动增加管理用户">手动增加管理用户</h2><blockquote>
<p>可以在== 后加入用户注释标识方便管理</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'ssh-rsa XXXX'</span> &gt;&gt;/root/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复查</span></span><br><span class="line">cat /root/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[这是最相对安全的登录管理方式]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sysctl.conf学习和调优]]></title>
    <link href="http://wsgzao.github.io/post/sysctl/"/>
    <id>http://wsgzao.github.io/post/sysctl/</id>
    <published>2015-08-11T07:42:19.000Z</published>
    <updated>2015-08-11T07:51:47.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/jS8VtmPl.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>记得第一次接触<code>/etc/security/limits.conf</code>和<code>/etc/sysctl.conf</code>时是因为部署Oracle时要按需修改内核参数。limits.conf文件实际是Linux PAM（插入式认证模块，Pluggable Authentication Modules）中 pam_limits.so 的配置文件，突破系统的默认限制，对系统访问资源有一定保护作用。 limits.conf 和sysctl.conf区别在于limits.conf是针对用户，而sysctl.conf是针对整个系统参数配置。 </p>
<blockquote>
<p>调整limits.conf和sysctl.conf参数是有必要的</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月10日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/sysctl/" target="_blank" rel="external">http://wsgzao.github.io/post/sysctl/</a></p>
<p>扩展阅读</p>
<p>设置Sysctl.conf用以提高Linux的性能(最完整的sysctl.conf优化方案) - <a href="http://blog.csdn.net/21aspnet/article/details/6584792" target="_blank" rel="external">http://blog.csdn.net/21aspnet/article/details/6584792</a><br>limits.conf工作原理 - <a href="http://my.oschina.net/987openlab/blog/94634" target="_blank" rel="external">http://my.oschina.net/987openlab/blog/94634</a><br>ulimit命令 - <a href="http://man.linuxde.net/ulimit" target="_blank" rel="external">http://man.linuxde.net/ulimit</a><br>Sysctl学习 - <a href="http://pengyao.org/sysctl-1.html" target="_blank" rel="external">http://pengyao.org/sysctl-1.html</a><br>Kernel sysctl configuration file for Linux - <a href="https://klaver.it/linux/sysctl.conf" target="_blank" rel="external">https://klaver.it/linux/sysctl.conf</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="原理">原理</h2><h3 id="limits-conf工作原理">limits.conf工作原理</h3><p>limits.conf是<code>pam_limits.so</code>的配置文件，然后<code>/etc/pam.d/</code>下的应用程序调用<code>pam_***.so</code>模块。譬如说，当用户访问服务器，服务程序将请求发送到PAM模块，PAM模块根据服务名称在<code>/etc/pam.d</code>目录下选择一个对应的服务文件，然后根据服务文件的内容选择具体的PAM模块进行处理。</p>
<h3 id="limits-conf文件格式">limits.conf文件格式</h3><pre><code>username|@groupname   <span class="built_in">type</span>  resource  <span class="built_in">limit</span> 
</code></pre><p>1）username|@groupname<br>设置需要被限制的用户名，组名前面加@和用户名区别。也可用通配符*来做所有用户的限制 </p>
<p>2）type<br>类型有soft，hard 和 -，其中 soft 指的是当前系统生效的设置值。hard 表明系统中所能设定的最大值。soft 的限制不能比 hard 限制高。用 - 就表明同时设置了 soft 和 hard 的值 </p>
<p>3）resource： 表示要限制的资源</p>
<ol>
<li>nofile - 打开文件的最大数目 </li>
<li>noproc - 进程的最大数目 </li>
</ol>
<h3 id="ulimit命令">ulimit命令</h3><blockquote>
<p>ulimit命令用来限制系统用户对shell资源的访问，常用参数解释如下</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span>(选项)</span><br><span class="line"></span><br><span class="line"><span class="operator">-a</span>：显示目前资源限制的设定；</span><br><span class="line">-c &lt;core文件上限&gt;：设定core文件的最大值，单位为区块；</span><br><span class="line"><span class="operator">-d</span> &lt;数据节区大小&gt;：程序数据节区的最大值，单位为KB；</span><br><span class="line"><span class="operator">-f</span> &lt;文件大小&gt;：shell所能建立的最大文件，单位为区块；</span><br><span class="line">-H：设定资源的硬性限制，也就是管理员所设下的限制；</span><br><span class="line">-m &lt;内存大小&gt;：指定可使用内存的上限，单位为KB；</span><br><span class="line">-n &lt;文件数目&gt;：指定同一时间最多可开启的文件数；</span><br><span class="line">-p &lt;缓冲区大小&gt;：指定管道缓冲区的大小，单位<span class="number">512</span>字节；</span><br><span class="line"><span class="operator">-s</span> &lt;堆叠大小&gt;：指定堆叠的上限，单位为KB；</span><br><span class="line">-S：设定资源的弹性限制；</span><br><span class="line">-t &lt;CPU时间&gt;：指定CPU使用时间的上限，单位为秒；</span><br><span class="line">-u &lt;程序数目&gt;：用户最多可开启的程序数目；</span><br><span class="line">-v &lt;虚拟内存大小&gt;：指定可使用的虚拟内存上限，单位为KB。</span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf工作原理">sysctl.conf工作原理</h3><p>sysctl命令被用于在内核运行时动态地修改内核的运行参数，可用的内核参数在目录<code>/proc/sys</code>中。它包含一些TCP/IP堆栈和虚拟内存系统的高级选项， 这可以让有经验的管理员提高引人注目的系统性能。用sysctl可以读取设置超过五百个系统变量。</p>
<h2 id="配置">配置</h2><h3 id="limits-conf设置">limits.conf设置</h3><p>1）暂时生效，适用于通过 <code>ulimit</code> 命令登录 shell 会话期间</p>
<pre><code><span class="built_in">ulimit</span> -SHn <span class="number">65535</span>
</code></pre><p>2）永久生效，通过将一个相应的 ulimit 语句添加到由登录 shell 读取的文件之一（例如 ~/.profile），即特定于 shell 的用户资源文件；或者通过编辑<code>/etc/security/limits.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#比如添加到/etc/profile</span></span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">ulimit</span> -SHn <span class="number">65535</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改最大进程和最大文件打开数限制</span></span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line">* soft nproc <span class="number">11000</span></span><br><span class="line">* hard nproc <span class="number">11000</span></span><br><span class="line">* soft nofile <span class="number">655350</span></span><br><span class="line">* hard nofile <span class="number">655350</span></span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf设置">sysctl.conf设置</h3><blockquote>
<p>这是一个在网络上流传依旧的sysctl.conf优化配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#优化TCP</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"><span class="comment">#禁用包过滤功能 </span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#启用源路由核查功能 </span></span><br><span class="line">net.ipv4.conf.default.rp_filter = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#禁用所有IP源路由 </span></span><br><span class="line">net.ipv4.conf.default.accept_<span class="built_in">source</span>_route = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#使用sysrq组合键是了解系统目前运行情况，为安全起见设为0关闭</span></span><br><span class="line">kernel.sysrq = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#控制core文件的文件名是否添加pid作为扩展</span></span><br><span class="line">kernel.core_uses_pid = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启SYN Cookies，当出现SYN等待队列溢出时，启用cookies来处理</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#每个消息队列的大小（单位：字节）限制</span></span><br><span class="line">kernel.msgmnb = <span class="number">65536</span>  </span><br><span class="line"><span class="comment">#整个系统最大消息队列数量限制</span></span><br><span class="line">kernel.msgmax = <span class="number">65536</span>  </span><br><span class="line"><span class="comment">#单个共享内存段的大小（单位：字节）限制，计算公式64G*1024*1024*1024(字节)</span></span><br><span class="line">kernel.shmmax = <span class="number">68719476736</span>  </span><br><span class="line"><span class="comment">#所有内存大小（单位：页，1页 = 4Kb），计算公式16G*1024*1024*1024/4KB(页)</span></span><br><span class="line">kernel.shmall = <span class="number">4294967296</span>  </span><br><span class="line"><span class="comment">#timewait的数量，默认是180000</span></span><br><span class="line">net.ipv4.tcp_max_tw_buckets = <span class="number">6000</span>  </span><br><span class="line"><span class="comment">#开启有选择的应答</span></span><br><span class="line">net.ipv4.tcp_sack = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#支持更大的TCP窗口. 如果TCP窗口最大超过65535(64K), 必须设置该数值为1</span></span><br><span class="line">net.ipv4.tcp_window_scaling = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#TCP读buffer</span></span><br><span class="line">net.ipv4.tcp_rmem = <span class="number">4096</span> <span class="number">131072</span> <span class="number">1048576</span></span><br><span class="line"><span class="comment">#TCP写buffer</span></span><br><span class="line">net.ipv4.tcp_wmem = <span class="number">4096</span> <span class="number">131072</span> <span class="number">1048576</span>   </span><br><span class="line"><span class="comment">#为TCP socket预留用于发送缓冲的内存默认值（单位：字节）</span></span><br><span class="line">net.core.wmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="comment">#为TCP socket预留用于发送缓冲的内存最大值（单位：字节）</span></span><br><span class="line">net.core.wmem_max = <span class="number">16777216</span>  </span><br><span class="line"><span class="comment">#为TCP socket预留用于接收缓冲的内存默认值（单位：字节）  </span></span><br><span class="line">net.core.rmem_default = <span class="number">8388608</span></span><br><span class="line"><span class="comment">#为TCP socket预留用于接收缓冲的内存最大值（单位：字节）</span></span><br><span class="line">net.core.rmem_max = <span class="number">16777216</span></span><br><span class="line"><span class="comment">#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目</span></span><br><span class="line">net.core.netdev_max_backlog = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128，而nginx定义的NGX_LISTEN_BACKLOG默认为511，所以有必要调整这个值</span></span><br><span class="line">net.core.somaxconn = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上。这个限制仅仅是为了防止简单的DoS攻击，不能过分依靠它或者人为地减小这个值，更应该增加这个值(如果增加了内存之后)</span></span><br><span class="line">net.ipv4.tcp_max_orphans = <span class="number">3276800</span>  </span><br><span class="line"><span class="comment">#记录的那些尚未收到客户端确认信息的连接请求的最大值。对于有128M内存的系统而言，缺省值是1024，小内存的系统则是128</span></span><br><span class="line">net.ipv4.tcp_max_syn_backlog = <span class="number">262144</span>  </span><br><span class="line"><span class="comment">#时间戳可以避免序列号的卷绕。一个1Gbps的链路肯定会遇到以前用过的序列号。时间戳能够让内核接受这种“异常”的数据包。这里需要将其关掉</span></span><br><span class="line">net.ipv4.tcp_timestamps = <span class="number">0</span>  </span><br><span class="line"><span class="comment">#为了打开对端的连接，内核需要发送一个SYN并附带一个回应前面一个SYN的ACK。也就是所谓三次握手中的第二次握手。这个设置决定了内核放弃连接之前发送SYN+ACK包的数量</span></span><br><span class="line">net.ipv4.tcp_synack_retries = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#在内核放弃建立连接之前发送SYN包的数量</span></span><br><span class="line">net.ipv4.tcp_syn_retries = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启TCP连接中time_wait sockets的快速回收</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#开启TCP连接复用功能，允许将time_wait sockets重新用于新的TCP连接（主要针对time_wait连接）</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = <span class="number">1</span>  </span><br><span class="line"><span class="comment">#1st低于此值,TCP没有内存压力,2nd进入内存压力阶段,3rdTCP拒绝分配socket(单位：内存页)</span></span><br><span class="line">net.ipv4.tcp_mem = <span class="number">94500000</span> <span class="number">915000000</span> <span class="number">927000000</span>   </span><br><span class="line"><span class="comment">#如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间。对端可以出错并永远不关闭连接，甚至意外当机。缺省值是60 秒。2.2 内核的通常值是180秒，你可以按这个设置，但要记住的是，即使你的机器是一个轻载的WEB服务器，也有因为大量的死套接字而内存溢出的风险，FIN- WAIT-2的危险性比FIN-WAIT-1要小，因为它最多只能吃掉1.5K内存，但是它们的生存期长些。</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = <span class="number">15</span>  </span><br><span class="line"><span class="comment">#表示当keepalive起用的时候，TCP发送keepalive消息的频度（单位：秒）</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = <span class="number">30</span>  </span><br><span class="line"><span class="comment">#对外连接端口范围</span></span><br><span class="line">net.ipv4.ip_<span class="built_in">local</span>_port_range = <span class="number">2048</span> <span class="number">65000</span></span><br><span class="line"><span class="comment">#表示文件句柄的最大数量</span></span><br><span class="line">fs.file-max = <span class="number">102400</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这是我在实际生产系统自动化部署中用的配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kernel sysctl configuration file for Red Hat Linux</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and</span></span><br><span class="line"><span class="comment"># sysctl.conf(5) for more details.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls IP packet forwarding</span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls source route verification</span></span><br><span class="line">net.ipv4.conf.default.rp_filter = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Do not accept source routing</span></span><br><span class="line">net.ipv4.conf.default.accept_<span class="built_in">source</span>_route = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the System Request debugging functionality of the kernel</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls whether core dumps will append the PID to the core filename.</span></span><br><span class="line"><span class="comment"># Useful for debugging multi-threaded applications.</span></span><br><span class="line">kernel.core_uses_pid = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the use of TCP syncookies</span></span><br><span class="line">net.ipv4.tcp_syncookies = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Disable netfilter on bridges.</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = <span class="number">0</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables = <span class="number">0</span></span><br><span class="line">net.bridge.bridge-nf-call-arptables = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the default maxmimum size of a mesage queue</span></span><br><span class="line">kernel.msgmnb = <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum size of a message, in bytes</span></span><br><span class="line">kernel.msgmax = <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum shared segment size, in bytes</span></span><br><span class="line">kernel.shmmax = <span class="number">68719476736</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Controls the maximum number of shared memory segments, in pages</span></span><br><span class="line">kernel.shmall = <span class="number">4294967296</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br><span class="line">net.netfilter.nf_conntrack_max = <span class="number">1000000</span></span><br><span class="line">kernel.unknown_nmi_panic = <span class="number">0</span></span><br><span class="line">kernel.sysrq = <span class="number">0</span></span><br><span class="line">fs.file-max = <span class="number">1000000</span></span><br><span class="line">vm.swappiness = <span class="number">10</span></span><br><span class="line">fs.inotify.max_user_watches = <span class="number">10000000</span></span><br><span class="line">net.core.wmem_max = <span class="number">327679</span></span><br><span class="line">net.core.rmem_max = <span class="number">327679</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.send_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.secure_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = <span class="number">0</span></span><br><span class="line">net.ipv4.conf.default.accept_redirects = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>最后记得刷新立即生效，关于LTMP的搭建可以参考 - <a href="http://wsgzao.github.io/post/ltmp/" target="_blank" rel="external">http://wsgzao.github.io/post/ltmp/</a></p>
</blockquote>
<pre><code><span class="regexp">/sbin/</span>sysctl -p
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[调整limits.conf和sysctl.conf参数是有必要的]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[XtraBackup不停机不锁表搭建MySQL主从同步实践]]></title>
    <link href="http://wsgzao.github.io/post/xtrabackup/"/>
    <id>http://wsgzao.github.io/post/xtrabackup/</id>
    <published>2015-08-07T07:42:19.000Z</published>
    <updated>2015-08-07T07:49:38.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/02ftb7pa.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>Percona XtraBackup可以说是一个相对完美的免费开源数据备份工具，支持在线无锁表同步复制和可并行高效率的安全备份恢复机制相比<code>mysqldump</code>来说确实让人眼前一亮，与<code>MySQL Enterprise Backup(InnoDB Hot Backup)</code>的功能对比可以参考扩展阅读。当然我们在实际运维过程中都应针对不同的业务需求分析和选择合适的备份恢复方案，这篇文章就是针对MySQL多实例且一个实例对应多个database的情况，实现MySQL在线不停机不锁表的主从同步，日后再继续更新分享基于<code>XtraBackup</code>的其它实用技能。</p>
<blockquote>
<p>XtraBackup是目前首选的备份方案之一</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年08月07日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/xtrabackup/" target="_blank" rel="external">http://wsgzao.github.io/post/xtrabackup/</a></p>
<p>扩展阅读</p>
<p>Percona XtraBackup - <a href="https://www.percona.com/software/mysql-database/percona-xtrabackup" target="_blank" rel="external">https://www.percona.com/software/mysql-database/percona-xtrabackup</a><br>MySQL 5.6 Reference Manual :: 17 Replication - <a href="http://dev.mysql.com/doc/refman/5.6/en/replication.html" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.6/en/replication.html</a><br>基于Xtrabackup的物理备份解决方案预研 - <a href="http://tencentdba.com/blog/pre-research-on-physical-backup-using-xtrabakcup/" target="_blank" rel="external">http://tencentdba.com/blog/pre-research-on-physical-backup-using-xtrabakcup/</a><br>xtrabackup 详解 - <a href="http://www.cnblogs.com/gomysql/p/3650645.html" target="_blank" rel="external">http://www.cnblogs.com/gomysql/p/3650645.html</a><br>LTMP索引 - <a href="http://wsgzao.github.io/index/#LTMP" target="_blank" rel="external">http://wsgzao.github.io/index/#LTMP</a></p>
<hr>
<h2 id="原理">原理</h2><h3 id="MySQL主从同步原理">MySQL主从同步原理</h3><p>MySQL主从同步是在MySQL主从复制(Master-Slave Replication)基础上实现的，通过设置在Master MySQL上的binlog(使其处于打开状态)，Slave MySQL上通过一个I/O线程从Master MySQL上读取binlog，然后传输到Slave MySQL的中继日志中，然后Slave MySQL的SQL线程从中继日志中读取中继日志，然后应用到Slave MySQL的数据库中。这样实现了主从数据同步功能。</p>
<h3 id="XtraBackup备份原理">XtraBackup备份原理</h3><p>innobackupex在后台线程不断追踪InnoDB的日志文件，然后复制InnoDB的数据文件。数据文件复制完成之后，日志的复制线程也会结束。这样就得到了不在同一时间点的数据副本和开始备份以后的事务日志。完成上面的步骤之后，就可以使用InnoDB崩溃恢复代码执行事务日志（redo log），以达到数据的一致性。<br>备份分为两个过程：</p>
<ol>
<li>backup，备份阶段，追踪事务日志和复制数据文件（物理备份）。</li>
<li>preparing，重放事务日志，使所有的数据处于同一个时间点，达到一致性状态。</li>
</ol>
<h3 id="XtraBackup的优点">XtraBackup的优点</h3><ol>
<li>可以快速可靠的完成数据备份（复制数据文件和追踪事务日志）</li>
<li>数据备份过程中不会中断事务的处理（热备份）</li>
<li>节约磁盘空间和网络带宽</li>
<li>自动完成备份鉴定</li>
<li>因更快的恢复时间而提高在线时间</li>
</ol>
<h2 id="配置">配置</h2><h3 id="准备工作">准备工作</h3><blockquote>
<p>MySQL步骤和my.cnf配置参考LTMP - <a href="http://wsgzao.github.io/post/ltmp/" target="_blank" rel="external">http://wsgzao.github.io/post/ltmp/</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#原有主数据库版本</span><br><span class="line">mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.5.31, for Linux (x86_64) using readline 5.1</span><br><span class="line"></span><br><span class="line">#迁移从数据库版本</span><br><span class="line">mysql -V</span><br><span class="line">mysql  Ver 14.14 Distrib 5.6.25, for linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">#检查数据库引擎</span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">engines</span>;</span></span><br><span class="line"></span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |</span><br><span class="line">| CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |</span><br><span class="line">| MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |</span><br><span class="line">| MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |</span><br><span class="line">| InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |</span><br><span class="line">| ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |</span><br><span class="line">| FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#主从数据库同步注意点</span><br><span class="line">[mysqld]</span><br><span class="line">#主从之间的id不能相同</span><br><span class="line">server-id</span><br><span class="line">#启用二进制日志</span><br><span class="line">log-bin</span><br><span class="line">#一般在从库开启（可选）</span><br><span class="line">read_only</span><br><span class="line">#推荐使用InnoDB并做好相关配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#检查主从数据库状态</span><br><span class="line">mysql -S /tmp/mysql.sock -e "<span class="operator"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'server_id'</span>;</span>"</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| server_id     | 1     |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line"></span><br><span class="line">mysql -S /tmp/mysql.sock -e "<span class="operator"><span class="keyword">show</span> <span class="keyword">global</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'log_bin'</span>;</span>"</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| log_bin       | ON    |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="安装percona-xtrabackup">安装percona-xtrabackup</h3><blockquote>
<p>一般推荐rpm安装 - <a href="https://www.percona.com/downloads/XtraBackup/LATEST/" target="_blank" rel="external">https://www.percona.com/downloads/XtraBackup/LATEST/</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL</span><br><span class="line"><span class="comment">#rpm -ivh percona-xtrabackup-2.2.12-1.el6.x86_64.rpm </span></span><br><span class="line">rpm -Uvh percona-xtrabackup-<span class="number">2.2</span>.<span class="number">12</span>-<span class="number">1</span>.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>
<h3 id="备份和恢复">备份和恢复</h3><blockquote>
<p>通常一般都直接使用innobackupex，因为它能同时备份InnoDB和MyISAM引擎的表<br>重点关注Slave_IO_Running和Slave_SQL_Runningd的状态是否为YES</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#备份</span><br><span class="line">innobackupex <span class="comment">--socket=/usr/local/var/mysql2/mysql2.sock --user=root --password --defaults-file=/etc/mysqld_multi.cnf --parallel=4 --database=passport /tmp/backup</span></span><br><span class="line">#保持事务一致性</span><br><span class="line">innobackupex <span class="comment">--socket=/usr/local/var/mysql2/mysql2.sock --user=root --password --defaults-file=/etc/mysqld_multi.cnf --database=passport --apply-log /tmp/backup/2015-08-05_16-08-14</span></span><br><span class="line">#传输</span><br><span class="line">scp -r /tmp/<span class="operator"><span class="keyword">backup</span>/<span class="number">2015</span>-<span class="number">08</span>-<span class="number">05</span>_16-<span class="number">08</span>-<span class="number">14</span> <span class="number">10.10</span><span class="number">.16</span><span class="number">.24</span>:/tmp/<span class="keyword">backup</span>/ </span><br><span class="line">#恢复</span><br><span class="line">innobackupex <span class="comment">--socket=/tmp/mysql.sock --user=root --password --defaults-file=/app/local/mysql/my.cnf --copy-back /tmp/backup/2015-08-05_16-08-14/</span></span><br><span class="line">#还原权限</span><br><span class="line">chown -R mysql:mysql /app/<span class="keyword">data</span>/mysql/<span class="keyword">data</span></span><br><span class="line">service mysqld <span class="keyword">start</span></span><br><span class="line">/app/<span class="keyword">local</span>/mysql/scripts/mysql_install_db <span class="comment">--basedir=/app/local/mysql --datadir=/app/data/mysql/data --no-defaults --skip-name-resolve --user=mysql</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#主库授权同步帐号</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">CONCAT</span>(<span class="string">'User: '''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>) <span class="keyword">AS</span> <span class="keyword">query</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">GRANT</span> REPLICATION <span class="keyword">SLAVE</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'slave_passport'</span>@<span class="string">'10.10.16.24'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'slave_passport'</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span></span><br><span class="line"></span><br><span class="line">#从库开启同步</span><br><span class="line">cat /tmp/<span class="operator"><span class="keyword">backup</span>/<span class="number">2015</span>-<span class="number">08</span>-<span class="number">05</span>_16-<span class="number">08</span>-<span class="number">14</span>/xtrabackup_binlog_info </span><br><span class="line">mysql-<span class="keyword">bin</span><span class="number">.002599</span>    <span class="number">804497686</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST=<span class="string">'10.10.16.51'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'slave_passport'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'slave_passport'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3307</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.002599'</span>,</span><br><span class="line">MASTER_LOG_POS=<span class="number">804497686</span>;</span></span><br><span class="line"></span><br><span class="line">#开启主从同步</span><br><span class="line"><span class="operator"><span class="keyword">start</span> <span class="keyword">slave</span>;</span></span><br><span class="line">#查看从库状态</span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span>\ G</span><br><span class="line">#从库的检查参数</span><br><span class="line">Slave_IO_Running=Yes</span><br><span class="line">Slave_SQL_Running=Yes</span><br><span class="line"></span><br><span class="line">#主库的检查参数</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span> \G</span><br><span class="line"></span><br><span class="line">+<span class="comment">------------------+-----------+--------------+------------------+</span></span><br><span class="line">| File             | <span class="keyword">Position</span>  | Binlog_Do_DB | Binlog_Ignore_DB |</span><br><span class="line">+<span class="comment">------------------+-----------+--------------+------------------+</span></span><br><span class="line">| mysql-<span class="keyword">bin</span><span class="number">.002600</span> | <span class="number">454769337</span> |              |                  |</span><br><span class="line">+<span class="comment">------------------+-----------+--------------+------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">processlist</span>;</span></span><br><span class="line"></span><br><span class="line">Master has sent all binlog to slave; waiting for binlog to be updated</span><br></pre></td></tr></table></figure>
<h3 id="MySQL主从切换">MySQL主从切换</h3><blockquote>
<p>切换前断开主库访问连接观察进程状态，无写操作后再停止从库IO_THREAD进行切换</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#查看主库状态</span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">processlist</span>;</span></span><br><span class="line">Master has sent all binlog to slave; waiting for binlog to be updated</span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span> \G</span><br><span class="line"></span><br><span class="line">#从库停止 IO_THREAD 线程</span><br><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span> IO_THREAD;</span></span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">processlist</span>;</span></span><br><span class="line">Slave has read all relay log; waiting for the slave I/O thread to <span class="operator"><span class="keyword">update</span> it</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G</span><br><span class="line"></span><br><span class="line">#从库切换为主库</span><br><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">reset</span> <span class="keyword">master</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">reset</span> <span class="keyword">slave</span> <span class="keyword">all</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span> \G</span><br><span class="line"></span><br><span class="line">#激活帐户</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="keyword">CONCAT</span>(<span class="string">'User: '''</span>,<span class="keyword">user</span>,<span class="string">'''@'''</span>,host,<span class="string">''';'</span>) <span class="keyword">AS</span> <span class="keyword">query</span> <span class="keyword">FROM</span> mysql.<span class="keyword">user</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">GRANT</span> REPLICATION <span class="keyword">SLAVE</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'slave_passport'</span>@<span class="string">'10.10.16.51'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'slave_passport'</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span></span><br><span class="line"></span><br><span class="line">#切换原有主库为从库</span><br><span class="line"><span class="operator"><span class="keyword">reset</span> <span class="keyword">master</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">reset</span> <span class="keyword">slave</span> <span class="keyword">all</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CHANGE</span> <span class="keyword">MASTER</span> <span class="keyword">TO</span></span><br><span class="line">MASTER_HOST=<span class="string">'10.10.16.24'</span>,</span><br><span class="line">MASTER_USER=<span class="string">'slave_passport'</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">'slave_passport'</span>,</span><br><span class="line">MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">'mysql-bin.000001'</span>,</span><br><span class="line">MASTER_LOG_POS=<span class="number">804497686</span>;</span></span><br><span class="line"></span><br><span class="line">#检查主库</span><br><span class="line"><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">PROCESSLIST</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">status</span> \G</span><br><span class="line"></span><br><span class="line">#启动从库</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCESSLIST</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">start</span> <span class="keyword">slave</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G</span></span><br></pre></td></tr></table></figure>
<h3 id="常见问题">常见问题</h3><blockquote>
<p>Slave_SQL_Running:No</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#一般是事务回滚造成的</span><br><span class="line"><span class="operator"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> SQL_SLAVE_SKIP_COUNTER=<span class="number">1</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">start</span> <span class="keyword">slave</span>;</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[XtraBackup是目前首选的备份方案之一]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Windows常用软件推荐]]></title>
    <link href="http://wsgzao.github.io/post/windows/"/>
    <id>http://wsgzao.github.io/post/windows/</id>
    <published>2015-08-05T16:05:27.000Z</published>
    <updated>2015-08-05T15:44:31.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/l6zV1ws3.jpeg" alt=""></p>
<h2 id="前言">前言</h2><p>很多人都认为我是计算机高手，其实我只会帮你修理下你的电脑啦，曾几何时我也帮助过好多好多的同学和老师，尝试和体验各种各样的软件，但谁又能想到我曾今也对你们的电脑做过很多失败的坑爹操作，把你们最宝贵的数据撸得灰飞烟灭，这里要感谢当时允许我不断尝试失败的大白鼠 @王纪华 tommy(249033945)，使我养成了发散思维、逆向思维和创造性思维的解决问题之道。作为一名非职业HelpDesk，我一定不是最最优秀的那一群技术大牛，但我也努力超越了99.99%的从业者，Because I just love and enjoy thinking to do better and better.</p>
<p>如果你认同<code>高效，实用</code>的软件使用理念就跟着我走吧，让我们一起寻找<code>适合自己的好用软件</code>。</p>
<blockquote>
<p>长期更新此文以督促自己的懒惰，我要用佳软改变你一生的习惯。</p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月06日 - 增加Ditto, mRemoteNG, SocksCap64, SwitchHosts<br>2015年08月04日 - 增加StartIsBack++, Clover, Cmd Markdown, JetBrains<br>2015年05月29日 - 增加AnyDesk，COW，替换QQ拼音纯净版为百度输入法<br>2015年04月16日 - 增加Listary，Bandisoft，Adobe Acrobat DC，Auto CAD 2016<br>2015年03月31日 - 增加微PE，有道云协作，自同步<br>2015年03月05日 - 正式更名为Windows常用软件推荐，统一日志标题和链接<br>2015年02月24日 - 替换TrueCrypt为VeraCrypt，增加易数一键还原，百度电脑专家<br>2015年02月20日 - 剥离Mac和Android部分<br>2014年11月12日 - 增加Win10，3DM运行库，网易云音乐，好奇心日报，调整部分链接和描述<br>2014年08月26日 - 引导部分原版链接至第三方Mod修改版(绿色精简)<br>2014年08月13日 - 增加DirectX Repair，EaseUS Data Recovery Wizard和Mac专题<br>2014年08月12日 - 精简优化分离内容，转化为Markdown书写<br>2014年06月02日 - 更新猎豹免费WiFi和猎豹清理大师<br>2014年04月15日 - 更新Windows 8.1 With Update和一小波翻墙工具并调整部分软件推荐<br>2014年03月18日 - 更新TeamViewer 9，Sublime 3，读知乎<br>2014年03月07日 - 新增雅虎天气，更新Office2013 With SP1等其它软件版本及评语<br>2014年01月20日 - 更新部分软件评语，新增专业软件部分之文件传输专题<br>2013年12月27日 - 手机浏览器回归QQ浏览器，更新部分软件版本和推荐优先级<br>2013年12月03日 - 更新部分软件版本，新增专业软件部分之文本处理专题<br>2013年11月28日 - 更新大批软件版本，新增福昕风腾PDF，StartIsBackPlus，高德地图<br>2013年11月21日 - PE更换为IT天空 SKYPE<br>2013年11月03日 - 增加专业软件部分之网络穿透专题<br>2013年10月08日 - 简单看图制图类工具更换为QQ影像<br>2013年10月04日 - 手机浏览器更换为傲游及链接文字描述等细节<br>2013年09月21日 - 精细化内容<br>2013年09月19日 - 完善内容<br>2013年09月07日 - 补充专业软件部分<br>2013年08月29日 - 微调精炼语法<br>2013年08月28日 - 优化下语句和措辞<br>2013年08月27日 - 增加Software List For Android<br>2013年08月26日 - 增加OS部分<br>2013年08月25日 - 补充特色推荐部分<br>2013年08月24日 - 常用软件部分基本结束<br>2013年08月23日 - 补充内容<br>2013年08月22日 - 补充内容<br>2013年08月21日 - 梳理框架</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/windows/" target="_blank" rel="external">http://wsgzao.github.io/post/windows/</a></p>
<p>扩展阅读</p>
<ul>
<li>小众软件 - <a href="http://love.appinn.com/" target="_blank" rel="external">http://love.appinn.com/</a></li>
<li>善用佳软 - <a href="http://xbeta.info/" target="_blank" rel="external">http://xbeta.info/</a></li>
<li>zd423 - <a href="http://www.zdfans.com/" target="_blank" rel="external">http://www.zdfans.com/</a></li>
<li>Apps索引 - <a href="http://wsgzao.github.io/index/#Apps" target="_blank" rel="external">http://wsgzao.github.io/index/#Apps</a></li>
</ul>
<hr>
<h2 id="Windows_Operating_System">Windows Operating System</h2><blockquote>
<p>重装系统建议谨慎行事，丢失数据可是很蛋疼的一件事哦</p>
</blockquote>
<p>Windows 7 - <a href="http://www.zdfans.com/4922.html" target="_blank" rel="external">http://www.zdfans.com/4922.html</a></p>
<ul>
<li>普通用户建议稳定在Win7</li>
<li>怀有好奇心的朋友可考虑向Win10迈进</li>
<li>玩游戏和办公需求高者请勿尝鲜</li>
</ul>
<p>Windows 10 - <a href="http://www.zdfans.com/5671.html" target="_blank" rel="external">http://www.zdfans.com/5671.html</a></p>
<ul>
<li>Windows 10强势回归</li>
</ul>
<p>Ghost - <a href="http://songyongzhi.blog.163.com/" target="_blank" rel="external">http://songyongzhi.blog.163.com/</a></p>
<ul>
<li>偷懒请认准Ghost，ESD会慢慢成为新的标准</li>
<li>安装方式建议【U盘引导+移动硬盘安装】</li>
</ul>
<p>Others - <a href="http://msdn.itellyou.cn/" target="_blank" rel="external">http://msdn.itellyou.cn/</a></p>
<ul>
<li>简单直接的微软原版资源下载渠道</li>
</ul>
<p>U盘装机助理 - <a href="http://www.itiankong.net/forum-usbzl-1.html" target="_blank" rel="external">http://www.itiankong.net/forum-usbzl-1.html</a></p>
<ul>
<li>作者频繁的更新速度深深的折磨着我幼小的心灵</li>
</ul>
<p>微PE - <a href="http://www.wepe.com.cn/" target="_blank" rel="external">http://www.wepe.com.cn/</a></p>
<ul>
<li>感谢前通用PE作者@李培聪的付出，祝你创业顺利哈</li>
</ul>
<hr>
<h2 id="Software_List_For_Windows">Software List For Windows</h2><h3 id="特色推荐">特色推荐</h3><p>Listary -  <a href="http://www.listary.com/" target="_blank" rel="external">http://www.listary.com/</a></p>
<ul>
<li>如果Mac下的Alfred作为排名第一的效率工具类神器，那你还在犹豫什么呢，必装</li>
<li>我也从Launchy转投Listary，可以和Everything/Total Commander相辅相成</li>
</ul>
<p>ADSafe广告管家 - <a href="http://www.ad-safe.com/" target="_blank" rel="external">http://www.ad-safe.com/</a></p>
<ul>
<li>去网页，弹窗，视频40s等待广告就是如此简单</li>
<li>发现上网异常请自觉停用此类去广告软件</li>
</ul>
<p>Http File Server - <a href="http://pan.baidu.com/s/1i3u0vGx" target="_blank" rel="external">http://pan.baidu.com/s/1i3u0vGx</a></p>
<ul>
<li>十分方便的HTTP文件共享服务器</li>
<li>Mod By 随波</li>
</ul>
<h3 id="压缩解压缩">压缩解压缩</h3><p>好压 - <a href="http://haozip.2345.com/" target="_blank" rel="external">http://haozip.2345.com/</a></p>
<ul>
<li>简单方便，自带虚拟光驱</li>
<li>WinRAR，7zip，360压缩也许都很优秀，但我相信自己体验后做出的选择</li>
</ul>
<p>Bandizip - <a href="http://www.bandisoft.com/bandizip" target="_blank" rel="external">http://www.bandisoft.com/bandizip</a></p>
<ul>
<li>Bandisoft出品，轻巧、快速、免费的压缩软件</li>
</ul>
<h3 id="图像浏览处理">图像浏览处理</h3><p>2345看图王 - <a href="http://pic.2345.com/" target="_blank" rel="external">http://pic.2345.com/</a></p>
<ul>
<li>速度最快的看图软件</li>
<li>ACDSee臃肿，Picasa乏力，专业制图请使用PS</li>
</ul>
<p>Honeyview - <a href="http://www.bandisoft.com/honeyview/" target="_blank" rel="external">http://www.bandisoft.com/honeyview/</a></p>
<ul>
<li>也是Bandisoft家族出品，速度惊人的图像浏览器</li>
</ul>
<p>Faststone Capture - <a href="http://www.portablesoft.org/faststone-capture/" target="_blank" rel="external">http://www.portablesoft.org/faststone-capture/</a></p>
<ul>
<li>截图神器+录屏工具</li>
<li>我也不反对大家使用QQ截图哈</li>
</ul>
<p>Adobe Photoshop - <a href="http://www.flighty.cn/html/soft/20141016_263.html" target="_blank" rel="external">http://www.flighty.cn/html/soft/20141016_263.html</a></p>
<ul>
<li>专业制图利器</li>
<li>Mod By 轻狂志</li>
</ul>
<h3 id="文字办公">文字办公</h3><p>Microsoft Office 2013 With SP1 - <a href="http://pan.baidu.com/s/1i343Bql" target="_blank" rel="external">http://pan.baidu.com/s/1i343Bql</a></p>
<ul>
<li>整合Visio &amp; Project</li>
<li>普通用户请下载x86版本</li>
<li>金山WPS格式兼容性不佳建议在移动端使用</li>
</ul>
<p>Microsoft Office 2007 - <a href="http://pan.baidu.com/share/link?shareid=966283776&amp;uk=1157904223" target="_blank" rel="external">http://pan.baidu.com/share/link?shareid=966283776&amp;uk=1157904223</a></p>
<ul>
<li>Office 2007 SP3中英双语VOL集成</li>
<li>整合Visio &amp; Project</li>
<li>已完美激活建议求稳者安装</li>
</ul>
<p>MathType - <a href="http://fengqingwuhen.blog.163.com/blog/static/17747406320141019104445935/" target="_blank" rel="external">http://fengqingwuhen.blog.163.com/blog/static/17747406320141019104445935/</a></p>
<ul>
<li>最佳数学公式编辑器</li>
</ul>
<p>福昕风腾PDF套件金山版 - <a href="http://pan.baidu.com/s/17qSRE" target="_blank" rel="external">http://pan.baidu.com/s/17qSRE</a></p>
<ul>
<li>优秀的个人免费PDF阅读软件</li>
<li>简单小巧够用</li>
</ul>
<p>Adobe Acrobat - <a href="http://pan.baidu.com/s/1sj5aaSl" target="_blank" rel="external">http://pan.baidu.com/s/1sj5aaSl</a></p>
<ul>
<li>需要使用专业功能朋友还是坚持Acrobat吧</li>
</ul>
<h3 id="浏览器">浏览器</h3><p>Maxthon傲游 - <a href="http://www.maxthon.cn/" target="_blank" rel="external">http://www.maxthon.cn/</a></p>
<ul>
<li>被搜狗，360极速，金山猎豹，百度浏览器依次挑战，但依旧努力改变着世界</li>
</ul>
<p>Google Chrome - <a href="http://chrome.google.com/" target="_blank" rel="external">http://chrome.google.com/</a></p>
<ul>
<li>简洁的界面和精益求精的内核是核心</li>
<li>插件丰富，版本飙得够快</li>
</ul>
<h3 id="输入法">输入法</h3><p>百度输入法 - <a href="http://shurufa.baidu.com" target="_blank" rel="external">http://shurufa.baidu.com</a></p>
<ul>
<li>百度输入法尊重用户体验成功上位，全平台统一已成定局</li>
<li>可惜腾和搜狗已然忘记研发输入法的初心，唉~</li>
</ul>
<h3 id="安全防护">安全防护</h3><p>腾讯电脑管家 - <a href="http://guanjia.qq.com" target="_blank" rel="external">http://guanjia.qq.com</a></p>
<ul>
<li>刷个存在感</li>
</ul>
<p>金山毒霸 - <a href="http://www.ijinshan.com/" target="_blank" rel="external">http://www.ijinshan.com/</a></p>
<ul>
<li>金山一直很努力</li>
<li>猎豹系列很出色</li>
</ul>
<p>360安全中心 - <a href="http://www.360.cn/" target="_blank" rel="external">http://www.360.cn/</a></p>
<ul>
<li>用户体验和技术实力毋庸置疑</li>
<li>我不喜欢周鸿祎yī靠打压对手的流氓商业模式</li>
<li>360已经在安全领域形成垄断优势</li>
</ul>
<p>百度电脑专家 - <a href="http://zhuanjia.baidu.com/" target="_blank" rel="external">http://zhuanjia.baidu.com/</a></p>
<ul>
<li>360和腾讯都有电脑修复，但唯独百度解决了很多实际问题</li>
<li>百度卫士和杀毒还需要努力啊</li>
</ul>
<h3 id="媒体处理">媒体处理</h3><p>QQ影音 - <a href="http://player.qq.com/" target="_blank" rel="external">http://player.qq.com/</a></p>
<ul>
<li>全能，轻巧，无广告</li>
<li>PotPlayer或许是目前最佳的播放器</li>
</ul>
<p>QQ音乐 - <a href="http://music.qq.com/" target="_blank" rel="external">http://music.qq.com/</a></p>
<ul>
<li>我办理了绿钻</li>
</ul>
<p>网易云音乐 - <a href="http://music.163.com" target="_blank" rel="external">http://music.163.com</a></p>
<ul>
<li>网易再一次用优秀的产品体验为自己赢得了口碑</li>
</ul>
<p>完美解码 - <a href="http://jm.wmzhe.com/" target="_blank" rel="external">http://jm.wmzhe.com/</a></p>
<ul>
<li>高清全能解码播放</li>
<li>视频制作需要</li>
</ul>
<p>格式工厂 - <a href="http://www.zdfans.com/1072.html" target="_blank" rel="external">http://www.zdfans.com/1072.html</a></p>
<ul>
<li>经常音视频转码必备之一吧</li>
</ul>
<h3 id="下载工具">下载工具</h3><p>QQ旋风 - <a href="http://xf.qq.com/" target="_blank" rel="external">http://xf.qq.com/</a></p>
<ul>
<li>界面清爽，回归下载本质</li>
<li>如今浏览器自带下载也足矣</li>
</ul>
<p>迅雷 - <a href="http://vip.xunlei.com/fast_xl/" target="_blank" rel="external">http://vip.xunlei.com/fast_xl/</a></p>
<ul>
<li>产品本身很优秀</li>
<li>恭喜IPO成功，期待和小米的整合组建智能家庭</li>
</ul>
<h3 id="聊天通信">聊天通信</h3><p>QQ - <a href="http://im.qq.com/" target="_blank" rel="external">http://im.qq.com/</a></p>
<ul>
<li>我办理了QQ会员</li>
</ul>
<p>飞信 - <a href="http://feixin.10086.cn/" target="_blank" rel="external">http://feixin.10086.cn/</a></p>
<ul>
<li>群发短信，微信改变了我们的生活，4G的时代短信将离我们远去</li>
<li>只剩免费的短信报警作用吧</li>
</ul>
<p>Skype - <a href="http://www.skype.com/" target="_blank" rel="external">http://www.skype.com/</a></p>
<ul>
<li>MSN再见了因为不思进取，Skype不要走老路啊</li>
</ul>
<h3 id="词典翻译">词典翻译</h3><p>有道词典 - <a href="http://cidian.youdao.com/" target="_blank" rel="external">http://cidian.youdao.com/</a></p>
<ul>
<li>越做越强，短期内无人能超越</li>
<li>金山词霸和必应词典看移动端吧</li>
</ul>
<h3 id="邮件客户端">邮件客户端</h3><p>Foxmail - <a href="http://foxmail.com.cn/" target="_blank" rel="external">http://foxmail.com.cn/</a></p>
<ul>
<li>入职后的第一件事就是收发邮件</li>
<li>个人日常在线邮箱建议使用QQ邮箱</li>
<li>投简历还是无奈选择Gmail</li>
</ul>
<h3 id="文本编辑器">文本编辑器</h3><p>NotePad2 - <a href="http://pan.baidu.com/s/1qWkb1q0" target="_blank" rel="external">http://pan.baidu.com/s/1qWkb1q0</a></p>
<ul>
<li>差个tab标签，建议替换自带记事本</li>
<li>Mod By zhfi</li>
</ul>
<p>Sublime Text - <a href="http://pan.baidu.com/share/home?uk=3693847658#category/type=0" target="_blank" rel="external">http://pan.baidu.com/share/home?uk=3693847658#category/type=0</a></p>
<ul>
<li>无比性感的编辑器，</li>
<li>建议补充搭配使用</li>
</ul>
<p>UEStudio -  <a href="http://hrtsea.com/?s=UEStudio" target="_blank" rel="external">http://hrtsea.com/?s=UEStudio</a></p>
<ul>
<li>专业强大的文本编辑器</li>
<li>略显臃肿</li>
</ul>
<p>Cmd Markdown - <a href="http://www.zybuluo.com/mdeditor" target="_blank" rel="external">http://www.zybuluo.com/mdeditor</a></p>
<ul>
<li>Markdown简洁的语法可以辅助你书写更有质量的文章</li>
<li>作业部落推出客户端啦</li>
</ul>
<h3 id="数据同步共享">数据同步共享</h3><p>金山快盘 - <a href="http://www.kuaipan.cn/" target="_blank" rel="external">http://www.kuaipan.cn/</a></p>
<ul>
<li>百度网盘统一文件共享，360不时捅其菊花，金山不断深耕协同办公，腾讯继续保持蛋疼状态</li>
</ul>
<p>Evernote - <a href="http://www.evernote.com/" target="_blank" rel="external">http://www.evernote.com/</a></p>
<ul>
<li>笔记类应用除了onenote我只认可它</li>
<li>建议搭配金山快盘和Evernote，提高工作效率</li>
</ul>
<p>有道云协作 - <a href="http://note.youdao.com/groupintro.html" target="_blank" rel="external">http://note.youdao.com/groupintro.html</a></p>
<ul>
<li>跨平台支持多人实时协作，可以极大提升团队效率</li>
<li>虽然没有直接推荐有道云笔记但对于文字编辑类工作者来说整合使用还是很方便的</li>
</ul>
<p>FileGee - <a href="http://cn.filegee.com/" target="_blank" rel="external">http://cn.filegee.com/</a></p>
<ul>
<li>国内优秀的个人免费本地同步工具</li>
</ul>
<p>自同步 - <a href="http://www.zisync.com/" target="_blank" rel="external">http://www.zisync.com/</a></p>
<ul>
<li>局域网最高效的文件同步、共享工具</li>
</ul>
<h3 id="数据备份恢复">数据备份恢复</h3><p>易数一键还原 - <a href="http://www.onekeyrestore.cn/" target="_blank" rel="external">http://www.onekeyrestore.cn/</a></p>
<ul>
<li>以DiskGenius为内核开发，安全易用靠谱</li>
<li>同时推荐ORM一键还原系统</li>
</ul>
<p>DiskGenius -  <a href="http://pan.baidu.com/s/1kTj3b75" target="_blank" rel="external">http://pan.baidu.com/s/1kTj3b75</a></p>
<ul>
<li>国内磁盘分区和数据恢复的佼佼者</li>
<li>Mod By MyCrack</li>
</ul>
<p>EaseUS Data Recovery Wizard - <a href="http://www.0daydown.com/?s=EaseUS+Data+Recovery" target="_blank" rel="external">http://www.0daydown.com/?s=EaseUS+Data+Recovery</a></p>
<ul>
<li>原先是国产易我数据恢复，现在依旧犀利啊</li>
</ul>
<h3 id="数据加密">数据加密</h3><p>VeraCrypt -  <a href="http://sourceforge.net/projects/veracrypt/" target="_blank" rel="external">http://sourceforge.net/projects/veracrypt/</a></p>
<ul>
<li>替代TrueCrypt，不断修复安全漏洞</li>
<li>微软自带的 BitLocker 驱动器加密也足矣</li>
</ul>
<h3 id="快速启动">快速启动</h3><p>StartIsBack++ - <a href="http://www.zdfans.com/5573.html" target="_blank" rel="external">http://www.zdfans.com/5573.html</a></p>
<ul>
<li>最好用的开始菜单恢复软件</li>
</ul>
<p>Clover - <a href="http://ejie.me/" target="_blank" rel="external">http://ejie.me/</a></p>
<ul>
<li>为你的 Windows Explorer 插上翅膀</li>
<li>可惜作者不更新了，在Win10上会有一些小Bug</li>
</ul>
<p>Ditto - <a href="http://ditto-cp.sourceforge.net/" target="_blank" rel="external">http://ditto-cp.sourceforge.net/</a></p>
<ul>
<li>不可不用的精品免费Windows剪贴板增强小工具</li>
</ul>
<p>SwitchHosts - <a href="http://oldj.github.io/SwitchHosts/" target="_blank" rel="external">http://oldj.github.io/SwitchHosts/</a></p>
<ul>
<li>SwitchHosts! 是一个管理、切换多个 hosts 方案的工具</li>
<li>它是一个免费开源的软件，基于 wxPython 开发，可在 Windows/Linux/Mac 下运行</li>
</ul>
<h3 id="光盘刻录">光盘刻录</h3><p>Nero -  <a href="http://pan.baidu.com/share/link?shareid=1935729386&amp;uk=1157904223" target="_blank" rel="external">http://pan.baidu.com/share/link?shareid=1935729386&amp;uk=1157904223</a></p>
<ul>
<li>专注刻录，刻录时记得校验数据，别刻飞了</li>
</ul>
<p>UltraISO - <a href="http://www.zdfans.com/1397.html" target="_blank" rel="external">http://www.zdfans.com/1397.html</a></p>
<ul>
<li>作为经常折腾各类操作系统的人来说，它不可或缺</li>
</ul>
<h3 id="驱动运行库">驱动运行库</h3><p>万能驱动助理 - <a href="http://www.wandrv.com" target="_blank" rel="external">http://www.wandrv.com</a></p>
<ul>
<li>确实是装机必备的万能驱动包</li>
</ul>
<p>驱动精灵 - <a href="http://www.drivergenius.com/" target="_blank" rel="external">http://www.drivergenius.com/</a></p>
<ul>
<li>不重装电脑或者驱动异常，别没事升级驱动</li>
</ul>
<p>DirectX Repair - <a href="http://blog.csdn.net/vbcom/article/details/6962388" target="_blank" rel="external">http://blog.csdn.net/vbcom/article/details/6962388</a></p>
<ul>
<li>系统+游戏修复神器啊</li>
</ul>
<p>3DM游戏运行库 - <a href="http://bbs.3dmgame.com/thread-3551335-1-1.html" target="_blank" rel="external">http://bbs.3dmgame.com/thread-3551335-1-1.html</a></p>
<ul>
<li>集成32位和64位运行库，是目前互联网上最新最全的常用运行库合集</li>
</ul>
<h3 id="远程控制">远程控制</h3><p>TeamViewer - <a href="http://www.zdfans.com/789.html" target="_blank" rel="external">http://www.zdfans.com/789.html</a></p>
<ul>
<li>远程控制，内网穿透，VPN共享，跨平台</li>
<li>对个人免费，业界良心啊，QQ表示继续努力</li>
</ul>
<p>AnyDesk - <a href="http://anydesk.com/" target="_blank" rel="external">http://anydesk.com/</a></p>
<ul>
<li>远程控制效果或许会超出你的想象，作为TeamViewer备用方案</li>
</ul>
<p>向日葵 - <a href="http://sunlogin.oray.com/zh_CN/" target="_blank" rel="external">http://sunlogin.oray.com/zh_CN/</a></p>
<ul>
<li>硬是一种态度</li>
</ul>
<h3 id="Windows和Office激活">Windows和Office激活</h3><p>Windows Loader - <a href="http://forums.mydigitallife.info/forums/39-Windows-Loader" target="_blank" rel="external">http://forums.mydigitallife.info/forums/39-Windows-Loader</a></p>
<ul>
<li>几乎是万能的Windows NT6以上版本激活工具</li>
</ul>
<p>HEU KMS Activator - <a href="http://www.heu8.com/2752.html" target="_blank" rel="external">http://www.heu8.com/2752.html</a></p>
<ul>
<li>国人制作的本地KMS激活工具，可激活Windows NT6以上版本和Office 2010/2013</li>
</ul>
<p>KMS8 - <a href="http://pan.baidu.com/s/1jGknAv0" target="_blank" rel="external">http://pan.baidu.com/s/1jGknAv0</a></p>
<ul>
<li>国内知名KMS激活工具小马KMS8，简单小巧且拥有不俗的成功率</li>
</ul>
<hr>
<h2 id="Software_List_For_Windows_Professional">Software List For Windows Professional</h2><blockquote>
<p>大部分行业都有属于自己的专业工具，我这里仅结合实际列举较为实用的</p>
</blockquote>
<p>VMware Workstation -  <a href="http://www.zdfans.com/3847.html" target="_blank" rel="external">http://www.zdfans.com/3847.html</a></p>
<ul>
<li>我相信硬件性能过剩的趋势将驱使更多的人走近虚拟化，感受另一个奇妙的世界</li>
</ul>
<p>SecureCRT - <a href="http://www.portablesoft.org/securecrt-securefx-integrated/" target="_blank" rel="external">http://www.portablesoft.org/securecrt-securefx-integrated/</a></p>
<ul>
<li>专业的终端管理软件，Unix连接必备</li>
<li>免费版请用PuTTY或Xshell吧</li>
</ul>
<p>Adobe - <a href="http://yun.baidu.com/share/home?uk=1308988221" target="_blank" rel="external">http://yun.baidu.com/share/home?uk=1308988221</a></p>
<ul>
<li>Mod By liuhangtnnd</li>
</ul>
<p>Auto CAD - <a href="http://www.zdfans.com/4808.html" target="_blank" rel="external">http://www.zdfans.com/4808.html</a></p>
<ul>
<li>Mod By 珊瑚の海</li>
</ul>
<p>FreeMind - <a href="http://sourceforge.net/projects/freemind/" target="_blank" rel="external">http://sourceforge.net/projects/freemind/</a></p>
<ul>
<li>免费简单好用的思维脑图工具</li>
<li>XMind，Mindjet MindManager和Axure RP Pro或许更专业</li>
</ul>
<p>JetBrains - <a href="http://www.jetbrains.com/" target="_blank" rel="external">http://www.jetbrains.com/</a></p>
<ul>
<li>IntelliJ IDEA, PhpStorm, PyCharm, ReSharper等都是这家出品的</li>
</ul>
<h3 id="网络穿透专题">网络穿透专题</h3><blockquote>
<p>善用此类工具你可以穿透各类网络干你想干的事情</p>
</blockquote>
<p>CCProxy - <a href="http://www.ccproxy.com/" target="_blank" rel="external">http://www.ccproxy.com/</a></p>
<ul>
<li>最佳共享上网行为管理软件</li>
<li>与Teamviewer VPN协同二级代理穿透网络</li>
</ul>
<p>COW - <a href="https://github.com/cyfdecyf/cow" target="_blank" rel="external">https://github.com/cyfdecyf/cow</a></p>
<ul>
<li>COW 是一个简化穿墙的 HTTP 代理服务器</li>
</ul>
<p>Proxifier - <a href="http://pan.baidu.com/share/link?shareid=3076195103&amp;uk=1157904223" target="_blank" rel="external">http://pan.baidu.com/share/link?shareid=3076195103&amp;uk=1157904223</a></p>
<ul>
<li>让不支持代理的软件也能通，如mstsc</li>
</ul>
<p>Xmanager - <a href="http://www.0daydown.com/?s=Xmanager+" target="_blank" rel="external">http://www.0daydown.com/?s=Xmanager+</a></p>
<ul>
<li>利用Xmanager-Passive可以轻松映射图形化界面，Xshell、SecureCRT，PuTTY等都适用</li>
</ul>
<p>mRemoteNG - <a href="http://www.mremoteng.org/" target="_blank" rel="external">http://www.mremoteng.org/</a></p>
<ul>
<li>非常方便的3389管理工具，MobaXterm也是不错的选择</li>
<li>mRemoteNG is the next generation of mRemote, open source, tabbed, multi-protocol, remote connections manager.</li>
</ul>
<p>SocksCap64 - <a href="http://www.sockscap64.com/" target="_blank" rel="external">http://www.sockscap64.com/</a></p>
<ul>
<li>最好用的网络加速/Socks代理软件</li>
</ul>
<h3 id="文本处理专题">文本处理专题</h3><blockquote>
<p>本专题将重点解决日常办公中遇到的PDF转换，内容检索，ORC识别等专向领域</p>
</blockquote>
<p>Solid PDF Tools - <a href="http://www.ttrar.com/html/Solid-PDF-Tools.html" target="_blank" rel="external">http://www.ttrar.com/html/Solid-PDF-Tools.html</a></p>
<ul>
<li>最佳全能PDF转换、制作与编辑工具</li>
</ul>
<p>FileLocator Pro - <a href="http://www.portablesoft.org/filelocator-pro-portable/" target="_blank" rel="external">http://www.portablesoft.org/filelocator-pro-portable/</a></p>
<ul>
<li>最好的免索引全文搜索工具</li>
<li>文件检索请使用Everything</li>
</ul>
<p>ABBYY FineReader Corporate - <a href="http://www.ttrar.com/html/ABBYY-FineReader-Corporate.html" target="_blank" rel="external">http://www.ttrar.com/html/ABBYY-FineReader-Corporate.html</a></p>
<ul>
<li>世界第一的OCR软件!识别率英文120%!中文99%!这货是真的真的很强</li>
</ul>
<p>Beyond Compare - <a href="http://www.ttrar.com/html/Beyond-Compare.html" target="_blank" rel="external">http://www.ttrar.com/html/Beyond-Compare.html</a></p>
<ul>
<li>不可多得的专业级的文件夹和文件对比工具</li>
</ul>
<h3 id="文件传输专题">文件传输专题</h3><blockquote>
<p>本身这没有什么好介绍的，但是最近智能家庭的概念和各大互联网企业的动作让我看见某些市场前景，我这里简单预测下自己的判断。<br>迅雷的离线下载、云点播和百度云这两样”范云服务“产品将在未来的智能家庭硬件大战中起到关键性的作用，它们与其它产品如无线路由器，电视机的合作和融合将会彻底改变我们的生活方式，目前来看已经在改变。</p>
</blockquote>
<p>常用下载工具没有推荐 - ?</p>
<ul>
<li>无论是迅雷，QQ旋风，还是国外的IDM，EagleGet，最终应该转型为类似百度云这样的平台类应用</li>
</ul>
<p>WinSCP - <a href="http://winscp.net/eng/download.php" target="_blank" rel="external">http://winscp.net/eng/download.php</a></p>
<ul>
<li>个人认为是目前最佳的sftp和ftp传输工具，用户体验已超越FileZilla Client</li>
</ul>
<p>Serv-U - <a href="http://www.ttrar.com/html/Serv-U-FTP-Server-Platinum.html" target="_blank" rel="external">http://www.ttrar.com/html/Serv-U-FTP-Server-Platinum.html</a></p>
<ul>
<li>这也许是世界上最好的FTP服务器之一</li>
<li>如果觉得贵不妨尝试下国产的xlight</li>
</ul>
<p>FileZilla Server - <a href="https://filezilla-project.org/download.php?type=server" target="_blank" rel="external">https://filezilla-project.org/download.php?type=server</a></p>
<ul>
<li>Windows下的免费服务端就用这个吧</li>
<li>Unix一般用vsftpd或者ProFTPD较多，当然你也要考虑处理中文乱码</li>
</ul>
<hr>
<p>题图 - 移动先行，云优先   Mobile-First，Cloud-First</p>
]]></content>
    <summary type="html">
    <![CDATA[长期更新此文以督促自己的懒惰，我要用佳软改变你一生的习惯]]>
    
    </summary>
    
      <category term="软件 | Soft" scheme="http://wsgzao.github.io/categories/%E8%BD%AF%E4%BB%B6-Soft/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[苹果越狱小结]]></title>
    <link href="http://wsgzao.github.io/post/jailbreak/"/>
    <id>http://wsgzao.github.io/post/jailbreak/</id>
    <published>2015-08-03T13:35:54.000Z</published>
    <updated>2015-08-03T14:00:23.082Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/dNgjdLEg.png" alt=""></p>
<h2 id="前言">前言</h2><p>本来一直都没有苹果的产品除了第一代的iPod(没怎么使用最后大学送人了 @李清纯(255270520) ，巧合的是老妈学校发了一台iPad mini Retina正好赶上mini第2代，也算是比较成熟的产品了就顺手撸过来仔细体验一把。本想像Android一样不用root(iOS称为Jailbreak越狱)也能安心使用，但手机习惯了魅族和小米的良好用户体验，iOS如此”严格”的限制对我这样一个喜欢追求自由舒爽简称“懒”的人来说真心不习惯，我们这次越狱的目的是为了让iOS系统用起来更加润滑，随着支付渠道的完善我也希望大家给予背后的开发者一些应有的正版支持。</p>
<blockquote>
<p>我们开始尊重版权并抵制盗版但不能否认自己也是盗版的受益者</p>
</blockquote>
<hr>
<h2 id="更新记录">更新记录</h2><p>2015年08月03日 - 更新iOS 8.4，真的还需要越狱么？<br>2015年02月02日 - 更新iOS 8.1.2<br>2014年07月20日 - 修改【iOS】文字错误，去除178盗版源<br>2014年07月18日 - 更新iOS 7.1.2和部分推荐插件<br>2014年02月06日 - 撰写初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/jailbreak/" target="_blank" rel="external">http://wsgzao.github.io/post/jailbreak/</a></p>
<hr>
<h2 id="基础信息">基础信息</h2><p>设备型号：iPad mini (Retina) Wi-Fi 16 GB (白色)<br>系统版本： <code>8.4</code></p>
<p>序列号：DQTLQWNTFCM8</p>
<p>苹果信息查询：<a href="http://www.25pp.com/xuliehao/" target="_blank" rel="external">http://www.25pp.com/xuliehao/</a></p>
<p>【备注】了解产品的背后信息很重要</p>
<h2 id="升级固件">升级固件</h2><p>选择支持设备越狱的版本，安装iTunes使用<code>Shift</code>+<code>鼠标左键</code>点击恢复</p>
<p><a href="http://jailbreak.25pp.com/gujian/" target="_blank" rel="external">http://jailbreak.25pp.com/gujian/</a></p>
<h2 id="Jailbreak-越狱">Jailbreak.越狱</h2><p>参照图文教程一步一步执行即可，So Easy</p>
<p><a href="http://jailbreak.25pp.com/" target="_blank" rel="external">http://jailbreak.25pp.com/</a></p>
<blockquote>
<p>唯一提醒1点，无论升级还是越狱，备份数据都是必须哒</p>
</blockquote>
<h2 id="越狱后插件推荐">越狱后插件推荐</h2><blockquote>
<p>添加Cydia软件源</p>
</blockquote>
<p><code>-&gt;打开Cydia-&gt;软件源-&gt;右上角编辑-&gt;左上角添加</code></p>
<pre><code><span class="string">http:</span><span class="comment">//apt.25pp.com</span>
</code></pre><blockquote>
<p>安装插件</p>
</blockquote>
<p><code>-&gt;打开Cydia-&gt;右下角搜索</code></p>
<p>【捆绑】PP助手</p>
<p>【必装】Apple File Conduit”2”</p>
<p>【推荐】百度输入法(iPad)</p>
<p>【推荐】SwitchSpring，任务切换时可以一键关闭所有应用</p>
<p>【推荐】Shadowsocks，简单的iOS翻墙方式</p>
]]></content>
    <summary type="html">
    <![CDATA[只为更加自由的使用iOS]]>
    
    </summary>
    
      <category term="生活 | Life" scheme="http://wsgzao.github.io/categories/%E7%94%9F%E6%B4%BB-Life/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[iptables配置实践]]></title>
    <link href="http://wsgzao.github.io/post/iptables/"/>
    <id>http://wsgzao.github.io/post/iptables/</id>
    <published>2015-07-24T07:52:17.000Z</published>
    <updated>2015-07-24T09:21:57.000Z</updated>
    <content type="html"><![CDATA[<p><img src="//i.v2ex.co/4WFXrnn2.png" alt=""></p>
<h2 id="前言">前言</h2><p>在大企业中防火墙角色主要交给硬件来支持，效果自然没话说只是需要增加一点点成本，但对于大多数个人或者互联网公司来说选择系统自带的<code>iptables</code>或者第三方云防火墙似乎是更加合适的选择，通过一些合理的优化和灵活的配置，我们也可以很轻松实现硬件防火墙的部分功能，够用就好。</p>
<blockquote>
<p>建立防火墙白名单机制很重要   </p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年07月24日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/iptables/" target="_blank" rel="external">http://wsgzao.github.io/post/iptables/</a></p>
<p>扩展阅读</p>
<p>防火墙与 NAT 服务器 - <a href="http://vbird.dic.ksu.edu.tw/linux_server/0250simple_firewall_3.php" target="_blank" rel="external">http://vbird.dic.ksu.edu.tw/linux_server/0250simple_firewall_3.php</a><br>Linux 防火墙和 iptables - <a href="http://liaoph.com/iptables/" target="_blank" rel="external">http://liaoph.com/iptables/</a></p>
<hr>
<h2 id="基础知识">基础知识</h2><blockquote>
<p>原理部分请参考扩展阅读</p>
</blockquote>
<h3 id="关闭iptables">关闭iptables</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/iptables stop</span><br><span class="line">chkconfig iptables off</span><br></pre></td></tr></table></figure>
<h3 id="基础语法">基础语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#规则的观察与清除</span></span><br><span class="line"></span><br><span class="line">     iptables [-t tables] [-L] [-nv]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-t ：后面接 table ，例如 nat 或 filter ，若省略此项目，则使用默认的 filter</span><br><span class="line">-L ：列出目前的 table 的规则</span><br><span class="line">-n ：不进行 IP 与 HOSTNAME 的反查，显示讯息的速度会快很多！</span><br><span class="line">-v ：列出更多的信息，包括通过该规则的封包总位数、相关的网络接口等</span><br><span class="line"></span><br><span class="line">     iptables [-t tables] [-FXZ]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-F ：清除所有的已订定的规则；</span><br><span class="line">-X ：杀掉所有使用者 <span class="string">"自定义"</span> 的 chain (应该说的是 tables ）啰；</span><br><span class="line">-Z ：将所有的 chain 的计数与流量统计都归零</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#封包的基础比对：IP, 网域及接口装置</span></span><br><span class="line"></span><br><span class="line">    iptables [-AI 链名] [-io 网络接口] [-p 协议] [<span class="operator">-s</span> 来源IP/网域] [<span class="operator">-d</span> 目标IP/网域] -j [ACCEPT|DROP|REJECT|LOG]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-AI 链名：针对某的链进行规则的 <span class="string">"插入"</span> 或 <span class="string">"累加"</span></span><br><span class="line">    -A ：新增加一条规则，该规则增加在原本规则的最后面。例如原本已经有四条规则，</span><br><span class="line">         使用 -A 就可以加上第五条规则！</span><br><span class="line">    -I ：插入一条规则。如果没有指定此规则的顺序，默认是插入变成第一条规则。</span><br><span class="line">         例如原本有四条规则，使用 -I 则该规则变成第一条，而原本四条变成 <span class="number">2</span>~<span class="number">5</span> 号</span><br><span class="line">    链 ：有 INPUT, OUTPUT, FORWARD 等，此链名称又与 -io 有关，请看底下。</span><br><span class="line"></span><br><span class="line">-io 网络接口：设定封包进出的接口规范</span><br><span class="line">    -i ：封包所进入的那个网络接口，例如 eth0, lo 等接口。需与 INPUT 链配合；</span><br><span class="line">    -o ：封包所传出的那个网络接口，需与 OUTPUT 链配合；</span><br><span class="line"></span><br><span class="line">-p 协定：设定此规则适用于哪种封包格式</span><br><span class="line">   主要的封包格式有： tcp, udp, icmp 及 all 。</span><br><span class="line"></span><br><span class="line"><span class="operator">-s</span> 来源 IP/网域：设定此规则之封包的来源项目，可指定单纯的 IP 或包括网域，例如：</span><br><span class="line">   IP  ：<span class="number">192.168</span>.<span class="number">0.100</span></span><br><span class="line">   网域：<span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">24</span>, <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">255.255</span>.<span class="number">255.0</span> 均可。</span><br><span class="line">   若规范为『不许』时，则加上 ! 即可，例如：</span><br><span class="line">   <span class="operator">-s</span> ! <span class="number">192.168</span>.<span class="number">100.0</span>/<span class="number">24</span> 表示不许 <span class="number">192.168</span>.<span class="number">100.0</span>/<span class="number">24</span> 之封包来源；</span><br><span class="line"></span><br><span class="line"><span class="operator">-d</span> 目标 IP/网域：同 <span class="operator">-s</span> ，只不过这里指的是目标的 IP 或网域。</span><br><span class="line"></span><br><span class="line">-j ：后面接动作，主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT)及记录(LOG)</span><br><span class="line"></span><br><span class="line"><span class="comment">#TCP, UDP 的规则比对：针对端口设定</span></span><br><span class="line"></span><br><span class="line">    iptables [-AI 链] [-io 网络接口] [-p tcp,udp] [<span class="operator">-s</span> 来源IP/网域] [--sport 埠口范围] [<span class="operator">-d</span> 目标IP/网域] [--dport 端口范围] -j [ACCEPT|DROP|REJECT]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">--sport 埠口范围：限制来源的端口号码，端口号码可以是连续的，例如 <span class="number">1024</span>:<span class="number">65535</span></span><br><span class="line">--dport 埠口范围：限制目标的端口号码。</span><br><span class="line"></span><br><span class="line"><span class="comment">#iptables 外挂模块：mac 与 state</span></span><br><span class="line"></span><br><span class="line">    iptables -A INPUT [-m state] [--state 状态]</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">-m ：一些 iptables 的外挂模块，主要常见的有：</span><br><span class="line">     state ：状态模块</span><br><span class="line">     mac   ：网络卡硬件地址 (hardware address)</span><br><span class="line">--state ：一些封包的状态，主要有：</span><br><span class="line">     INVALID    ：无效的封包，例如数据破损的封包状态</span><br><span class="line">     ESTABLISHED：已经联机成功的联机状态；</span><br><span class="line">     NEW        ：想要新建立联机的封包状态；</span><br><span class="line">     RELATED    ：这个最常用！表示这个封包是与我们主机发送出去的封包有关</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#ICMP 封包规则的比对：针对是否响应 ping 来设计</span></span><br><span class="line"></span><br><span class="line">    iptables -A INPUT [-p icmp] [--icmp-type 类型] -j ACCEPT</span><br><span class="line"></span><br><span class="line">选项与参数：</span><br><span class="line">--icmp-type ：后面必须要接 ICMP 的封包类型，也可以使用代号，</span><br><span class="line">              例如 <span class="number">8</span>  代表 <span class="built_in">echo</span> request 的意思。</span><br></pre></td></tr></table></figure>
<h2 id="配置iptables白名单机制">配置iptables白名单机制</h2><blockquote>
<p>配置iptables白名单是相对简单有效的管理手段</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#清除所有规则(慎用)</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看iptable和行号</span></span><br><span class="line">iptables -nL --line-number</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存当前防火墙配置</span></span><br><span class="line">service iptables save</span><br><span class="line"></span><br><span class="line"><span class="comment">#手动编辑防火墙策略</span></span><br><span class="line">vi /etc/sysconfig/iptables</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generated by iptables-save v1.4.7 on Fri Jul 24 09:42:09 2015</span></span><br><span class="line">*filter</span><br><span class="line">:INPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line">:FORWARD ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line">:OUTPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</span><br><span class="line"><span class="comment">#开放本地和Ping</span></span><br><span class="line">-A INPUT -i lo -j ACCEPT  </span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="line">-A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="comment">#配置内网白名单</span></span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">8</span> -j ACCEPT</span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">172.16</span>.<span class="number">0.0</span>/<span class="number">12</span> -j ACCEPT</span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">16</span> -j ACCEPT</span><br><span class="line"><span class="comment">#配置外网白名单</span></span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">180.168</span>.<span class="number">36.198</span> -j ACCEPT </span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">180.168</span>.<span class="number">34.218</span> -j ACCEPT </span><br><span class="line">-A INPUT <span class="operator">-s</span> <span class="number">222.73</span>.<span class="number">202.251</span> -j ACCEPT </span><br><span class="line"><span class="comment">#控制端口</span></span><br><span class="line">-A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT </span><br><span class="line">-A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line"><span class="comment">#拒绝其它</span></span><br><span class="line">-A INPUT -j DROP </span><br><span class="line">-A FORWARD -j DROP </span><br><span class="line"><span class="comment">#开放出口</span></span><br><span class="line">-A OUTPUT -j ACCEPT </span><br><span class="line">COMMIT</span><br><span class="line"><span class="comment"># Completed on Fri Jul 24 09:40:16 2015 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启生效</span></span><br><span class="line">service iptables restart</span><br><span class="line"></span><br><span class="line"><span class="comment">#复查结果</span></span><br><span class="line"></span><br><span class="line">iptables -nL --line-number</span><br><span class="line"></span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"><span class="number">1</span>    ACCEPT     all  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">2</span>    ACCEPT     all  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           state RELATED,ESTABLISHED </span><br><span class="line"><span class="number">3</span>    ACCEPT     icmp --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">4</span>    ACCEPT     all  --  <span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">8</span>           <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">5</span>    ACCEPT     all  --  <span class="number">172.16</span>.<span class="number">0.0</span>/<span class="number">12</span>        <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">6</span>    ACCEPT     all  --  <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">16</span>       <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">7</span>    ACCEPT     all  --  <span class="number">180.168</span>.<span class="number">36.198</span>       <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">8</span>    ACCEPT     all  --  <span class="number">180.168</span>.<span class="number">34.218</span>       <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">9</span>    ACCEPT     all  --  <span class="number">222.73</span>.<span class="number">202.251</span>       <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"><span class="number">10</span>   ACCEPT     tcp  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           tcp dpt:<span class="number">80</span> </span><br><span class="line"><span class="number">11</span>   ACCEPT     tcp  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           tcp dpt:<span class="number">22</span> </span><br><span class="line"><span class="number">12</span>   DROP       all  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"><span class="number">1</span>    DROP       all  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>           </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">num  target     prot opt <span class="built_in">source</span>               destination         </span><br><span class="line"><span class="number">1</span>    ACCEPT     all  --  <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span>            <span class="number">0.0</span>.<span class="number">0.0</span>/<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="设置crontab脚本">设置crontab脚本</h2><blockquote>
<p>便于运维集中化管理扩展</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">vi /root/start_iptables.sh</span><br><span class="line"></span><br><span class="line"><span class="shebang">#!/bin/bash</span></span><br><span class="line"><span class="comment">#0 0 * * * /root/start_iptables.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#清除配置</span></span><br><span class="line">/sbin/iptables -P INPUT ACCEPT</span><br><span class="line">/sbin/iptables -F</span><br><span class="line">/sbin/iptables -X</span><br><span class="line"><span class="comment">#开放本地和Ping</span></span><br><span class="line">/sbin/iptables -A INPUT -i lo -j ACCEPT  </span><br><span class="line">/sbin/iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -p icmp -j ACCEPT</span><br><span class="line"><span class="comment">#配置内网白名单</span></span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">10.0</span>.<span class="number">0.0</span>/<span class="number">8</span> -j ACCEPT</span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">172.16</span>.<span class="number">0.0</span>/<span class="number">12</span> -j ACCEPT</span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">192.168</span>.<span class="number">0.0</span>/<span class="number">16</span> -j ACCEPT</span><br><span class="line"><span class="comment">#配置外网白名单</span></span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">180.168</span>.<span class="number">36.198</span> -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">180.168</span>.<span class="number">34.218</span> -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT <span class="operator">-s</span> <span class="number">222.73</span>.<span class="number">202.251</span> -j ACCEPT </span><br><span class="line"><span class="comment">#控制端口</span></span><br><span class="line">/sbin/iptables -A INPUT -p tcp --dport <span class="number">80</span> -j ACCEPT </span><br><span class="line">/sbin/iptables -A INPUT -p tcp --dport <span class="number">22</span> -j ACCEPT</span><br><span class="line"><span class="comment">#拒绝其它</span></span><br><span class="line">/sbin/iptables -A INPUT -j DROP </span><br><span class="line">/sbin/iptables -A FORWARD -j DROP </span><br><span class="line"><span class="comment">#开放出口</span></span><br><span class="line">/sbin/iptables -A OUTPUT -j ACCEPT </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod <span class="number">755</span> /root/start_iptables.sh</span><br><span class="line">crontab <span class="operator">-e</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> * * * /root/start_iptables.sh</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[建立防火墙白名单机制很重要]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Cygwin在Windows上体验Linux的快感]]></title>
    <link href="http://wsgzao.github.io/post/cygwin/"/>
    <id>http://wsgzao.github.io/post/cygwin/</id>
    <published>2015-07-21T09:22:07.000Z</published>
    <updated>2015-07-24T09:11:19.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/Pmsh13Ts.png" alt=""></p>
<h2 id="前言">前言</h2><p>记得大学的时候就曾经使用过Cygwin，可惜当时没有发现她的美，我相信现在大多数朋友可能会更加倾向于使用<code>Git</code>或者干脆直接使用虚拟机以及原生Unix。不过对于刚进入Linux的世界新人来说，使用Cygwin可以让你在Windows下面练习Linux的Bash，以及常用工具，而不需要安装Linux，也不用担心Windows被破坏，给每个人多一种选择也蛮好的，最后再一次感谢163为开源做出的努力。</p>
<blockquote>
<p>Get that Linux feeling - on Windows     </p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年07月24日 - 增加在Cygwin里安装使用dig实践<br>2015年07月21日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/cygwin/" target="_blank" rel="external">http://wsgzao.github.io/post/cygwin/</a></p>
<p>扩展阅读</p>
<p>Cygwin - <a href="http://www.cygwin.com/" target="_blank" rel="external">http://www.cygwin.com/</a><br>163源 - <a href="http://mirrors.163.com/cygwin/" target="_blank" rel="external">http://mirrors.163.com/cygwin/</a></p>
<hr>
<blockquote>
<p>按照个人习惯一步步勾选即可，软件源我选择163，如果网络不给力可以下载我提供的完整离线包</p>
</blockquote>
<h2 id="在线安装">在线安装</h2><ol>
<li>点击下一步</li>
<li>选择<code>Install from Internet</code></li>
<li>自定义安装路径</li>
<li>自定义Local Package Directory</li>
<li>自定义网络连接下载方式（可以使用代理加速）</li>
<li>选择<code>http://mirrors.163.com</code>作为下载源</li>
<li>选择自己所需的Packages</li>
</ol>
<h2 id="离线安装">离线安装</h2><ol>
<li>点击下一步</li>
<li>选择<code>Install from Local Directory</code></li>
<li>自定义安装路径</li>
<li>定义Local Package Directory为<code>mirrors.163.com</code></li>
<li>选择自己所需的Packages</li>
</ol>
<h2 id="软件库">软件库</h2><blockquote>
<p>你同样可以在Cygwin上编译安装和执行Unix下的程序</p>
</blockquote>
<p>在<code>Select Packages</code>界面搜索并勾选所需的包或者直接全部install <code>Devel</code>，举个<code>GoAccess</code>栗子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">Administrator@PC-<span class="number">20150629</span>NSFI ~/goaccess-<span class="number">0.9</span>.<span class="number">2</span></span><br><span class="line">$ ./configure --enable-utf8</span><br><span class="line">checking <span class="keyword">for</span> a BSD-compatible install... /usr/bin/install -c</span><br><span class="line">checking whether build environment is sane... yes</span><br><span class="line">checking <span class="keyword">for</span> a thread-safe mkdir -p... /usr/bin/mkdir -p</span><br><span class="line">checking <span class="keyword">for</span> gawk... gawk</span><br><span class="line">checking whether make sets $(MAKE)... yes</span><br><span class="line">checking <span class="keyword">for</span> gcc... gcc</span><br><span class="line">checking whether the C compiler works... yes</span><br><span class="line">checking <span class="keyword">for</span> C compiler default output file name... a.exe</span><br><span class="line">checking <span class="keyword">for</span> suffix of executables... .exe</span><br><span class="line">checking whether we are cross compiling... no</span><br><span class="line">checking <span class="keyword">for</span> suffix of object files... o</span><br><span class="line">checking whether we are using the GNU C compiler... yes</span><br><span class="line">checking whether gcc accepts -g... yes</span><br><span class="line">checking <span class="keyword">for</span> gcc option to accept ISO C89... none needed</span><br><span class="line">checking <span class="keyword">for</span> style of include used by make... GNU</span><br><span class="line">checking dependency style of gcc... gcc3</span><br><span class="line">checking whether gcc and cc understand -c and -o together... yes</span><br><span class="line">checking <span class="keyword">for</span> pthread_create <span class="keyword">in</span> -lpthread... yes</span><br><span class="line">checking build system type... x86_64-unknown-cygwin</span><br><span class="line">checking host system type... x86_64-unknown-cygwin</span><br><span class="line">checking whether to build with rdynamic <span class="keyword">for</span> GNU ld... no</span><br><span class="line">checking <span class="keyword">for</span> mvaddwstr <span class="keyword">in</span> -lncursesw... yes</span><br><span class="line">checking <span class="keyword">for</span> ncursesw/ncurses.h... yes</span><br><span class="line">checking <span class="keyword">for</span> ncurses.h... yes</span><br><span class="line">checking <span class="keyword">for</span> pkg-config... /usr/bin/pkg-config</span><br><span class="line">checking pkg-config is at least version <span class="number">0.9</span>.<span class="number">0</span>... yes</span><br><span class="line">checking <span class="keyword">for</span> pkg-config... /usr/bin/pkg-config</span><br><span class="line">checking <span class="keyword">for</span> GLIB2... yes</span><br><span class="line">checking <span class="keyword">for</span> g_list_append <span class="keyword">in</span> -lglib-<span class="number">2.0</span>... yes</span><br><span class="line">checking <span class="keyword">for</span> socket <span class="keyword">in</span> -lsocket... no</span><br><span class="line">checking <span class="keyword">for</span> gethostbyname <span class="keyword">in</span> -lnsl... no</span><br><span class="line">checking how to run the C preprocessor... gcc -E</span><br><span class="line">checking <span class="keyword">for</span> grep that handles long lines and -e... /usr/bin/grep</span><br><span class="line">checking <span class="keyword">for</span> egrep... /usr/bin/grep -E</span><br><span class="line">checking <span class="keyword">for</span> ANSI C header files... yes</span><br><span class="line">checking <span class="keyword">for</span> sys/types.h... yes</span><br><span class="line">checking <span class="keyword">for</span> sys/stat.h... yes</span><br><span class="line">checking <span class="keyword">for</span> stdlib.h... yes</span><br><span class="line">checking <span class="keyword">for</span> string.h... yes</span><br><span class="line">checking <span class="keyword">for</span> memory.h... yes</span><br><span class="line">checking <span class="keyword">for</span> strings.h... yes</span><br><span class="line">checking <span class="keyword">for</span> inttypes.h... yes</span><br><span class="line">checking <span class="keyword">for</span> stdint.h... yes</span><br><span class="line">checking <span class="keyword">for</span> unistd.h... yes</span><br><span class="line">checking netinet/in.h usability... yes</span><br><span class="line">checking netinet/in.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> netinet/in.h... yes</span><br><span class="line">checking sys/socket.h usability... yes</span><br><span class="line">checking sys/socket.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> sys/socket.h... yes</span><br><span class="line">checking arpa/inet.h usability... yes</span><br><span class="line">checking arpa/inet.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> arpa/inet.h... yes</span><br><span class="line">checking locale.h usability... yes</span><br><span class="line">checking locale.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> locale.h... yes</span><br><span class="line">checking netdb.h usability... yes</span><br><span class="line">checking netdb.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> netdb.h... yes</span><br><span class="line">checking <span class="keyword">for</span> stdint.h... (cached) yes</span><br><span class="line">checking <span class="keyword">for</span> stdlib.h... (cached) yes</span><br><span class="line">checking <span class="keyword">for</span> string.h... (cached) yes</span><br><span class="line">checking <span class="keyword">for</span> unistd.h... (cached) yes</span><br><span class="line">checking stddef.h usability... yes</span><br><span class="line">checking stddef.h presence... yes</span><br><span class="line">checking <span class="keyword">for</span> stddef.h... yes</span><br><span class="line">checking <span class="keyword">for</span> an ANSI C-conforming const... yes</span><br><span class="line">checking <span class="keyword">for</span> off_t... yes</span><br><span class="line">checking <span class="keyword">for</span> size_t... yes</span><br><span class="line">checking whether struct tm is <span class="keyword">in</span> sys/time.h or time.h... time.h</span><br><span class="line">checking <span class="keyword">for</span> ptrdiff_t... yes</span><br><span class="line">checking <span class="keyword">for</span> working strtod... yes</span><br><span class="line">checking <span class="keyword">for</span> _LARGEFILE_SOURCE value needed <span class="keyword">for</span> large files... no</span><br><span class="line">checking <span class="keyword">for</span> working memcmp... yes</span><br><span class="line">checking whether lstat correctly handles trailing slash... yes</span><br><span class="line">checking whether <span class="built_in">stat</span> accepts an empty string... no</span><br><span class="line">checking <span class="keyword">for</span> strftime... yes</span><br><span class="line">checking <span class="keyword">for</span> regcomp... yes</span><br><span class="line">checking <span class="keyword">for</span> strtoull... yes</span><br><span class="line">checking <span class="keyword">for</span> memmove... yes</span><br><span class="line">checking <span class="keyword">for</span> floor... yes</span><br><span class="line">checking <span class="keyword">for</span> gethostbyaddr... yes</span><br><span class="line">checking <span class="keyword">for</span> gethostbyname... yes</span><br><span class="line">checking <span class="keyword">for</span> memset... yes</span><br><span class="line">checking <span class="keyword">for</span> setlocale... yes</span><br><span class="line">checking <span class="keyword">for</span> strchr... yes</span><br><span class="line">checking <span class="keyword">for</span> strdup... yes</span><br><span class="line">checking <span class="keyword">for</span> strerror... yes</span><br><span class="line">checking <span class="keyword">for</span> strrchr... yes</span><br><span class="line">checking <span class="keyword">for</span> strstr... yes</span><br><span class="line">checking <span class="keyword">for</span> strtol... yes</span><br><span class="line">checking <span class="keyword">for</span> realpath... yes</span><br><span class="line">checking <span class="keyword">for</span> malloc... yes</span><br><span class="line">checking <span class="keyword">for</span> realloc... yes</span><br><span class="line">configure: creating ./config.status</span><br><span class="line">config.status: creating Makefile</span><br><span class="line">config.status: creating src/config.h</span><br><span class="line">config.status: executing depfiles commands</span><br><span class="line"></span><br><span class="line">Your build configuration:</span><br><span class="line"></span><br><span class="line">  CFLAGS = -pthread</span><br><span class="line">  storage: On-memory Hash Database (GLib)</span><br><span class="line">  prefix: /usr/<span class="built_in">local</span></span><br><span class="line">  package: goaccess</span><br><span class="line">  version: <span class="number">0.9</span>.<span class="number">2</span></span><br><span class="line">  bugs: goaccess@prosoftcorp.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">$ goaccess -V</span><br><span class="line">GoAccess - <span class="number">0.9</span>.<span class="number">2</span>.</span><br><span class="line">For more details visit: http://goaccess.io</span><br><span class="line">Copyright (C) <span class="number">2009</span>-<span class="number">2015</span> GNU GPL<span class="string">'d, by Gerardo Orellana</span></span><br></pre></td></tr></table></figure>
<h3 id="在Cygwin里安装使用dig">在Cygwin里安装使用dig</h3><p>1.启动Cygwin选择下载源</p>
<blockquote>
<p>推荐国内源 - <a href="http://mirrors.163.com/cygwin/" target="_blank" rel="external">http://mirrors.163.com/cygwin/</a></p>
</blockquote>
<p>2.Install the <code>Bind</code> package</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ dig wsgzao.github.io</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG <span class="number">9.10</span>.<span class="number">2</span>-P2 &lt;&lt;&gt;&gt; wsgzao.github.io</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: <span class="number">21080</span></span><br><span class="line">;; flags: qr rd ra; QUERY: <span class="number">1</span>, ANSWER: <span class="number">2</span>, AUTHORITY: <span class="number">0</span>, ADDITIONAL: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: <span class="number">0</span>, flags:; udp: <span class="number">4096</span></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;wsgzao.github.io.              IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">wsgzao.github.io.       <span class="number">30</span>      IN      CNAME   github.map.fastly.net.</span><br><span class="line">github.map.fastly.net.  <span class="number">30</span>      IN      A       <span class="number">103.245</span>.<span class="number">222.133</span></span><br><span class="line"></span><br><span class="line">;; Query time: <span class="number">10</span> msec</span><br><span class="line">;; SERVER: <span class="number">202.96</span>.<span class="number">209.133</span><span class="comment">#53(202.96.209.133)</span></span><br><span class="line">;; WHEN: 周五 七月 <span class="number">24</span> <span class="number">15</span>:<span class="number">28</span>:<span class="number">05</span> CST <span class="number">2015</span></span><br><span class="line">;; MSG SIZE  rcvd: <span class="number">96</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[Get that Linux feeling - on Windows]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Windows上使用Vagrant打造Laravel Homestead可协同跨平台开发环境]]></title>
    <link href="http://wsgzao.github.io/post/vagrant/"/>
    <id>http://wsgzao.github.io/post/vagrant/</id>
    <published>2015-07-18T10:29:28.000Z</published>
    <updated>2015-07-18T11:54:56.522Z</updated>
    <content type="html"><![CDATA[<p><img src="http://i.v2ex.co/vyf30F6d.png" alt=""></p>
<h2 id="前言">前言</h2><p>大家对<code>VMware</code>或者<code>VirtualBox</code>一定不会陌生，虚拟化的好处自然深入人心，而现在我们可以通过<code>Vagrant</code>搭建一套类似<code>Laravel Homestead</code>完整开发环境，这样极大的减少了架设开发环境的时间，同时还支持在<code>Windows/Mac/Linux</code>不同平台上分享定制包，统一团队之间的开发环境提高工作效率，而<code>Docker</code>的出现也让未来更值得期待。</p>
<blockquote>
<p>用Vagrant为自己打造一个奇妙的跨平台开发环境</p>
</blockquote>
<hr>
<h2 id="更新历史">更新历史</h2><p>2015年07月18日 - 初稿</p>
<p>阅读原文 - <a href="http://wsgzao.github.io/post/vagrant/" target="_blank" rel="external">http://wsgzao.github.io/post/vagrant/</a></p>
<p>扩展阅读</p>
<p>Vagrant - <a href="https://www.vagrantup.com/" target="_blank" rel="external">https://www.vagrantup.com/</a><br>Laravel Homestead - <a href="http://laravel.com/docs/5.1/homestead" target="_blank" rel="external">http://laravel.com/docs/5.1/homestead</a><br>在windows下进行linux开发：利用Vagrant+virtualbox - <a href="http://blog.star7th.com/2015/06/1538.html" target="_blank" rel="external">http://blog.star7th.com/2015/06/1538.html</a><br>在 Mac/win7 下上使用 Vagrant 打造本地开发环境 - <a href="http://segmentfault.com/a/1190000002645737" target="_blank" rel="external">http://segmentfault.com/a/1190000002645737</a></p>
<hr>
<h2 id="环境准备">环境准备</h2><ol>
<li>Git（非必需）</li>
<li>PHP（非必需）</li>
<li>Laravel（非必需）</li>
<li>Composer（非必需）</li>
<li>Vagrant</li>
<li>VirtualBox</li>
</ol>
<p>如果大家有需要离线安装欢迎直接留言回复哈</p>
<h2 id="安装git">安装git</h2><p>1.下载GitHub for Windows</p>
<p><a href="https://windows.github.com/" target="_blank" rel="external">https://windows.github.com/</a></p>
<h2 id="安装php">安装php</h2><blockquote>
<p>建议大家尽量安装当前最新版本的 PHP </p>
</blockquote>
<p>1.下载PHP</p>
<p><a href="http://windows.php.net/download/" target="_blank" rel="external">http://windows.php.net/download/</a></p>
<p>2.解压目录</p>
<p>我的路径<code>D:\php</code></p>
<p>3.添加环境变量</p>
<p>右键计算机-&gt;高级系统设置-&gt;环境变量-&gt;系统变量-&gt;PATH</p>
<p><code>C:\ProgramData\Oracle\Java\javapath;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;C:\nodejs\;D:\php;C:\ProgramData\ComposerSetup\bin</code></p>
<p>4.设置php.ini</p>
<p>进入 PHP 安装目录（例如 <code>D:\php</code>）。找到 <code>php.ini-development</code> 文件并复制一份到当前目录，重命名为 <code>php.ini</code>，修改以下配置<br>去掉<code>extension=php_mbstring.dll</code> 前面的分号（888 行左右）<br>去掉<code>extension=php_openssl.dll</code>前面的分号（893 行左右）<br>去掉<code>extension_dir = &quot;ext&quot;</code>前面的分号（736 行左右）</p>
<p>5.使环境变量生效</p>
<p>重启<code>explorer.exe</code></p>
<h2 id="安装Laravel">安装Laravel</h2><p>1.下载Laravel</p>
<p><a href="http://www.golaravel.com/download/" target="_blank" rel="external">http://www.golaravel.com/download/</a></p>
<p>2.解压目录</p>
<p>我的路径<code>D:\laravel-v5.1.4</code></p>
<p>3.启动Laravel</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">d:</span><br><span class="line"><span class="title">cd</span> <span class="title">laravel</span>-<span class="title">v5</span>.1.4</span><br><span class="line"><span class="title">D</span>:\<span class="title">laravel</span>-<span class="title">v5</span>.1.4&gt;<span class="title">php</span> <span class="title">artisan</span> <span class="title">serve</span></span><br><span class="line"><span class="title">Laravel</span> <span class="title">development</span> <span class="title">server</span> <span class="title">started</span> <span class="title">on</span> <span class="title">http</span>://<span class="title">localhost</span>:8000/</span></span><br></pre></td></tr></table></figure>
<p>在浏览器中访问<a href="http://localhost:8000/" target="_blank" rel="external">http://localhost:8000/</a></p>
<p><code>artisan</code> 的 <code>serve</code> 命令还支持两个参数：</p>
<p><code>host</code> 设置主机地址<br><code>port</code> 设置 web server 监听的端口号<br>例如：<code>php artisan serve --port=8888</code></p>
<h2 id="安装Composer">安装Composer</h2><p>1.下载<code>Composer-Setup.exe</code></p>
<p><a href="https://getcomposer.org/doc/00-intro.md#installation-windows" target="_blank" rel="external">https://getcomposer.org/doc/00-intro.md#installation-windows</a></p>
<p>2.配置Composer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Loading composer repositories with package information</span><br><span class="line">Installing dependencies (including require-dev)</span><br><span class="line">SSL certificate problem, verify that the CA cert is OK. Details: </span><br><span class="line">error:<span class="number">14090086</span>:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed”</span><br></pre></td></tr></table></figure>
<p>如果安装过程提示报错为缺少CA证书，下载<code>cacert.pem</code>到自定义路径<br><a href="http://curl.haxx.se/docs/caextract.html" target="_blank" rel="external">http://curl.haxx.se/docs/caextract.html</a></p>
<p>然后修改php.ini文件（1983行左右）</p>
<p><code>openssl.cafile=D:\php\verify\cacert.pem</code></p>
<p>3.测试Composer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">composer -V</span><br><span class="line"></span><br><span class="line">Composer version <span class="number">1.0</span>-dev (d79427f1a7b15e8f4d46ce8124a4d0c58ba1479c) <span class="number">2015</span>-<span class="number">07</span>-<span class="number">04</span> <span class="number">1</span></span><br><span class="line"><span class="number">1</span>:<span class="number">22</span>:<span class="number">58</span></span><br></pre></td></tr></table></figure>
<h2 id="安装Vagrant">安装Vagrant</h2><p>1.下载Vagrant</p>
<p><a href="https://www.vagrantup.com/downloads.html" target="_blank" rel="external">https://www.vagrantup.com/downloads.html</a></p>
<p>2.离线下载虚拟镜像</p>
<p><a href="https://github.com/tommy-muehle/puppet-vagrant-boxes/releases/download/1.0.0/centos-6.6-x86_64.box" target="_blank" rel="external">https://github.com/tommy-muehle/puppet-vagrant-boxes/releases/download/1.0.0/centos-6.6-x86_64.box</a></p>
<p>上面给出的是centos-6.6镜像下载链接，要下载其他镜像请访问官网<br><a href="http://www.vagrantbox.es/" target="_blank" rel="external">http://www.vagrantbox.es/</a></p>
<h2 id="安装VirtualBox">安装VirtualBox</h2><blockquote>
<p>BIOS里面开启CPU硬件虚拟化支持VT(Virtualization Technology)</p>
</blockquote>
<p>1.下载VirtualBox</p>
<p><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="external">https://www.virtualbox.org/wiki/Downloads</a></p>
<p>2.导入镜像</p>
<p>设置VirtualBox目录并拷贝镜像<code>centos-6.6-x86_64.box</code><br>E:\VirtualBox\centos-6.6-x86_64.box</p>
<p>3.命令初始化Vagrant</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换VirtualBox目录</span></span><br><span class="line">e:</span><br><span class="line"><span class="built_in">cd</span> .\VirtualBox</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入命令初始化</span></span><br><span class="line">E:\VirtualBox&gt; vagrant init centos6.<span class="number">6</span></span><br><span class="line">A `Vagrantfile` has been placed <span class="keyword">in</span> this directory. You are now</span><br><span class="line">ready to `vagrant up` your first virtual environment! Please <span class="built_in">read</span></span><br><span class="line">the comments <span class="keyword">in</span> the Vagrantfile as well as documentation on</span><br><span class="line">`vagrantup.com` <span class="keyword">for</span> more information on using Vagrant.</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行添加命令</span></span><br><span class="line">E:\VirtualBox&gt; vagrant box add centos6.<span class="number">6</span> centos-<span class="number">6.6</span>-x86_64.box</span><br><span class="line">==&gt; box: Adding box <span class="string">'centos6.6'</span> (v0) <span class="keyword">for</span> provider:</span><br><span class="line">    box: Downloading: file://E:/VirtualBox/centos-<span class="number">6.6</span>-x86_64.box</span><br><span class="line">    box: Progress: <span class="number">100</span>% (Rate: <span class="number">670</span>M/s, Estimated time remaining: --:--:--)</span><br><span class="line">==&gt; box: Successfully added box <span class="string">'centos6.6'</span> (v0) <span class="keyword">for</span> <span class="string">'virtualbox'</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查是否导入成功</span></span><br><span class="line">E:\VirtualBox&gt; vagrant box list</span><br><span class="line">centos6.<span class="number">6</span> (virtualbox, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Vagrant配置">Vagrant配置</h2><blockquote>
<p>详细配置文档可以参考官方手册 - <a href="https://docs.vagrantup.com/v2/" target="_blank" rel="external">https://docs.vagrantup.com/v2/</a></p>
</blockquote>
<h3 id="启动Vagrant">启动Vagrant</h3><p>通过Shell进入目录<code>E:\VirtualBox</code>后执行命令</p>
<pre><code><span class="title">vagrant</span> up
</code></pre><blockquote>
<p>顺利启动的完整过程如下所示</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">E:\VirtualBox&gt;vagrant up</span><br><span class="line">Bringing machine <span class="string">'default'</span> up with <span class="string">'virtualbox'</span> provider...</span><br><span class="line">==&gt; default: Importing base box <span class="string">'centos6.6'</span>...</span><br><span class="line">==&gt; default: Matching MAC address <span class="keyword">for</span> NAT networking...</span><br><span class="line">==&gt; default: Setting the name of the VM: VirtualBox_default_1437213832296_68434</span><br><span class="line">==&gt; default: Clearing any previously <span class="built_in">set</span> forwarded ports...</span><br><span class="line">==&gt; default: Clearing any previously <span class="built_in">set</span> network interfaces...</span><br><span class="line">==&gt; default: Preparing network interfaces based on configuration...</span><br><span class="line">    default: Adapter <span class="number">1</span>: nat</span><br><span class="line">==&gt; default: Forwarding ports...</span><br><span class="line">    default: <span class="number">22</span> =&gt; <span class="number">2222</span> (adapter <span class="number">1</span>)</span><br><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting <span class="keyword">for</span> machine to boot. This may take a few minutes...</span><br><span class="line">    default: SSH address: <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2222</span></span><br><span class="line">    default: SSH username: vagrant</span><br><span class="line">    default: SSH auth method: private key</span><br><span class="line">    default: Warning: Connection timeout. Retrying...</span><br><span class="line">    default:</span><br><span class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</span><br><span class="line">    default: this with a newly generated keypair <span class="keyword">for</span> better security.</span><br><span class="line">    default:</span><br><span class="line">    default: Inserting generated public key within guest...</span><br><span class="line">    default: Removing insecure key from the guest <span class="keyword">if</span> it<span class="string">'s present...</span><br><span class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</span><br><span class="line">==&gt; default: Machine booted and ready!</span><br><span class="line">==&gt; default: Checking for guest additions in VM...</span><br><span class="line">    default: The guest additions on this VM do not match the installed version of</span><br><span class="line">    default: VirtualBox! In most cases this is fine, but in rare cases it can</span><br><span class="line">    default: prevent things such as shared folders from working properly. If you see</span><br><span class="line">    default: shared folder errors, please make sure the guest additions within the</span><br><span class="line">    default: virtual machine match the version of VirtualBox you have installed on</span><br><span class="line">    default: your host and reload your VM.</span><br><span class="line">    default:</span><br><span class="line">    default: Guest Additions Version: 4.3.28</span><br><span class="line">    default: VirtualBox Version: 5.0</span><br><span class="line">==&gt; default: Mounting shared folders...</span><br><span class="line">    default: /vagrant =&gt; E:/VirtualBox</span></span><br></pre></td></tr></table></figure>
<p>虚拟机启动之后则可以通过 vagrant ssh 联入虚拟机进行进一步的环境配置，或者软件安装相关的工作，在Windows系统下，并不能直接通过<code>vagrant ssh</code>连到虚拟机，需要使用<code>SecureCRT/Putty/Xshell</code>等第三方工具进行连接。连接地址<code>127.0.0.1</code>，端口<code>2222</code>。登录的帐号<code>root</code>的密码为<code>vagrant</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">E:\VirtualBox&gt; vagrant up</span><br><span class="line">Bringing machine <span class="string">'default'</span> up with <span class="string">'virtualbox'</span> provider...</span><br><span class="line">==&gt; default: Clearing any previously <span class="built_in">set</span> forwarded ports...</span><br><span class="line">==&gt; default: Clearing any previously <span class="built_in">set</span> network interfaces...</span><br><span class="line">==&gt; default: Preparing network interfaces based on configuration...</span><br><span class="line">    default: Adapter <span class="number">1</span>: nat</span><br><span class="line">    default: Adapter <span class="number">2</span>: bridged</span><br><span class="line">==&gt; default: Forwarding ports...</span><br><span class="line">    default: <span class="number">80</span> =&gt; <span class="number">8080</span> (adapter <span class="number">1</span>)</span><br><span class="line">    default: <span class="number">22</span> =&gt; <span class="number">2222</span> (adapter <span class="number">1</span>)</span><br><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting <span class="keyword">for</span> machine to boot. This may take a few minutes...</span><br><span class="line">The guest machine entered an invalid state <span class="keyword">while</span> waiting <span class="keyword">for</span> it</span><br><span class="line">to boot. Valid states are <span class="string">'starting, running'</span>. The machine is <span class="keyword">in</span> the</span><br><span class="line"><span class="string">'poweroff'</span> state. Please verify everything is configured</span><br><span class="line">properly and try again.</span><br><span class="line"></span><br><span class="line">If the provider you<span class="string">'re using has a GUI that comes with it,</span><br><span class="line">it is often helpful to open that and watch the machine, since the</span><br><span class="line">GUI often has more helpful error messages than Vagrant can retrieve.</span><br><span class="line">For example, if you'</span>re using VirtualBox, run `vagrant up` <span class="keyword">while</span> the</span><br><span class="line">VirtualBox GUI is open.</span><br></pre></td></tr></table></figure>
<p>如果有报上述错误，并且运行Virtualbox去安装系统时出错：<code>Failed to open a session for the virtual machine，Unable to load R3 module C:\Program Files\Oracle\VirtualBox/VBoxDD.DLL (VBoxDD): GetLastError=1790 (VERR_UNRESOLVED_ERROR).</code>，需要使用<code>UniversalThemePatcher</code>还原未破解的<code>themeservice.dll   themeui.dll   uxtheme.dll</code>文件</p>
<blockquote>
<p>已经打包好的下载链接 - <a href="http://pan.baidu.com/s/1c0HGj2g" target="_blank" rel="external">http://pan.baidu.com/s/1c0HGj2g</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting <span class="keyword">for</span> machine to boot. This may take a few minutes...</span><br><span class="line">    default: SSH address: <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2222</span></span><br><span class="line">    default: SSH username: vagrant</span><br><span class="line">    default: SSH auth method: private key</span><br><span class="line">    default: Warning: Connection timeout. Retrying...</span><br><span class="line">    default: Warning: Connection timeout. Retrying...</span><br><span class="line">    default: Warning: Connection timeout. Retrying...</span><br></pre></td></tr></table></figure>
<p>如果报<code>default: Warning: Connection timeout. Retrying...</code>，建议打编辑<code>Vagrantfile</code>打开VirtualBox图形化界面<code>vb.gui = true</code>进一步分析错误代码和原因。</p>
<h3 id="导出box">导出box</h3><p>通过Shell进入目录<code>E:\VirtualBox</code>后执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vagrant package</span><br><span class="line"></span><br><span class="line">vagrant package --output NAME --vagrantfile FILE</span><br><span class="line"></span><br><span class="line"><span class="comment">#可选参数：</span></span><br><span class="line">--output NAME ： （可选）设置通过NAME来指定输出的文件名</span><br><span class="line">--vagrantfile FILE：（可选）可以将Vagrantfile直接封进box中</span><br></pre></td></tr></table></figure>
<p>完成后会在当前目录就会生成package.box，可以在家或者团队成员共享开发环境保持一致性</p>
<h3 id="其它命令">其它命令</h3><p>vagrant up （启动虚拟机）<br>vagrant halt （关闭虚拟机——对应就是关机）<br>vagrant suspend （暂停虚拟机——只是暂停，虚拟机内存等信息将以状态文件的方式保存在本地，可以执行恢复操作后继续使用）<br>vagrant resume （恢复虚拟机 —— 与前面的暂停相对应）<br>vagrant box remove centos6.6 （移除box，其中centos6.6是box名）<br>vagrant destroy （删除虚拟机，删除后在当前虚拟机所做进行的除开Vagrantfile中的配置都不会保留）</p>
<h2 id="Laravel_Homestead">Laravel Homestead</h2><blockquote>
<p>细节部分可参考官方文档 - <a href="http://laravel.com/docs/5.1/homestead" target="_blank" rel="external">http://laravel.com/docs/5.1/homestead</a></p>
</blockquote>
<p>1.下载安装包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vagrant box add laravel/homestead</span><br><span class="line"></span><br><span class="line">E:\Homestead&gt;vagrant box add laravel/homestead</span><br><span class="line">==&gt; box: Loading metadata <span class="keyword">for</span> box <span class="string">'laravel/homestead'</span></span><br><span class="line">    box: URL: https://atlas.hashicorp.com/laravel/homestead</span><br><span class="line">This box can work with multiple providers! The providers that it</span><br><span class="line">can work with are listed below. Please review the list and choose</span><br><span class="line">the provider you will be working with.</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) virtualbox</span><br><span class="line"><span class="number">2</span>) vmware_desktop</span><br><span class="line"></span><br><span class="line">Enter your choice: <span class="number">1</span></span><br><span class="line">==&gt; box: Adding box <span class="string">'laravel/homestead'</span> (v0.<span class="number">2.7</span>) <span class="keyword">for</span> provider: virtualbox</span><br><span class="line">    box: Downloading: https://vagrantcloud.com/laravel/boxes/homestead/versions/<span class="number">0.2</span>.<span class="number">7</span>/providers/virtualbox.box</span><br><span class="line">    box: Progress: <span class="number">0</span>% (Rate: <span class="number">9</span>d/s, Estimated time remaining: <span class="number">0</span>:<span class="number">05</span>:<span class="number">30</span>)<span class="number">11</span>))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于国内网络环境问题建议离线下载后手动导入</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#输入命令初始化</span></span><br><span class="line">E:\Homestead&gt;vagrant init laravel</span><br><span class="line">A `Vagrantfile` has been placed <span class="keyword">in</span> this directory. You are now</span><br><span class="line">ready to `vagrant up` your first virtual environment! Please <span class="built_in">read</span></span><br><span class="line">the comments <span class="keyword">in</span> the Vagrantfile as well as documentation on</span><br><span class="line">`vagrantup.com` <span class="keyword">for</span> more information on using Vagrant.</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行添加命令</span></span><br><span class="line">E:\Homestead&gt;vagrant box add laravel laravel.box</span><br><span class="line">==&gt; box: Box file was not detected as metadata. Adding it directly...</span><br><span class="line">==&gt; box: Adding box <span class="string">'laravel'</span> (v0) <span class="keyword">for</span> provider:</span><br><span class="line">    box: Unpacking necessary files from: file://E:/Homestead/laravel.box</span><br><span class="line">    box: Progress: <span class="number">100</span>% (Rate: <span class="number">141</span>M/s, Estimated time remaining: --:--:--)</span><br><span class="line">==&gt; box: Successfully added box <span class="string">'laravel'</span> (v0) <span class="keyword">for</span> <span class="string">'virtualbox'</span>!</span><br><span class="line"></span><br><span class="line"><span class="comment">#检查是否导入成功</span></span><br><span class="line">E:\Homestead&gt;vagrant box list</span><br><span class="line">centos6.<span class="number">6</span> (virtualbox, <span class="number">0</span>)</span><br><span class="line">laravel   (virtualbox, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动Lavarel Homestead</span></span><br><span class="line">E:\Homestead&gt;vagrant up</span><br><span class="line">Bringing machine <span class="string">'default'</span> up with <span class="string">'virtualbox'</span> provider...</span><br><span class="line">==&gt; default: Importing base box <span class="string">'laravel'</span>...</span><br><span class="line">==&gt; default: Matching MAC address <span class="keyword">for</span> NAT networking...</span><br><span class="line">==&gt; default: Setting the name of the VM: Homestead_default_1437217549272_56101</span><br><span class="line">==&gt; default: Clearing any previously <span class="built_in">set</span> network interfaces...</span><br><span class="line">==&gt; default: Preparing network interfaces based on configuration...</span><br><span class="line">    default: Adapter <span class="number">1</span>: nat</span><br><span class="line">==&gt; default: Forwarding ports...</span><br><span class="line">    default: <span class="number">22</span> =&gt; <span class="number">2222</span> (adapter <span class="number">1</span>)</span><br><span class="line">==&gt; default: Booting VM...</span><br><span class="line">==&gt; default: Waiting <span class="keyword">for</span> machine to boot. This may take a few minutes...</span><br><span class="line">    default: SSH address: <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">2222</span></span><br><span class="line">    default: SSH username: vagrant</span><br><span class="line">    default: SSH auth method: private key</span><br><span class="line">    default: Warning: Connection timeout. Retrying...</span><br><span class="line">    default:</span><br><span class="line">    default: Vagrant insecure key detected. Vagrant will automatically replace</span><br><span class="line">    default: this with a newly generated keypair <span class="keyword">for</span> better security.</span><br><span class="line">    default:</span><br><span class="line">    default: Inserting generated public key within guest...</span><br><span class="line">    default: Removing insecure key from the guest <span class="keyword">if</span> it<span class="string">'s present...</span><br><span class="line">    default: Key inserted! Disconnecting and reconnecting using new SSH key...</span><br><span class="line">==&gt; default: Machine booted and ready!</span><br><span class="line">==&gt; default: Checking for guest additions in VM...</span><br><span class="line">    default: The guest additions on this VM do not match the installed version of</span><br><span class="line">    default: VirtualBox! In most cases this is fine, but in rare cases it can</span><br><span class="line">    default: prevent things such as shared folders from working properly. If you see</span><br><span class="line">    default: shared folder errors, please make sure the guest additions within the</span><br><span class="line">    default: virtual machine match the version of VirtualBox you have installed on</span><br><span class="line">    default: your host and reload your VM.</span><br><span class="line">    default:</span><br><span class="line">    default: Guest Additions Version: 4.3.14</span><br><span class="line">    default: VirtualBox Version: 5.0</span><br><span class="line">==&gt; default: Mounting shared folders...</span><br><span class="line">    default: /vagrant =&gt; E:/Homestead</span></span><br></pre></td></tr></table></figure>
<p>登录帐户<code>vagrant/vagrant</code>，开始全新的<code>Laravel Homestead</code>体验之旅吧。</p>
]]></content>
    <summary type="html">
    <![CDATA[用Vagrant为自己打造一个奇妙的跨平台开发环境]]>
    
    </summary>
    
      <category term="学习 | Study" scheme="http://wsgzao.github.io/categories/%E5%AD%A6%E4%B9%A0-Study/"/>
    
  </entry>
  
</feed>